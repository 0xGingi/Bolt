var Et=Object.defineProperty;var It=(t,e,n)=>e in t?Et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ge=(t,e,n)=>(It(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();function A(){}function mt(t){return t()}function ot(){return Object.create(null)}function ce(t){t.forEach(mt)}function wt(t){return typeof t=="function"}function ne(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ie;function Ht(t,e){return t===e?!0:(Ie||(Ie=document.createElement("a")),Ie.href=e,t===Ie.href)}function At(t){return Object.keys(t).length===0}function kt(t,...e){if(t==null){for(const r of e)r(void 0);return A}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function fe(t){let e;return kt(t,n=>e=n)(),e}function X(t,e,n){t.$$.on_destroy.push(kt(e,n))}function I(t,e,n){return t.set(n),e}function p(t,e){t.appendChild(e)}function H(t,e,n){t.insertBefore(e,n||null)}function E(t){t.parentNode&&t.parentNode.removeChild(t)}function je(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function Z(t){return document.createTextNode(t)}function P(){return Z(" ")}function yt(){return Z("")}function O(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Nt(t){return Array.from(t.childNodes)}function _e(t,e){e=""+e,t.data!==e&&(t.data=e)}function xe(t,e){t.value=e??""}function Ot(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Re;function Me(t){Re=t}function Ue(){if(!Re)throw new Error("Function called outside component initialization");return Re}function Ee(t){Ue().$$.on_mount.push(t)}function Dt(t){Ue().$$.after_update.push(t)}function Ke(t){Ue().$$.on_destroy.push(t)}function jt(){const t=Ue();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const c=Ot(e,n,{cancelable:r});return o.slice().forEach(i=>{i.call(t,c)}),!c.defaultPrevented}return!0}}const ye=[],q=[];let ve=[];const ze=[],Ut=Promise.resolve();let Fe=!1;function Bt(){Fe||(Fe=!0,Ut.then(vt))}function Ve(t){ve.push(t)}function Pe(t){ze.push(t)}const Xe=new Set;let we=0;function vt(){if(we!==0)return;const t=Re;do{try{for(;we<ye.length;){const e=ye[we];we++,Me(e),qt(e.$$)}}catch(e){throw ye.length=0,we=0,e}for(Me(null),ye.length=0,we=0;q.length;)q.pop()();for(let e=0;e<ve.length;e+=1){const n=ve[e];Xe.has(n)||(Xe.add(n),n())}ve.length=0}while(ye.length);for(;ze.length;)ze.pop()();Fe=!1,Xe.clear(),Me(t)}function qt(t){if(t.fragment!==null){t.update(),ce(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ve)}}function Jt(t){const e=[],n=[];ve.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),ve=e}const He=new Set;let pe;function Se(){pe={r:0,c:[],p:pe}}function Le(){pe.r||ce(pe.c),pe=pe.p}function D(t,e){t&&t.i&&(He.delete(t),t.i(e))}function U(t,e,n,r){if(t&&t.o){if(He.has(t))return;He.add(t),pe.c.push(()=>{He.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function ge(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Te(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function te(t){t&&t.c()}function K(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),Ve(()=>{const c=t.$$.on_mount.map(mt).filter(wt);t.$$.on_destroy?t.$$.on_destroy.push(...c):ce(c),t.$$.on_mount=[]}),o.forEach(Ve)}function Q(t,e){const n=t.$$;n.fragment!==null&&(Jt(n.after_update),ce(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Gt(t,e){t.$$.dirty[0]===-1&&(ye.push(t),Bt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function re(t,e,n,r,o,c,i=null,l=[-1]){const a=Re;Me(t);const u=t.$$={fragment:null,ctx:[],props:c,update:A,not_equal:o,bound:ot(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:ot(),dirty:l,skip_bound:!1,root:e.target||a.$$.root};i&&i(u.root);let d=!1;if(u.ctx=n?n(t,e.props||{},(h,g,...v)=>{const b=v.length?v[0]:g;return u.ctx&&o(u.ctx[h],u.ctx[h]=b)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](b),d&&Gt(t,h)),g}):[],u.update(),d=!0,ce(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const h=Nt(e.target);u.fragment&&u.fragment.l(h),h.forEach(E)}else u.fragment&&u.fragment.c();e.intro&&D(t.$$.fragment),K(t,e.target,e.anchor),vt()}Me(a)}class oe{constructor(){Ge(this,"$$");Ge(this,"$$set")}$destroy(){Q(this,1),this.$destroy=A}$on(e,n){if(!wt(n))return A;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!At(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xt);const ke=[];function St(t,e){return{subscribe:Y(t,e).subscribe}}function Y(t,e=A){let n;const r=new Set;function o(l){if(ne(t,l)&&(t=l,n)){const a=!ke.length;for(const u of r)u[1](),ke.push(u,t);if(a){for(let u=0;u<ke.length;u+=2)ke[u][0](ke[u+1]);ke.length=0}}}function c(l){o(l(t))}function i(l,a=A){const u=[l,a];return r.add(u),r.size===1&&(n=e(o,c)||A),l(t),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:o,update:c,subscribe:i}}function Lt(t){if(t.ok)return t.value;throw t.error}var W=(t=>(t[t.rs3=0]="rs3",t[t.osrs=1]="osrs",t))(W||{}),ae=(t=>(t[t.runeLite=0]="runeLite",t[t.hdos=1]="hdos",t[t.rs3=2]="rs3",t))(ae||{});const $t={use_dark_theme:!0,flatpak_rich_presence:!1,rs_config_uri:"",runelite_custom_jar:"",runelite_use_custom_jar:!1,selected_account:"",selected_characters:new Map,selected_game_accounts:new Map,selected_game_index:1,selected_client_index:1},zt=St("https://bolt-internal"),Ft=St("1fddee4e-b100-4f4e-b2b0-097f9088f9d2"),Qe=Y(),et=Y(""),B=Y({...$t}),he=Y(new Map),Be=Y(!1),be=Y([]),qe=Y({}),tt=Y([]),We=Y(""),Ze=Y(""),Ye=Y(""),$=Y(!1),Ne=Y(new Map),F=Y({game:W.osrs,client:ae.runeLite}),Oe=Y(!1);function Vt(){se.use_dark_theme==!1&&document.documentElement.classList.remove("dark")}function Wt(t,e){e&&t.win.close(),tt.update(n=>(n.splice(st.indexOf(t),1),n))}function xt(){if(ie&&ie.win&&!ie.win.closed)ie.win.focus();else if(ie&&ie.win&&ie.win.closed||ie){const t=Rt(),e=Kt();Yt({origin:atob(z.origin),redirect:atob(z.redirect),authMethod:"",loginType:"",clientid:atob(z.clientid),flow:"launcher",pkceState:t,pkceCodeVerifier:e}).then(n=>{const r=window.open(n,"","width=480,height=720");qe.set({state:t,verifier:e,win:r})})}}function Zt(){const t=new URLSearchParams(window.location.search);et.set(t.get("platform")),t.get("flathub"),We.set(t.get("rs3_linux_installed_hash")),Ze.set(t.get("runelite_installed_id")),Ye.set(t.get("hdos_installed_version")),Be.set(t.get("plugins")==="1");const e=t.get("credentials");if(e)try{JSON.parse(e).forEach(o=>{he.update(c=>(c.set(o.sub,o),c))})}catch(r){J(`Couldn't parse credentials file: ${r}`,!1)}const n=t.get("config");if(n)try{const r=JSON.parse(n);B.set(r),B.update(o=>(o.selected_game_accounts?(o.selected_characters=new Map(Object.entries(o.selected_game_accounts)),delete o.selected_game_accounts):o.selected_characters&&(o.selected_characters=new Map(Object.entries(o.selected_characters))),o))}catch(r){J(`Couldn't parse config file: ${r}`,!1)}}async function Ct(t,e,n){return new Promise(r=>{if(t.expiry-Date.now()<3e4){const o=new URLSearchParams({grant_type:"refresh_token",client_id:n,refresh_token:t.refresh_token}),c=new XMLHttpRequest;c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const i=Mt(c.response),l=Lt(i);l?(t.access_token=l.access_token,t.expiry=l.expiry,t.id_token=l.id_token,t.login_provider=l.login_provider,t.refresh_token=l.refresh_token,l.session_id&&(t.session_id=l.session_id),t.sub=l.sub,r(null)):r(0)}else r(c.status)},c.onerror=()=>{r(0)},c.open("POST",e,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Accept","application/json"),c.send(o)}else r(null)})}function Mt(t){const e=JSON.parse(t),n=e.id_token.split(".");if(n.length!==3){const c=`Malformed id_token: ${n.length} sections, expected 3`;return J(c,!1),{ok:!1,error:new Error(c)}}const r=JSON.parse(atob(n[0]));if(r.typ!=="JWT"){const c=`Bad id_token header: typ ${r.typ}, expected JWT`;return J(c,!1),{ok:!1,error:new Error(c)}}const o=JSON.parse(atob(n[1]));return{ok:!0,value:{access_token:e.access_token,id_token:e.id_token,refresh_token:e.refresh_token,sub:o.sub,login_provider:o.login_provider||null,expiry:Date.now()+e.expires_in*1e3,session_id:e.session_id}}}async function Yt(t){const e=new TextEncoder().encode(t.pkceCodeVerifier),n=await crypto.subtle.digest("SHA-256",e);let r="";const o=new Uint8Array(n);for(let i=0;i<o.byteLength;i++)r+=String.fromCharCode(o[i]);const c=btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return t.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:t.authMethod,login_type:t.loginType,flow:t.flow,response_type:"code",client_id:t.clientid,redirect_uri:t.redirect,code_challenge:c,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:t.pkceState}).toString())}function Kt(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=new Uint32Array(43);return crypto.getRandomValues(e),Array.from(e,function(n){return t[n%t.length]}).join("")}function Rt(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e.length-1,r=crypto.getRandomValues(new Uint8Array(12));return Array.from(r).map(o=>Math.round(o*(n-0)/255+0)).map(o=>e[o]).join("")}async function Pt(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState==4&&(o.status==200?n.then(c=>{if(typeof c!="number"){const i={id:c.id,userId:c.userId,displayName:c.displayName,suffix:c.suffix,characters:new Map};G(`Successfully added login for ${i.displayName}`),JSON.parse(o.response).forEach(l=>{i.characters.set(l.accountId,{accountId:l.accountId,displayName:l.displayName,userHash:l.userHash})}),tn(i),r(!0)}else J(`Error getting account info: ${c}`,!1),r(!1)}):(J(`Error: from ${e}: ${o.status}: ${o.response}`,!1),r(!1)))},o.open("GET",e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(t.session_id)),o.send()})}async function lt(t,e){return await Qt(t,e)}async function Qt(t,e){const n=Rt(),r=crypto.randomUUID(),o=atob(z.origin).concat("/oauth2/auth?").concat(new URLSearchParams({id_token_hint:e.id_token,nonce:btoa(r),prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:n,client_id:fe(Ft),scope:"openid offline"}).toString()),c=en(e);return t?(t.location.href=o,tt.update(i=>(i.push({state:n,nonce:r,creds:e,win:t,account_info_promise:c}),i)),!1):e.session_id?await Pt(e,atob(z.auth_api).concat("/accounts"),c):(J("Rejecting stored credentials with missing session_id",!1),!1)}function en(t){return new Promise(e=>{const n=`${atob(z.api)}/users/${t.sub}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{r.readyState==4&&(r.status==200?e(JSON.parse(r.response)):e(r.status))},r.open("GET",n,!0),r.setRequestHeader("Authorization","Bearer ".concat(t.access_token)),r.send()})}function tn(t){const e=()=>{F.update(n=>{n.account=t;const[r]=t.characters.keys();return n.character=t.characters.get(r),de.size>0&&(n.credentials=de.get(t.userId)),n})};Ne.update(n=>(n.set(t.userId,t),n)),De.account&&se.selected_account?t.userId==se.selected_account&&e():De.account||e(),qe.set({})}function nn(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.open("POST",e,!0),o.onreadystatechange=()=>{o.readyState==4&&r(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(new URLSearchParams({token:t,client_id:n}))})}async function Ce(){const t=new XMLHttpRequest;t.open("POST","/save-credentials",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{t.readyState==4&&G(`Save-credentials status: ${t.responseText.trim()}`)},F.update(n=>{var r;return n.credentials=de.get((r=De.account)==null?void 0:r.userId),n});const e=[];de.forEach(n=>{e.push(n)}),t.send(JSON.stringify(e))}function sn(t,e,n){Je();const r=(l,a)=>{const u=new XMLHttpRequest,d={};l&&(d.hash=l),t&&(d.jx_session_id=t),e&&(d.jx_character_id=e),n&&(d.jx_display_name=n),se.rs_config_uri?d.config_uri=se.rs_config_uri:d.config_uri=atob(z.default_config_uri),u.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(d).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(G(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&l&&We.set(l))},u.send(a)},o=new XMLHttpRequest,c=atob(z.content_url),i=c.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",i,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const l=Object.fromEntries(o.response.split(`
`).map(a=>a.split(": ")));if(!l.Filename||!l.Size){J(`Could not parse package data from URL: ${i}`,!1),r();return}if(l.SHA256!==fe(We)){G("Downloading RS3 client...");const a=new XMLHttpRequest;a.open("GET",c.concat(l.Filename),!0),a.responseType="arraybuffer",a.onprogress=u=>{u.loaded&&be.update(d=>(d[0].text=`Downloading RS3 client... ${(Math.round(1e3*u.loaded/u.total)/10).toFixed(1)}%`,d))},a.onreadystatechange=()=>{a.readyState==4&&a.status==200&&r(l.SHA256,a.response)},a.onerror=()=>{J(`Error downloading game client: from ${i}: non-http error`,!1),r()},a.send()}else G("Latest client is already installed"),r()}},o.onerror=()=>{J(`Error: from ${i}: non-http error`,!1),r()},o.send()}function Tt(t,e,n,r){Je();const o=r?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",c=(a,u,d)=>{const h=new XMLHttpRequest,g={};a&&(g.id=a),d&&(g.jar_path=d),t&&(g.jx_session_id=t),e&&(g.jx_character_id=e),n&&(g.jx_display_name=n),se.flatpak_rich_presence&&(g.flatpak_rich_presence=""),h.open(u?"POST":"GET",o.concat(new URLSearchParams(g).toString()),!0),h.onreadystatechange=()=>{h.readyState==4&&(G(`Game launch status: '${h.responseText.trim()}'`),h.status==200&&a&&Ze.set(a))},h.send(u)};if(se.runelite_use_custom_jar){c(null,null,se.runelite_custom_jar);return}const i=new XMLHttpRequest,l="https://api.github.com/repos/runelite/launcher/releases";i.open("GET",l,!0),i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const a=JSON.parse(i.responseText).map(u=>u.assets).flat().find(u=>u.name.toLowerCase()=="runelite.jar");if(a.id!=fe(Ze)){G("Downloading RuneLite...");const u=new XMLHttpRequest;u.open("GET",a.browser_download_url,!0),u.responseType="arraybuffer",u.onreadystatechange=()=>{u.readyState==4&&(u.status==200?c(a.id,u.response):J(`Error downloading from ${a.url}: ${u.status}: ${u.responseText}`,!1))},u.onprogress=d=>{d.loaded&&d.lengthComputable&&be.update(h=>(h[0].text=`Downloading RuneLite... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,h))},u.send()}else G("Latest JAR is already installed"),c()}else J(`Error from ${l}: ${i.status}: ${i.responseText}`,!1)},i.send()}function rn(t,e,n){return Tt(t,e,n,!1)}function on(t,e,n){return Tt(t,e,n,!0)}function ln(t,e,n){Je();const r=(i,l)=>{const a=new XMLHttpRequest,u={};i&&(u.version=i),t&&(u.jx_session_id=t),e&&(u.jx_character_id=e),n&&(u.jx_display_name=n),a.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(u).toString()),!0),a.onreadystatechange=()=>{a.readyState==4&&(G(`Game launch status: '${a.responseText.trim()}'`),a.status==200&&i&&Ye.set(i))},a.send(l)},o=new XMLHttpRequest,c="https://cdn.hdos.dev/client/getdown.txt";o.open("GET",c,!0),o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const i=o.responseText.match(/^launcher\.version *= *(.*?)$/m);if(i&&i.length>=2){const l=i[1];if(l!==fe(Ye)){const a=`https://cdn.hdos.dev/launcher/v${l}/hdos-launcher.jar`;G("Downloading HDOS...");const u=new XMLHttpRequest;u.open("GET",a,!0),u.responseType="arraybuffer",u.onreadystatechange=()=>{if(u.readyState==4)if(u.status==200)r(l,u.response);else{const d=JSON.parse(o.responseText).map(h=>h.assets).flat().find(h=>h.name.toLowerCase()=="runelite.jar");J(`Error downloading from ${d.url}: ${u.status}: ${u.responseText}`,!1)}},u.onprogress=d=>{d.loaded&&d.lengthComputable&&be.update(h=>(h[0].text=`Downloading HDOS... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,h))},u.send()}else G("Latest JAR is already installed"),r()}else G("Couldn't parse latest launcher version"),r()}else J(`Error from ${c}: ${o.status}: ${o.responseText}`,!1)},o.send()}let $e=!1;function Je(){var t;if(fe($)&&!$e){$e=!0;const e=new XMLHttpRequest;e.open("POST","/save-config",!0),e.onreadystatechange=()=>{e.readyState==4&&(G(`Save config status: '${e.responseText.trim()}'`),e.status==200&&$.set(!1),$e=!1)},e.setRequestHeader("Content-Type","application/json");const n={};(t=se.selected_characters)==null||t.forEach((c,i)=>{n[i]=c});const r={};Object.assign(r,se),r.selected_characters=n;const o=JSON.stringify(r,null,4);e.send(o)}}function ct(t,e,n){const r=t.slice();return r[22]=e[n],r}function it(t){let e,n=t[22][1].displayName+"",r,o,c;return{c(){e=m("option"),r=Z(n),f(e,"data-id",o=t[22][1].userId),f(e,"class","dark:bg-slate-900"),e.__value=c=t[22][1].displayName,xe(e,e.__value)},m(i,l){H(i,e,l),p(e,r)},p(i,l){l&4&&n!==(n=i[22][1].displayName+"")&&_e(r,n),l&4&&o!==(o=i[22][1].userId)&&f(e,"data-id",o),l&4&&c!==(c=i[22][1].displayName)&&(e.__value=c,xe(e,e.__value))},d(i){i&&E(e)}}}function cn(t){let e,n,r,o,c,i,l,a,u,d=ge(t[2]),h=[];for(let g=0;g<d.length;g+=1)h[g]=it(ct(t,d,g));return{c(){e=m("div"),n=m("select");for(let g=0;g<h.length;g+=1)h[g].c();r=P(),o=m("div"),c=m("button"),c.textContent="Log In",i=P(),l=m("button"),l.textContent="Log Out",f(n,"name","account_select"),f(n,"id","account_select"),f(n,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),f(c,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(l,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),f(o,"class","mt-5 flex"),f(e,"class","z-10 w-48 rounded-lg border-2 border-slate-300 bg-slate-100 p-3 shadow dark:border-slate-800 dark:bg-slate-900"),f(e,"role","none")},m(g,v){H(g,e,v),p(e,n);for(let b=0;b<h.length;b+=1)h[b]&&h[b].m(n,null);t[7](n),p(e,r),p(e,o),p(o,c),p(o,i),p(o,l),a||(u=[O(n,"change",t[8]),O(c,"click",t[9]),O(l,"click",t[10]),O(e,"mouseenter",t[11]),O(e,"mouseleave",t[12])],a=!0)},p(g,[v]){if(v&4){d=ge(g[2]);let b;for(b=0;b<d.length;b+=1){const M=ct(g,d,b);h[b]?h[b].p(M,v):(h[b]=it(M),h[b].c(),h[b].m(n,null))}for(;b<h.length;b+=1)h[b].d(1);h.length=d.length}},i:A,o:A,d(g){g&&E(e),je(h,g),t[7](null),a=!1,ce(u)}}}function an(t,e,n){let r,o,c,i;X(t,F,S=>n(13,r=S)),X(t,he,S=>n(14,o=S)),X(t,Ne,S=>n(2,c=S)),X(t,B,S=>n(15,i=S));let{showAccountDropdown:l}=e,{hoverAccountButton:a}=e;const u=atob(z.origin),d=atob(z.clientid),h=u.concat("/oauth2/token"),g=u.concat("/oauth2/revoke");let v=!1,b;function M(S){a||S.button===0&&l&&!v&&n(5,l=!1)}function w(){var ee;if(b.options.length==0){G("Logout unsuccessful: no account selected");return}let S=r.credentials;r.account&&(c.delete((ee=r.account)==null?void 0:ee.userId),Ne.set(c));const R=b.selectedIndex;R>0?n(1,b.selectedIndex=R-1,b):R==0&&c.size>0?n(1,b.selectedIndex=R+1,b):(delete r.account,delete r.character,delete r.credentials),x(),S&&Ct(S,h,d).then(j=>{j===null?nn(S.access_token,g,d).then(T=>{T===200?(G("Successful logout"),L(S)):J(`Logout unsuccessful: status ${T}`,!1)}):j===400||j===401?(G("Logout unsuccessful: credentials are invalid, so discarding them anyway"),S&&L(S)):J("Logout unsuccessful: unable to verify credentials due to a network error",!1)})}function L(S){o.delete(S.sub),Ce()}function x(){var R;$.set(!0);const S=b[b.selectedIndex].getAttribute("data-id");if(I(F,r.account=c.get(S),r),I(B,i.selected_account=S,i),I(F,r.credentials=o.get((R=r.account)==null?void 0:R.userId),r),r.account&&r.account.characters){const ee=document.getElementById("character_select");ee.selectedIndex=0;const[j]=r.account.characters.keys();I(F,r.character=r.account.characters.get(j),r)}}addEventListener("mousedown",M),Ee(()=>{var R;let S=0;c.forEach((ee,j)=>{var T;ee.displayName==((T=r.account)==null?void 0:T.displayName)&&n(1,b.selectedIndex=S,b),S++}),I(F,r.credentials=o.get((R=r.account)==null?void 0:R.userId),r)}),Ke(()=>{removeEventListener("mousedown",M)});function _(S){q[S?"unshift":"push"](()=>{b=S,n(1,b)})}const k=()=>{x()},y=()=>{xt()},N=()=>{w()},V=()=>{n(0,v=!0)},C=()=>{n(0,v=!1)};return t.$$set=S=>{"showAccountDropdown"in S&&n(5,l=S.showAccountDropdown),"hoverAccountButton"in S&&n(6,a=S.hoverAccountButton)},[v,b,c,w,x,l,a,_,k,y,N,V,C]}class un extends oe{constructor(e){super(),re(this,e,an,cn,ne,{showAccountDropdown:5,hoverAccountButton:6})}}function dn(t){let e;return{c(){e=Z("Log In")},m(n,r){H(n,e,r)},p:A,d(n){n&&E(e)}}}function fn(t){var r;let e=((r=t[6].account)==null?void 0:r.displayName)+"",n;return{c(){n=Z(e)},m(o,c){H(o,n,c)},p(o,c){var i;c&64&&e!==(e=((i=o[6].account)==null?void 0:i.displayName)+"")&&_e(n,e)},d(o){o&&E(n)}}}function at(t){let e,n,r,o;function c(l){t[20](l)}let i={hoverAccountButton:t[2]};return t[1]!==void 0&&(i.showAccountDropdown=t[1]),n=new un({props:i}),q.push(()=>Te(n,"showAccountDropdown",c)),{c(){e=m("div"),te(n.$$.fragment),f(e,"class","absolute right-2 top-[72px]")},m(l,a){H(l,e,a),K(n,e,null),o=!0},p(l,a){const u={};a&4&&(u.hoverAccountButton=l[2]),!r&&a&2&&(r=!0,u.showAccountDropdown=l[1],Pe(()=>r=!1)),n.$set(u)},i(l){o||(D(n.$$.fragment,l),o=!0)},o(l){U(n.$$.fragment,l),o=!1},d(l){l&&E(e),Q(n)}}}function pn(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w;function L(y,N){return y[6].account?fn:dn}let x=L(t),_=x(t),k=t[1]&&at(t);return{c(){e=m("div"),n=m("div"),r=m("button"),r.textContent="RS3",o=P(),c=m("button"),c.textContent="OSRS",i=P(),l=m("div"),a=m("button"),a.innerHTML='<img src="svgs/lightbulb-solid.svg" class="h-6 w-6" alt="Change Theme"/>',u=P(),d=m("button"),d.innerHTML='<img src="svgs/gear-solid.svg" class="h-6 w-6" alt="Settings"/>',h=P(),g=m("button"),_.c(),v=P(),k&&k.c(),f(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(c,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),f(n,"class","m-3 ml-9 font-bold"),f(a,"class","my-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(d,"class","m-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(g,"class","m-2 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50"),f(l,"class","ml-auto flex"),f(e,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m(y,N){H(y,e,N),p(e,n),p(n,r),t[10](r),p(n,o),p(n,c),t[12](c),p(e,i),p(e,l),p(l,a),p(l,u),p(l,d),p(l,h),p(l,g),_.m(g,null),t[16](g),p(e,v),k&&k.m(e,null),b=!0,M||(w=[O(r,"click",t[11]),O(c,"click",t[13]),O(a,"click",t[14]),O(d,"click",t[15]),O(g,"mouseenter",t[17]),O(g,"mouseleave",t[18]),O(g,"click",t[19])],M=!0)},p(y,[N]){x===(x=L(y))&&_?_.p(y,N):(_.d(1),_=x(y),_&&(_.c(),_.m(g,null))),y[1]?k?(k.p(y,N),N&2&&D(k,1)):(k=at(y),k.c(),D(k,1),k.m(e,null)):k&&(Se(),U(k,1,1,()=>{k=null}),Le())},i(y){b||(D(k),b=!0)},o(y){U(k),b=!1},d(y){y&&E(e),t[10](null),t[12](null),_.d(),t[16](null),k&&k.d(),M=!1,ce(w)}}}function hn(t,e,n){let r,o,c;X(t,B,R=>n(21,r=R)),X(t,$,R=>n(22,o=R)),X(t,F,R=>n(6,c=R));let{showSettings:i}=e,l=!1,a=!1,u,d,h;function g(){let R=document.documentElement;R.classList.contains("dark")?R.classList.remove("dark"):R.classList.add("dark"),I(B,r.use_dark_theme=!r.use_dark_theme,r),I($,o=!0,o)}function v(R){switch(R){case W.osrs:I(F,c.game=W.osrs,c),I(F,c.client=r.selected_client_index,c),I(B,r.selected_game_index=W.osrs,r),I($,o=!0,o),d.classList.add("bg-blue-500","text-black"),u.classList.remove("bg-blue-500","text-black");break;case W.rs3:I(F,c.game=W.rs3,c),I(B,r.selected_game_index=W.rs3,r),I($,o=!0,o),d.classList.remove("bg-blue-500","text-black"),u.classList.add("bg-blue-500","text-black");break}}function b(){if(h.innerHTML=="Log In"){xt();return}n(1,l=!l)}Ee(()=>{v(r.selected_game_index)});function M(R){q[R?"unshift":"push"](()=>{u=R,n(3,u)})}const w=()=>{v(W.rs3)};function L(R){q[R?"unshift":"push"](()=>{d=R,n(4,d)})}const x=()=>{v(W.osrs)},_=()=>g(),k=()=>{n(0,i=!0)};function y(R){q[R?"unshift":"push"](()=>{h=R,n(5,h)})}const N=()=>{n(2,a=!0)},V=()=>{n(2,a=!1)},C=()=>b();function S(R){l=R,n(1,l)}return t.$$set=R=>{"showSettings"in R&&n(0,i=R.showSettings)},[i,l,a,u,d,h,c,g,v,b,M,w,L,x,_,k,y,N,V,C,S]}class _n extends oe{constructor(e){super(),re(this,e,hn,pn,ne,{showSettings:0})}}function gn(t){let e,n,r,o,c,i;return{c(){e=m("div"),n=m("div"),n.innerHTML="",r=P(),o=m("div"),o.innerHTML="",f(n,"class","absolute left-0 top-0 z-10 h-screen w-screen backdrop-blur-sm backdrop-filter"),f(o,"class","absolute left-0 top-0 z-10 h-screen w-screen bg-black opacity-75"),f(o,"role","none")},m(l,a){H(l,e,a),p(e,n),p(e,r),p(e,o),c||(i=O(o,"click",t[1]),c=!0)},p:A,i:A,o:A,d(l){l&&E(e),c=!1,i()}}}function bn(t){const e=jt();return[e,()=>{e("click")}]}class nt extends oe{constructor(e){super(),re(this,e,bn,gn,ne,{})}}function mn(t){let e,n,r,o,c,i,l,a,u,d,h,g;return n=new nt({}),{c(){e=m("div"),te(n.$$.fragment),r=P(),o=m("div"),c=m("p"),c.textContent=`${t[1]}`,i=P(),l=m("p"),l.textContent=`${t[2]}`,a=P(),u=m("button"),u.textContent="I Understand",f(c,"class","p-2"),f(l,"class","p-2"),f(u,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(o,"class","absolute left-1/4 top-1/4 z-20 w-1/2 rounded-lg bg-slate-100 p-5 text-center shadow-lg dark:bg-slate-900"),f(e,"id","disclaimer")},m(v,b){H(v,e,b),K(n,e,null),p(e,r),p(e,o),p(o,c),p(o,i),p(o,l),p(o,a),p(o,u),d=!0,h||(g=O(u,"click",t[3]),h=!0)},p:A,i(v){d||(D(n.$$.fragment,v),d=!0)},o(v){U(n.$$.fragment,v),d=!1},d(v){v&&E(e),Q(n),h=!1,g()}}}function wn(t,e,n){let r;X(t,Oe,l=>n(0,r=l));const o=atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg=="),c=atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu");return[r,o,c,()=>{I(Oe,r=!1,r)}]}class kn extends oe{constructor(e){super(),re(this,e,wn,mn,ne,{})}}function yn(t){let e,n,r,o;return{c(){e=m("div"),n=m("button"),n.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
			Browse App Data</div>`,f(n,"id","data_dir_button"),f(n,"class","p-2 hover:opacity-75"),f(e,"id","general_options"),f(e,"class","col-span-3 p-5 pt-10")},m(c,i){H(c,e,i),p(e,n),r||(o=O(n,"click",t[1]),r=!0)},p:A,i:A,o:A,d(c){c&&E(e),r=!1,o()}}}function vn(t){function e(){var r=new XMLHttpRequest;r.open("GET","/browse-data"),r.onreadystatechange=()=>{r.readyState==4&&G(`Browse status: '${r.responseText.trim()}'`)},r.send()}return[e,()=>{e()}]}class Sn extends oe{constructor(e){super(),re(this,e,vn,yn,ne,{})}}function Ln(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w,L,x,_,k,y;return{c(){e=m("div"),n=m("button"),n.innerHTML=`<div class="flex"><img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
			Configure RuneLite</div>`,r=P(),o=m("div"),c=m("label"),c.textContent="Expose rich presence to Flatpak Discord:",i=P(),l=m("input"),a=P(),u=m("div"),d=m("label"),d.textContent="Use custom RuneLite JAR:",h=P(),g=m("input"),v=P(),b=m("div"),M=m("textarea"),w=P(),L=m("br"),x=P(),_=m("button"),_.textContent="Select File",f(n,"id","rl_configure"),f(n,"class","p-2 pb-5 hover:opacity-75"),f(c,"for","flatpak_rich_presence"),f(l,"type","checkbox"),f(l,"name","flatpak_rich_presence"),f(l,"id","flatpak_rich_presence"),f(l,"class","ml-2"),f(o,"id","flatpak_div"),f(o,"class","mx-auto border-t-2 border-slate-300 p-2 py-5 dark:border-slate-800"),f(d,"for","use_custom_jar"),f(g,"type","checkbox"),f(g,"name","use_custom_jar"),f(g,"id","use_custom_jar"),f(g,"class","ml-2"),f(u,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),M.disabled=!0,f(M,"name","custom_jar_file"),f(M,"id","custom_jar_file"),f(M,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),_.disabled=!0,f(_,"id","custom_jar_file_button"),f(_,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 hover:opacity-75"),f(b,"id","custom_jar_div"),f(b,"class","mx-auto p-2 opacity-25"),f(e,"id","osrs_options"),f(e,"class","col-span-3 p-5 pt-10")},m(N,V){H(N,e,V),p(e,n),p(e,r),p(e,o),p(o,c),p(o,i),p(o,l),t[12](l),t[14](o),p(e,a),p(e,u),p(u,d),p(u,h),p(u,g),t[15](g),p(e,v),p(e,b),p(b,M),t[17](M),p(b,w),p(b,L),p(b,x),p(b,_),t[19](_),t[21](b),k||(y=[O(n,"click",t[11]),O(l,"change",t[13]),O(g,"change",t[16]),O(M,"change",t[18]),O(_,"click",t[20])],k=!0)},p:A,i:A,o:A,d(N){N&&E(e),t[12](null),t[14](null),t[15](null),t[17](null),t[19](null),t[21](null),k=!1,ce(y)}}}function xn(t,e,n){let r,o,c,i;X(t,et,T=>n(22,r=T)),X(t,B,T=>n(23,o=T)),X(t,F,T=>n(24,c=T)),X(t,$,T=>n(25,i=T));let l,a,u,d,h,g;function v(){l.classList.toggle("opacity-25"),n(1,a.disabled=!a.disabled,a),n(2,u.disabled=!u.disabled,u),I(B,o.runelite_use_custom_jar=d.checked,o),o.runelite_use_custom_jar?a.value&&I(B,o.runelite_custom_jar=a.value,o):(n(1,a.value="",a),I(B,o.runelite_custom_jar="",o),I(B,o.runelite_use_custom_jar=!1,o)),I($,i=!0,i)}function b(){I(B,o.flatpak_rich_presence=h.checked,o),I($,i=!0,i)}function M(){I(B,o.runelite_custom_jar=a.value,o),I($,i=!0,i)}function w(){n(3,d.disabled=!0,d),n(2,u.disabled=!0,u);var T=new XMLHttpRequest;T.onreadystatechange=()=>{T.readyState==4&&(T.status==200&&(n(1,a.value=T.responseText,a),I(B,o.runelite_custom_jar=T.responseText,o),I($,i=!0,i)),n(2,u.disabled=!1,u),n(3,d.disabled=!1,d))},T.open("GET","/jar-file-picker",!0),T.send()}function L(){var T,me,rt;if(!c.account||!c.character){G("Please log in to configure RuneLite");return}on((T=c.credentials)==null?void 0:T.session_id,(me=c.character)==null?void 0:me.accountId,(rt=c.character)==null?void 0:rt.displayName)}Ee(()=>{n(4,h.checked=o.flatpak_rich_presence,h),n(3,d.checked=o.runelite_use_custom_jar,d),d.checked&&o.runelite_custom_jar?(l.classList.remove("opacity-25"),n(1,a.disabled=!1,a),n(2,u.disabled=!1,u),n(1,a.value=o.runelite_custom_jar,a)):(n(3,d.checked=!1,d),I(B,o.runelite_use_custom_jar=!1,o)),r!=="linux"&&g.remove()});const x=()=>L();function _(T){q[T?"unshift":"push"](()=>{h=T,n(4,h)})}const k=()=>{b()};function y(T){q[T?"unshift":"push"](()=>{g=T,n(5,g)})}function N(T){q[T?"unshift":"push"](()=>{d=T,n(3,d)})}const V=()=>{v()};function C(T){q[T?"unshift":"push"](()=>{a=T,n(1,a)})}const S=()=>{M()};function R(T){q[T?"unshift":"push"](()=>{u=T,n(2,u)})}const ee=()=>{w()};function j(T){q[T?"unshift":"push"](()=>{l=T,n(0,l)})}return[l,a,u,d,h,g,v,b,M,w,L,x,_,k,y,N,V,C,S,R,ee,j]}class Cn extends oe{constructor(e){super(),re(this,e,xn,Ln,ne,{})}}function Mn(t){let e,n,r,o,c,i,l,a,u,d;return{c(){e=m("div"),n=m("div"),r=m("label"),r.textContent="Use custom config URI:",o=P(),c=m("input"),i=P(),l=m("div"),a=m("textarea"),f(r,"for","use_custom_uri"),f(c,"type","checkbox"),f(c,"name","use_custom_uri"),f(c,"id","use_custom_uri"),f(c,"class","ml-2"),f(n,"class","mx-auto p-2"),a.disabled=!0,f(a,"name","config_uri_address"),f(a,"id","config_uri_address"),f(a,"rows","4"),f(a,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),a.value="		",f(l,"id","config_uri_div"),f(l,"class","mx-auto p-2 opacity-25"),f(e,"id","rs3_options"),f(e,"class","col-span-3 p-5 pt-10")},m(h,g){H(h,e,g),p(e,n),p(n,r),p(n,o),p(n,c),t[5](c),p(e,i),p(e,l),p(l,a),t[8](a),t[9](l),u||(d=[O(c,"change",t[6]),O(a,"change",t[7])],u=!0)},p:A,i:A,o:A,d(h){h&&E(e),t[5](null),t[8](null),t[9](null),u=!1,ce(d)}}}function Rn(t,e,n){let r,o,c;X(t,Qe,w=>n(10,r=w)),X(t,B,w=>n(11,o=w)),X(t,$,w=>n(12,c=w));let i,l,a;function u(){i.classList.toggle("opacity-25"),n(1,l.disabled=!l.disabled,l),I($,c=!0,c),a.checked||(n(1,l.value=atob(r.default_config_uri),l),I(B,o.rs_config_uri="",o))}function d(){I(B,o.rs_config_uri=l.value,o),I($,c=!0,c)}Ee(()=>{o.rs_config_uri?(n(1,l.value=o.rs_config_uri,l),n(2,a.checked=!0,a),u()):n(1,l.value=atob(r.default_config_uri),l)});function h(w){q[w?"unshift":"push"](()=>{a=w,n(2,a)})}const g=()=>{u()},v=()=>{d()};function b(w){q[w?"unshift":"push"](()=>{l=w,n(1,l)})}function M(w){q[w?"unshift":"push"](()=>{i=w,n(0,i)})}return[i,l,a,u,d,h,g,v,b,M]}class Pn extends oe{constructor(e){super(),re(this,e,Rn,Mn,ne,{})}}function Tn(t){let e,n;return e=new Pn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function En(t){let e,n;return e=new Cn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function In(t){let e,n;return e=new Sn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Hn(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w,L,x,_,k,y,N,V,C;n=new nt({}),n.$on("click",t[7]);const S=[In,En,Tn],R=[];function ee(j,T){return j[1]==j[5].general?0:j[1]==j[5].osrs?1:j[1]==j[5].rs3?2:-1}return~(k=ee(t))&&(y=R[k]=S[k](t)),{c(){e=m("div"),te(n.$$.fragment),r=P(),o=m("div"),c=m("button"),c.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',i=P(),l=m("div"),a=m("div"),u=m("button"),d=Z("General"),h=m("br"),g=P(),v=m("button"),b=Z("OSRS"),M=m("br"),w=P(),L=m("button"),x=Z("RS3"),_=P(),y&&y.c(),f(c,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),f(u,"id","general_button"),f(u,"class",ue),f(v,"id","osrs_button"),f(v,"class",Ae),f(L,"id","rs3_button"),f(L,"class",ue),f(a,"class","relative h-full border-r-2 border-slate-300 pt-10 dark:border-slate-800"),f(l,"class","grid h-full grid-cols-4"),f(o,"class","absolute left-[13%] top-[13%] z-20 h-3/4 w-3/4 rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900"),f(e,"id","settings")},m(j,T){H(j,e,T),K(n,e,null),p(e,r),p(e,o),p(o,c),p(o,i),p(o,l),p(l,a),p(a,u),p(u,d),t[9](u),p(a,h),p(a,g),p(a,v),p(v,b),t[11](v),p(a,M),p(a,w),p(a,L),p(L,x),t[13](L),p(l,_),~k&&R[k].m(l,null),N=!0,V||(C=[O(c,"click",t[8]),O(u,"click",t[10]),O(v,"click",t[12]),O(L,"click",t[14])],V=!0)},p(j,[T]){let me=k;k=ee(j),k!==me&&(y&&(Se(),U(R[me],1,1,()=>{R[me]=null}),Le()),~k?(y=R[k],y||(y=R[k]=S[k](j),y.c()),D(y,1),y.m(l,null)):y=null)},i(j){N||(D(n.$$.fragment,j),D(y),N=!0)},o(j){U(n.$$.fragment,j),U(y),N=!1},d(j){j&&E(e),Q(n),t[9](null),t[11](null),t[13](null),~k&&R[k].d(),V=!1,ce(C)}}}let Ae="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 mx-auto my-1 w-3/4",ue="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 mx-auto my-1 w-3/4";function An(t,e,n){let{showSettings:r}=e;var o=(_=>(_[_.general=0]="general",_[_.osrs=1]="osrs",_[_.rs3=2]="rs3",_))(o||{});let c=1,i,l,a;function u(_){switch(_){case 0:n(1,c=0),n(2,i.classList.value=Ae,i),n(3,l.classList.value=ue,l),n(4,a.classList.value=ue,a);break;case 1:n(1,c=1),n(2,i.classList.value=ue,i),n(3,l.classList.value=Ae,l),n(4,a.classList.value=ue,a);break;case 2:n(1,c=2),n(2,i.classList.value=ue,i),n(3,l.classList.value=ue,l),n(4,a.classList.value=Ae,a);break}}function d(_){_.key==="Escape"&&n(0,r=!1)}addEventListener("keydown",d),Ke(()=>{removeEventListener("keydown",d)});const h=()=>{n(0,r=!1)},g=()=>{n(0,r=!1)};function v(_){q[_?"unshift":"push"](()=>{i=_,n(2,i)})}const b=()=>{u(o.general)};function M(_){q[_?"unshift":"push"](()=>{l=_,n(3,l)})}const w=()=>{u(o.osrs)};function L(_){q[_?"unshift":"push"](()=>{a=_,n(4,a)})}const x=()=>{u(o.rs3)};return t.$$set=_=>{"showSettings"in _&&n(0,r=_.showSettings)},[r,c,i,l,a,o,u,h,g,v,b,M,w,L,x]}class Nn extends oe{constructor(e){super(),re(this,e,An,Hn,ne,{showSettings:0})}}function ut(t,e,n){const r=t.slice();return r[1]=e[n],r}function On(t){var a;let e,n=((a=t[1].time)==null?void 0:a.toLocaleTimeString())+"",r,o,c=t[1].text+"",i,l;return{c(){e=m("li"),r=Z(n),o=Z(`
					- `),i=Z(c),l=P()},m(u,d){H(u,e,d),p(e,r),p(e,o),p(e,i),p(e,l)},p(u,d){var h;d&1&&n!==(n=((h=u[1].time)==null?void 0:h.toLocaleTimeString())+"")&&_e(r,n),d&1&&c!==(c=u[1].text+"")&&_e(i,c)},d(u){u&&E(e)}}}function Dn(t){var a;let e,n=((a=t[1].time)==null?void 0:a.toLocaleTimeString())+"",r,o,c=t[1].text+"",i,l;return{c(){e=m("li"),r=Z(n),o=Z(`
					- `),i=Z(c),l=P(),f(e,"class","text-rose-500")},m(u,d){H(u,e,d),p(e,r),p(e,o),p(e,i),p(e,l)},p(u,d){var h;d&1&&n!==(n=((h=u[1].time)==null?void 0:h.toLocaleTimeString())+"")&&_e(r,n),d&1&&c!==(c=u[1].text+"")&&_e(i,c)},d(u){u&&E(e)}}}function dt(t){let e;function n(c,i){return c[1].isError?Dn:On}let r=n(t),o=r(t);return{c(){o.c(),e=yt()},m(c,i){o.m(c,i),H(c,e,i)},p(c,i){r===(r=n(c))&&o?o.p(c,i):(o.d(1),o=r(c),o&&(o.c(),o.m(e.parentNode,e)))},d(c){c&&E(e),o.d(c)}}}function jn(t){let e,n,r,o,c=ge(t[0]),i=[];for(let l=0;l<c.length;l+=1)i[l]=dt(ut(t,c,l));return{c(){e=m("div"),n=m("div"),n.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',r=P(),o=m("ol");for(let l=0;l<i.length;l+=1)i[l].c();f(n,"class","absolute right-2 top-2"),f(o,"id","message_list"),f(o,"class","h-full w-[105%] list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),f(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(l,a){H(l,e,a),p(e,n),p(e,r),p(e,o);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(o,null)},p(l,[a]){if(a&1){c=ge(l[0]);let u;for(u=0;u<c.length;u+=1){const d=ut(l,c,u);i[u]?i[u].p(d,a):(i[u]=dt(d),i[u].c(),i[u].m(o,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=c.length}},i:A,o:A,d(l){l&&E(e),je(i,l)}}}function Un(t,e,n){let r;return X(t,be,o=>n(0,r=o)),[r]}class Bn extends oe{constructor(e){super(),re(this,e,Un,jn,ne,{})}}function ft(t,e,n){const r=t.slice();return r[13]=e[n],r}function qn(t){let e,n,r;return{c(){e=m("button"),e.textContent="Plugin menu",e.disabled=!fe(Be),f(e,"class","mx-auto mb-2 w-52 rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(o,c){H(o,e,c),n||(r=O(e,"click",t[8]),n=!0)},p:A,d(o){o&&E(e),n=!1,r()}}}function Jn(t){let e,n,r,o,c,i,l,a,u;return{c(){e=m("label"),e.textContent="Game Client",n=P(),r=m("br"),o=P(),c=m("select"),i=m("option"),i.textContent="RuneLite",l=m("option"),l.textContent="HDOS",f(e,"for","game_client_select"),f(e,"class","text-sm"),f(i,"data-id",ae.runeLite),f(i,"class","dark:bg-slate-900"),i.__value="RuneLite",xe(i,i.__value),f(l,"data-id",ae.hdos),f(l,"class","dark:bg-slate-900"),l.__value="HDOS",xe(l,l.__value),f(c,"id","game_client_select"),f(c,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800")},m(d,h){H(d,e,h),H(d,n,h),H(d,r,h),H(d,o,h),H(d,c,h),p(c,i),p(c,l),t[7](c),a||(u=O(c,"change",t[5]),a=!0)},p:A,d(d){d&&(E(e),E(n),E(r),E(o),E(c)),t[7](null),a=!1,u()}}}function pt(t){let e,n=ge(t[4].account.characters),r=[];for(let o=0;o<n.length;o+=1)r[o]=ht(ft(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=yt()},m(o,c){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(o,c);H(o,e,c)},p(o,c){if(c&16){n=ge(o[4].account.characters);let i;for(i=0;i<n.length;i+=1){const l=ft(o,n,i);r[i]?r[i].p(l,c):(r[i]=ht(l),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(o){o&&E(e),je(r,o)}}}function Gn(t){let e;return{c(){e=Z("New Character")},m(n,r){H(n,e,r)},p:A,d(n){n&&E(e)}}}function Xn(t){let e=t[13][1].displayName+"",n;return{c(){n=Z(e)},m(r,o){H(r,n,o)},p(r,o){o&16&&e!==(e=r[13][1].displayName+"")&&_e(n,e)},d(r){r&&E(n)}}}function ht(t){let e,n,r,o;function c(a,u){return a[13][1].displayName?Xn:Gn}let i=c(t),l=i(t);return{c(){e=m("option"),l.c(),n=P(),f(e,"data-id",r=t[13][1].accountId),f(e,"class","dark:bg-slate-900"),e.__value=o=`
						`+t[13][1].displayName+`
					`,xe(e,e.__value)},m(a,u){H(a,e,u),l.m(e,null),p(e,n)},p(a,u){i===(i=c(a))&&l?l.p(a,u):(l.d(1),l=i(a),l&&(l.c(),l.m(e,n))),u&16&&r!==(r=a[13][1].accountId)&&f(e,"data-id",r),u&16&&o!==(o=`
						`+a[13][1].displayName+`
					`)&&(e.__value=o,xe(e,e.__value))},d(a){a&&E(e),l.d()}}}function $n(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w;function L(y,N){if(y[4].game==W.osrs)return Jn;if(y[4].game==W.rs3)return qn}let x=L(t),_=x&&x(t),k=t[4].account&&pt(t);return{c(){e=m("div"),n=m("img"),o=P(),c=m("button"),c.textContent="Play",i=P(),l=m("div"),_&&_.c(),a=P(),u=m("div"),d=m("label"),d.textContent="Character",h=P(),g=m("br"),v=P(),b=m("select"),k&&k.c(),Ht(n.src,r="svgs/rocket-solid.svg")||f(n,"src",r),f(n,"alt","Launch icon"),f(n,"class","mx-auto mb-5 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),f(c,"class","mx-auto mb-2 w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(l,"class","mx-auto my-2"),f(d,"for","character_select"),f(d,"class","text-sm"),f(b,"id","character_select"),f(b,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),f(u,"class","mx-auto my-2"),f(e,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(y,N){H(y,e,N),p(e,n),p(e,o),p(e,c),p(e,i),p(e,l),_&&_.m(l,null),p(e,a),p(e,u),p(u,d),p(u,h),p(u,g),p(u,v),p(u,b),k&&k.m(b,null),t[9](b),M||(w=[O(c,"click",t[6]),O(b,"change",t[10])],M=!0)},p(y,[N]){x===(x=L(y))&&_?_.p(y,N):(_&&_.d(1),_=x&&x(y),_&&(_.c(),_.m(l,null))),y[4].account?k?k.p(y,N):(k=pt(y),k.c(),k.m(b,null)):k&&(k.d(1),k=null)},i:A,o:A,d(y){y&&E(e),_&&_.d(),k&&k.d(),t[9](null),M=!1,ce(w)}}}function zn(t,e,n){let r,o,c;X(t,F,w=>n(4,r=w)),X(t,B,w=>n(11,o=w)),X(t,$,w=>n(12,c=w));let{showPluginMenu:i=!1}=e,l,a;function u(){var L,x;if(!r.account)return;const w=l[l.selectedIndex].getAttribute("data-id");I(F,r.character=r.account.characters.get(w),r),r.character&&((x=o.selected_characters)==null||x.set(r.account.userId,(L=r.character)==null?void 0:L.accountId)),I($,c=!0,c)}function d(){a.value=="RuneLite"?(I(F,r.client=ae.runeLite,r),I(B,o.selected_client_index=ae.runeLite,o)):a.value=="HDOS"&&(I(F,r.client=ae.hdos,r),I(B,o.selected_client_index=ae.hdos,o)),I($,c=!0,c)}function h(){var w,L,x,_,k,y,N,V,C;if(!r.account||!r.character){G("Please log in to launch a client");return}switch(r.game){case W.osrs:r.client==ae.runeLite?rn((w=r.credentials)==null?void 0:w.session_id,(L=r.character)==null?void 0:L.accountId,(x=r.character)==null?void 0:x.displayName):r.client==ae.hdos&&ln((_=r.credentials)==null?void 0:_.session_id,(k=r.character)==null?void 0:k.accountId,(y=r.character)==null?void 0:y.displayName);break;case W.rs3:sn((N=r.credentials)==null?void 0:N.session_id,(V=r.character)==null?void 0:V.accountId,(C=r.character)==null?void 0:C.displayName);break}}Dt(()=>{var w;if(r.game==W.osrs&&r.client&&n(3,a.selectedIndex=r.client,a),r.account&&((w=o.selected_characters)!=null&&w.has(r.account.userId)))for(let L=0;L<l.options.length;L++)l[L].getAttribute("data-id")==o.selected_characters.get(r.account.userId)&&n(2,l.selectedIndex=L,l)}),Ee(()=>{o.selected_game_index==W.osrs&&(n(3,a.selectedIndex=o.selected_client_index,a),I(F,r.client=a.selectedIndex,r))});function g(w){q[w?"unshift":"push"](()=>{a=w,n(3,a)})}const v=()=>{n(0,i=fe(Be)??!1)};function b(w){q[w?"unshift":"push"](()=>{l=w,n(2,l)})}const M=()=>u();return t.$$set=w=>{"showPluginMenu"in w&&n(0,i=w.showPluginMenu)},[i,u,l,a,r,d,h,g,v,b,M]}class Fn extends oe{constructor(e){super(),re(this,e,zn,$n,ne,{showPluginMenu:0,characterChanged:1})}get characterChanged(){return this.$$.ctx[1]}}function Vn(t){let e;return{c(){e=m("div"),e.innerHTML='<img src="svgs/circle-notch-solid.svg" alt="" class="mx-auto h-1/6 w-1/6 animate-spin"/>',f(e,"class","container mx-auto bg-slate-100 p-5 text-center text-slate-900 dark:bg-slate-900 dark:text-slate-50")},m(n,r){H(n,e,r)},p:A,i:A,o:A,d(n){n&&E(e)}}}class Wn extends oe{constructor(e){super(),re(this,e,null,Vn,ne,{})}}function Zn(t,e,n){const r=t.slice();return r[4]=e[n],r}function Yn(t){let e,n,r;return{c(){e=m("button"),e.textContent=`${t[4]}`,n=P(),r=m("br"),f(e,"class","m-1 h-[28px] w-[95%] rounded-lg border-2 border-blue-500 duration-200 hover:opacity-75")},m(o,c){H(o,e,c),H(o,n,c),H(o,r,c)},p:A,d(o){o&&(E(e),E(n),E(r))}}}function Kn(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w;n=new nt({}),n.$on("click",t[1]);let L=ge(["Client 1","Client 2","Client 3"]),x=[];for(let _=0;_<3;_+=1)x[_]=Yn(Zn(t,L,_));return{c(){e=m("div"),te(n.$$.fragment),r=P(),o=m("div"),c=m("button"),c.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',i=P(),l=m("div"),a=m("button"),a.textContent="Manage Plugins",u=P(),d=m("hr"),h=P();for(let _=0;_<3;_+=1)x[_].c();g=P(),v=m("div"),v.innerHTML="<p>menu</p>",f(c,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),f(a,"class","mx-auto mb-2 w-[95%] rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(d,"class","p-1 dark:border-slate-700"),f(l,"class","left-0 float-left h-full w-[min(180px,_50%)] overflow-hidden border-r-2 border-slate-300 pt-2 dark:border-slate-800"),f(v,"class","h-full pt-10"),f(o,"class","absolute left-[5%] top-[5%] z-20 h-[90%] w-[90%] rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900"),f(e,"id","plugins")},m(_,k){H(_,e,k),K(n,e,null),p(e,r),p(e,o),p(o,c),p(o,i),p(o,l),p(l,a),p(l,u),p(l,d),p(l,h);for(let y=0;y<3;y+=1)x[y]&&x[y].m(l,null);p(o,g),p(o,v),b=!0,M||(w=[O(c,"click",t[2]),O(a,"click",Qn)],M=!0)},p:A,i(_){b||(D(n.$$.fragment,_),b=!0)},o(_){U(n.$$.fragment,_),b=!1},d(_){_&&E(e),Q(n),je(x,_),M=!1,ce(w)}}}const Qn=()=>{};function es(t,e,n){let{showPluginMenu:r}=e;function o(l){l.key==="Escape"&&n(0,r=!1)}addEventListener("keydown",o),Ke(()=>{removeEventListener("keydown",o)});const c=()=>{n(0,r=!1)},i=()=>{n(0,r=!1)};return t.$$set=l=>{"showPluginMenu"in l&&n(0,r=l.showPluginMenu)},[r,c,i]}class ts extends oe{constructor(e){super(),re(this,e,es,Kn,ne,{showPluginMenu:0})}}function ns(t){let e,n,r,o,c,i,l,a,u,d,h,g,v,b,M,w,L=t[1]&&_t(t),x=t[0]&&gt(t),_=t[3]&&bt();function k(C){t[6](C)}let y={};t[0]!==void 0&&(y.showSettings=t[0]),o=new _n({props:y}),q.push(()=>Te(o,"showSettings",k));function N(C){t[7](C)}let V={};return t[1]!==void 0&&(V.showPluginMenu=t[1]),d=new Fn({props:V}),q.push(()=>Te(d,"showPluginMenu",N)),M=new Bn({}),{c(){L&&L.c(),e=P(),x&&x.c(),n=P(),_&&_.c(),r=P(),te(o.$$.fragment),i=P(),l=m("div"),a=m("div"),u=P(),te(d.$$.fragment),g=P(),v=m("div"),b=P(),te(M.$$.fragment),f(l,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(C,S){L&&L.m(C,S),H(C,e,S),x&&x.m(C,S),H(C,n,S),_&&_.m(C,S),H(C,r,S),K(o,C,S),H(C,i,S),H(C,l,S),p(l,a),p(l,u),K(d,l,null),p(l,g),p(l,v),H(C,b,S),K(M,C,S),w=!0},p(C,S){C[1]?L?(L.p(C,S),S&2&&D(L,1)):(L=_t(C),L.c(),D(L,1),L.m(e.parentNode,e)):L&&(Se(),U(L,1,1,()=>{L=null}),Le()),C[0]?x?(x.p(C,S),S&1&&D(x,1)):(x=gt(C),x.c(),D(x,1),x.m(n.parentNode,n)):x&&(Se(),U(x,1,1,()=>{x=null}),Le()),C[3]?_?S&8&&D(_,1):(_=bt(),_.c(),D(_,1),_.m(r.parentNode,r)):_&&(Se(),U(_,1,1,()=>{_=null}),Le());const R={};!c&&S&1&&(c=!0,R.showSettings=C[0],Pe(()=>c=!1)),o.$set(R);const ee={};!h&&S&2&&(h=!0,ee.showPluginMenu=C[1],Pe(()=>h=!1)),d.$set(ee)},i(C){w||(D(L),D(x),D(_),D(o.$$.fragment,C),D(d.$$.fragment,C),D(M.$$.fragment,C),w=!0)},o(C){U(L),U(x),U(_),U(o.$$.fragment,C),U(d.$$.fragment,C),U(M.$$.fragment,C),w=!1},d(C){C&&(E(e),E(n),E(r),E(i),E(l),E(b)),L&&L.d(C),x&&x.d(C),_&&_.d(C),Q(o,C),Q(d),Q(M,C)}}}function ss(t){let e,n;return e=new Wn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},p:A,i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function _t(t){let e,n,r;function o(i){t[4](i)}let c={};return t[1]!==void 0&&(c.showPluginMenu=t[1]),e=new ts({props:c}),q.push(()=>Te(e,"showPluginMenu",o)),{c(){te(e.$$.fragment)},m(i,l){K(e,i,l),r=!0},p(i,l){const a={};!n&&l&2&&(n=!0,a.showPluginMenu=i[1],Pe(()=>n=!1)),e.$set(a)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){U(e.$$.fragment,i),r=!1},d(i){Q(e,i)}}}function gt(t){let e,n,r;function o(i){t[5](i)}let c={};return t[0]!==void 0&&(c.showSettings=t[0]),e=new Nn({props:c}),q.push(()=>Te(e,"showSettings",o)),{c(){te(e.$$.fragment)},m(i,l){K(e,i,l),r=!0},p(i,l){const a={};!n&&l&1&&(n=!0,a.showSettings=i[0],Pe(()=>n=!1)),e.$set(a)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){U(e.$$.fragment,i),r=!1},d(i){Q(e,i)}}}function bt(t){let e,n;return e=new kn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(D(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function rs(t){let e,n,r,o;const c=[ss,ns],i=[];function l(a,u){return a[2]?0:1}return n=l(t),r=i[n]=c[n](t),{c(){e=m("main"),r.c(),f(e,"class","h-full")},m(a,u){H(a,e,u),i[n].m(e,null),o=!0},p(a,[u]){let d=n;n=l(a),n===d?i[n].p(a,u):(Se(),U(i[d],1,1,()=>{i[d]=null}),Le(),r=i[n],r?r.p(a,u):(r=i[n]=c[n](a),r.c()),D(r,1),r.m(e,null))},i(a){o||(D(r),o=!0)},o(a){U(r),o=!1},d(a){a&&E(e),i[n].d()}}}function os(t,e,n){let r;X(t,Oe,g=>n(3,r=g));let o=!1,c=!1,i=!1;Zt();const l=window.opener||window.parent;if(l){const g=new URLSearchParams(window.location.search);g.get("id_token")?(i=!0,l.postMessage({type:"gameSessionServerAuth",code:g.get("code"),id_token:g.get("id_token"),state:g.get("state")},"*")):g.get("code")&&(i=!0,l.postMessage({type:"authCode",code:g.get("code"),state:g.get("state")},"*"))}function a(g){c=g,n(1,c)}function u(g){o=g,n(0,o)}function d(g){o=g,n(0,o)}function h(g){c=g,n(1,c)}return[o,c,i,r,a,u,d,h]}class ls extends oe{constructor(e){super(),re(this,e,os,rs,ne,{})}}new ls({target:document.getElementById("app")});const le=[],cs=fe(zt);let z;le.push(Qe.subscribe(t=>z=t));let se;le.push(B.subscribe(t=>se=t));le.push(et.subscribe(t=>t));let de;le.push(he.subscribe(t=>de=t));le.push(Be.subscribe(t=>t??!1));let ie;le.push(qe.subscribe(t=>ie=t));let st;le.push(tt.subscribe(t=>st=t));le.push(be.subscribe(t=>t));le.push(Ne.subscribe(t=>t));let De;le.push(F.subscribe(t=>De=t));function is(){var o;const t=atob(z.origin),e=atob(z.clientid),n=t.concat("/oauth2/token");de.size==0&&Oe.set(!0),Vt(),se.selected_game_accounts&&((o=se.selected_game_accounts)==null?void 0:o.size)>0&&B.update(c=>{var i;return c.selected_characters=c.selected_game_accounts,(i=c.selected_game_accounts)==null||i.clear(),c});const r=[cs,t,atob(z.origin_2fa)];window.addEventListener("message",c=>{if(!r.includes(c.origin)){G(`discarding window message from origin ${c.origin}`);return}let i=ie;const l=new XMLHttpRequest;switch(c.data.type){case"authCode":if(i){qe.set({});const a=new URLSearchParams({grant_type:"authorization_code",client_id:atob(z.clientid),code:c.data.code,code_verifier:i.verifier,redirect_uri:atob(z.redirect)});l.onreadystatechange=()=>{if(l.readyState==4)if(l.status==200){const u=Mt(l.response),d=Lt(u);d?lt(i==null?void 0:i.win,d).then(h=>{h&&(he.update(g=>(g.set(d.sub,d),g)),Ce())}):(J("Error: invalid credentials received",!1),i.win.close())}else J(`Error: from ${n}: ${l.status}: ${l.response}`,!1),i.win.close()},l.open("POST",n,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader("Accept","application/json"),l.send(a)}break;case"initAuth":G(`message: init auth: ${c.data.auth_method}`);break;case"externalUrl":l.onreadystatechange=()=>{l.readyState==4&&G(`External URL status: '${l.responseText.trim()}'`)},l.open("POST","/open-external-url",!0),l.send(c.data.url);break;case"gameSessionServerAuth":if(i=st.find(a=>c.data.state==a.state),i){Wt(i,!0);const a=c.data.id_token.split(".");if(a.length!==3){J(`Malformed id_token: ${a.length} sections, expected 3`,!1);break}const u=JSON.parse(atob(a[0]));if(u.typ!=="JWT"){J(`Bad id_token header: typ ${u.typ}, expected JWT`,!1);break}const d=JSON.parse(atob(a[1]));if(atob(d.nonce)!==i.nonce){J("Incorrect nonce in id_token",!1);break}const h=atob(z.auth_api).concat("/sessions");l.onreadystatechange=()=>{if(l.readyState==4)if(l.status==200){const g=atob(z.auth_api).concat("/accounts");i.creds.session_id=JSON.parse(l.response).sessionId,Pt(i.creds,g,i.account_info_promise).then(v=>{v&&(he.update(b=>{var M;return b.set((M=i==null?void 0:i.creds)==null?void 0:M.sub,i.creds),b}),Ce())})}else J(`Error: from ${h}: ${l.status}: ${l.response}`,!1)},l.open("POST",h,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Accept","application/json"),l.send(`{"idToken": "${c.data.id_token}"}`)}break;default:G("Unknown message type: ".concat(c.data.type));break}}),(async()=>(de.size>0&&de.forEach(async c=>{const i=await Ct(c,n,e);i!==null&&i!==0&&(J(`Discarding expired login for #${c.sub}`,!1),he.update(a=>(a.delete(c.sub),a)),Ce());let l;if(i===null&&await lt(null,c)?l={creds:c,valid:!0}:l={creds:c,valid:i===0},l.valid){const a=c;he.update(u=>(u.set(a.sub,a),u)),Ce()}}),$.set(!1)))()}function G(t){console.log(t);const e={isError:!1,text:t,time:new Date(Date.now())};be.update(n=>(n.unshift(e),n))}function J(t,e){const n={isError:!0,text:t,time:new Date(Date.now())};if(be.update(r=>(r.unshift(n),r)),!e)console.error(t);else throw new Error(t)}Qe.set(s());onload=()=>is();onunload=()=>{for(const t in le)delete le[t];Je()};
