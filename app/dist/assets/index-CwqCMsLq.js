var Bt=Object.defineProperty;var Jt=(t,e,n)=>e in t?Bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ze=(t,e,n)=>(Jt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function j(){}function Gt(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Tt(t){return t()}function at(){return Object.create(null)}function ie(t){t.forEach(Tt)}function Pt(t){return typeof t=="function"}function ne(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ae;function Xt(t,e){return t===e?!0:(Ae||(Ae=document.createElement("a")),Ae.href=e,t===Ae.href)}function $t(t){return Object.keys(t).length===0}function Mt(t,...e){if(t==null){for(const r of e)r(void 0);return j}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function le(t){let e;return Mt(t,n=>e=n)(),e}function $(t,e,n){t.$$.on_destroy.push(Mt(e,n))}function N(t,e,n){return t.set(n),e}function _(t,e){t.appendChild(e)}function P(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode&&t.parentNode.removeChild(t)}function He(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function M(){return F(" ")}function Ne(){return F("")}function O(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function zt(t){return Array.from(t.childNodes)}function pe(t,e){e=""+e,t.data!==e&&(t.data=e)}function ge(t,e){t.value=e??""}function Ft(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Me;function fe(t){Me=t}function je(){if(!Me)throw new Error("Function called outside component initialization");return Me}function Oe(t){je().$$.on_mount.push(t)}function Vt(t){je().$$.after_update.push(t)}function nt(t){je().$$.on_destroy.push(t)}function Wt(){const t=je();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const l=Ft(e,n,{cancelable:r});return o.slice().forEach(c=>{c.call(t,l)}),!l.defaultPrevented}return!0}}const xe=[],B=[];let Ce=[];const We=[],Zt=Promise.resolve();let Ze=!1;function Yt(){Ze||(Ze=!0,Zt.then(st))}function Ye(t){Ce.push(t)}function Ee(t){We.push(t)}const Fe=new Set;let Se=0;function st(){if(Se!==0)return;const t=Me;do{try{for(;Se<xe.length;){const e=xe[Se];Se++,fe(e),Kt(e.$$)}}catch(e){throw xe.length=0,Se=0,e}for(fe(null),xe.length=0,Se=0;B.length;)B.pop()();for(let e=0;e<Ce.length;e+=1){const n=Ce[e];Fe.has(n)||(Fe.add(n),n())}Ce.length=0}while(xe.length);for(;We.length;)We.pop()();Ze=!1,Fe.clear(),fe(t)}function Kt(t){if(t.fragment!==null){t.update(),ie(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ye)}}function Qt(t){const e=[],n=[];Ce.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ce=e}const De=new Set;let be;function ke(){be={r:0,c:[],p:be}}function we(){be.r||ie(be.c),be=be.p}function A(t,e){t&&t.i&&(De.delete(t),t.i(e))}function D(t,e,n,r){if(t&&t.o){if(De.has(t))return;De.add(t),be.c.push(()=>{De.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function ut(t,e){const n=e.token={};function r(o,l,c,i){if(e.token!==n)return;e.resolved=i;let u=e.ctx;c!==void 0&&(u=u.slice(),u[c]=i);const a=o&&(e.current=o)(u);let d=!1;e.block&&(e.blocks?e.blocks.forEach((f,p)=>{p!==l&&f&&(ke(),D(f,1,1,()=>{e.blocks[p]===f&&(e.blocks[p]=null)}),we())}):e.block.d(1),a.c(),A(a,1),a.m(e.mount(),e.anchor),d=!0),e.block=a,e.blocks&&(e.blocks[l]=a),d&&st()}if(Gt(t)){const o=je();if(t.then(l=>{fe(o),r(e.then,1,e.value,l),fe(null)},l=>{if(fe(o),r(e.catch,2,e.error,l),fe(null),!e.hasCatch)throw l}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function en(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function de(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ie(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function te(t){t&&t.c()}function K(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),Ye(()=>{const l=t.$$.on_mount.map(Tt).filter(Pt);t.$$.on_destroy?t.$$.on_destroy.push(...l):ie(l),t.$$.on_mount=[]}),o.forEach(Ye)}function Q(t,e){const n=t.$$;n.fragment!==null&&(Qt(n.after_update),ie(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function tn(t,e){t.$$.dirty[0]===-1&&(xe.push(t),Yt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function re(t,e,n,r,o,l,c=null,i=[-1]){const u=Me;fe(t);const a=t.$$={fragment:null,ctx:[],props:l,update:j,not_equal:o,bound:at(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:at(),dirty:i,skip_bound:!1,root:e.target||u.$$.root};c&&c(a.root);let d=!1;if(a.ctx=n?n(t,e.props||{},(f,p,...m)=>{const g=m.length?m[0]:p;return a.ctx&&o(a.ctx[f],a.ctx[f]=g)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](g),d&&tn(t,f)),p}):[],a.update(),d=!0,ie(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const f=zt(e.target);a.fragment&&a.fragment.l(f),f.forEach(R)}else a.fragment&&a.fragment.c();e.intro&&A(t.$$.fragment),K(t,e.target,e.anchor),st()}fe(u)}class oe{constructor(){ze(this,"$$");ze(this,"$$set")}$destroy(){Q(this,1),this.$destroy=j}$on(e,n){if(!Pt(n))return j;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!$t(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const nn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nn);const Le=[];function Et(t,e){return{subscribe:Z(t,e).subscribe}}function Z(t,e=j){let n;const r=new Set;function o(i){if(ne(t,i)&&(t=i,n)){const u=!Le.length;for(const a of r)a[1](),Le.push(a,t);if(u){for(let a=0;a<Le.length;a+=2)Le[a][0](Le[a+1]);Le.length=0}}}function l(i){o(i(t))}function c(i,u=j){const a=[i,u];return r.add(a),r.size===1&&(n=e(o,l)||j),i(t),()=>{r.delete(a),r.size===0&&n&&(n(),n=null)}}return{set:o,update:l,subscribe:c}}function It(t){if(t.ok)return t.value;throw t.error}var Y=(t=>(t[t.rs3=0]="rs3",t[t.osrs=1]="osrs",t))(Y||{}),ue=(t=>(t[t.runeLite=0]="runeLite",t[t.hdos=1]="hdos",t[t.rs3=2]="rs3",t))(ue||{});const sn={use_dark_theme:!0,flatpak_rich_presence:!1,rs_config_uri:"",runelite_custom_jar:"",runelite_use_custom_jar:!1,selected_account:"",selected_characters:new Map,selected_game_accounts:new Map,selected_game_index:1,selected_client_index:1},Ht=Et("https://bolt-internal"),rn=Et("1fddee4e-b100-4f4e-b2b0-097f9088f9d2"),rt=Z(),Ge=Z(""),U=Z({...sn}),me=Z(new Map),Re=Z(!1),Pe=Z(),Ke=Z(),ye=Z([]),Xe=Z({}),ot=Z([]),Qe=Z(""),et=Z(""),tt=Z(""),z=Z(!1),Ue=Z(new Map),W=Z({game:Y.osrs,client:ue.runeLite}),Be=Z(!1);function on(){se.use_dark_theme==!1&&document.documentElement.classList.remove("dark")}function ln(t,e){e&&t.win.close(),ot.update(n=>(n.splice(ct.indexOf(t),1),n))}function Nt(){if(ae&&ae.win&&!ae.win.closed)ae.win.focus();else if(ae&&ae.win&&ae.win.closed||ae){const t=At(),e=un();an({origin:atob(V.origin),redirect:atob(V.redirect),authMethod:"",loginType:"",clientid:atob(V.clientid),flow:"launcher",pkceState:t,pkceCodeVerifier:e}).then(n=>{const r=window.open(n,"","width=480,height=720");Xe.set({state:t,verifier:e,win:r})})}}function cn(){const t=new URLSearchParams(window.location.search);Ge.set(t.get("platform")),t.get("flathub"),Qe.set(t.get("rs3_linux_installed_hash")),et.set(t.get("runelite_installed_id")),tt.set(t.get("hdos_installed_version"));const e=t.get("plugins");e!==null?(Re.set(!0),Pe.set(JSON.parse(e))):Re.set(!1);const n=t.get("credentials");if(n)try{JSON.parse(n).forEach(l=>{me.update(c=>(c.set(l.sub,l),c))})}catch(o){G(`Couldn't parse credentials file: ${o}`,!1)}const r=t.get("config");if(r)try{const o=JSON.parse(r);U.set(o),U.update(l=>(l.selected_game_accounts?(l.selected_characters=new Map(Object.entries(l.selected_game_accounts)),delete l.selected_game_accounts):l.selected_characters&&(l.selected_characters=new Map(Object.entries(l.selected_characters))),l))}catch(o){G(`Couldn't parse config file: ${o}`,!1)}}async function jt(t,e,n){return new Promise(r=>{if(t.expiry-Date.now()<3e4){const o=new URLSearchParams({grant_type:"refresh_token",client_id:n,refresh_token:t.refresh_token}),l=new XMLHttpRequest;l.onreadystatechange=()=>{if(l.readyState==4)if(l.status==200){const c=Ot(l.response),i=It(c);i?(t.access_token=i.access_token,t.expiry=i.expiry,t.id_token=i.id_token,t.login_provider=i.login_provider,t.refresh_token=i.refresh_token,i.session_id&&(t.session_id=i.session_id),t.sub=i.sub,r(null)):r(0)}else r(l.status)},l.onerror=()=>{r(0)},l.open("POST",e,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader("Accept","application/json"),l.send(o)}else r(null)})}function Ot(t){const e=JSON.parse(t),n=e.id_token.split(".");if(n.length!==3){const l=`Malformed id_token: ${n.length} sections, expected 3`;return G(l,!1),{ok:!1,error:new Error(l)}}const r=JSON.parse(atob(n[0]));if(r.typ!=="JWT"){const l=`Bad id_token header: typ ${r.typ}, expected JWT`;return G(l,!1),{ok:!1,error:new Error(l)}}const o=JSON.parse(atob(n[1]));return{ok:!0,value:{access_token:e.access_token,id_token:e.id_token,refresh_token:e.refresh_token,sub:o.sub,login_provider:o.login_provider||null,expiry:Date.now()+e.expires_in*1e3,session_id:e.session_id}}}async function an(t){const e=new TextEncoder().encode(t.pkceCodeVerifier),n=await crypto.subtle.digest("SHA-256",e);let r="";const o=new Uint8Array(n);for(let c=0;c<o.byteLength;c++)r+=String.fromCharCode(o[c]);const l=btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return t.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:t.authMethod,login_type:t.loginType,flow:t.flow,response_type:"code",client_id:t.clientid,redirect_uri:t.redirect,code_challenge:l,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:t.pkceState}).toString())}function un(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=new Uint32Array(43);return crypto.getRandomValues(e),Array.from(e,function(n){return t[n%t.length]}).join("")}function At(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e.length-1,r=crypto.getRandomValues(new Uint8Array(12));return Array.from(r).map(o=>Math.round(o*(n-0)/255+0)).map(o=>e[o]).join("")}async function Dt(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState==4&&(o.status==200?n.then(l=>{if(typeof l!="number"){const c={id:l.id,userId:l.userId,displayName:l.displayName,suffix:l.suffix,characters:new Map};X(`Successfully added login for ${c.displayName}`),JSON.parse(o.response).forEach(i=>{c.characters.set(i.accountId,{accountId:i.accountId,displayName:i.displayName,userHash:i.userHash})}),pn(c),r(!0)}else G(`Error getting account info: ${l}`,!1),r(!1)}):(G(`Error: from ${e}: ${o.status}: ${o.response}`,!1),r(!1)))},o.open("GET",e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(t.session_id)),o.send()})}async function dt(t,e){return await dn(t,e)}async function dn(t,e){const n=At(),r=crypto.randomUUID(),o=atob(V.origin).concat("/oauth2/auth?").concat(new URLSearchParams({id_token_hint:e.id_token,nonce:btoa(r),prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:n,client_id:le(rn),scope:"openid offline"}).toString()),l=fn(e);return t?(t.location.href=o,ot.update(c=>(c.push({state:n,nonce:r,creds:e,win:t,account_info_promise:l}),c)),!1):e.session_id?await Dt(e,atob(V.auth_api).concat("/accounts"),l):(G("Rejecting stored credentials with missing session_id",!1),!1)}function fn(t){return new Promise(e=>{const n=`${atob(V.api)}/users/${t.sub}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{r.readyState==4&&(r.status==200?e(JSON.parse(r.response)):e(r.status))},r.open("GET",n,!0),r.setRequestHeader("Authorization","Bearer ".concat(t.access_token)),r.send()})}function pn(t){const e=()=>{W.update(n=>{n.account=t;const[r]=t.characters.keys();return n.character=t.characters.get(r),_e.size>0&&(n.credentials=_e.get(t.userId)),n})};Ue.update(n=>(n.set(t.userId,t),n)),Je.account&&se.selected_account?t.userId==se.selected_account&&e():Je.account||e(),Xe.set({})}function hn(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.open("POST",e,!0),o.onreadystatechange=()=>{o.readyState==4&&r(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(new URLSearchParams({token:t,client_id:n}))})}async function Te(){const t=new XMLHttpRequest;t.open("POST","/save-credentials",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{t.readyState==4&&X(`Save-credentials status: ${t.responseText.trim()}`)},W.update(n=>{var r;return n.credentials=_e.get((r=Je.account)==null?void 0:r.userId),n});const e=[];_e.forEach(n=>{e.push(n)}),t.send(JSON.stringify(e))}function _n(t,e,n){$e();const r=(i,u)=>{const a=new XMLHttpRequest,d={};i&&(d.hash=i),t&&(d.jx_session_id=t),e&&(d.jx_character_id=e),n&&(d.jx_display_name=n),se.rs_config_uri?d.config_uri=se.rs_config_uri:d.config_uri=atob(V.default_config_uri),a.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(d).toString()),!0),a.onreadystatechange=()=>{a.readyState==4&&(X(`Game launch status: '${a.responseText.trim()}'`),a.status==200&&i&&Qe.set(i))},a.send(u)},o=new XMLHttpRequest,l=atob(V.content_url),c=l.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",c,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const i=Object.fromEntries(o.response.split(`
`).map(u=>u.split(": ")));if(!i.Filename||!i.Size){G(`Could not parse package data from URL: ${c}`,!1),r();return}if(i.SHA256!==le(Qe)){X("Downloading RS3 client...");const u=new XMLHttpRequest;u.open("GET",l.concat(i.Filename),!0),u.responseType="arraybuffer",u.onprogress=a=>{a.loaded&&ye.update(d=>(d[0].text=`Downloading RS3 client... ${(Math.round(1e3*a.loaded/a.total)/10).toFixed(1)}%`,d))},u.onreadystatechange=()=>{u.readyState==4&&u.status==200&&r(i.SHA256,u.response)},u.onerror=()=>{G(`Error downloading game client: from ${c}: non-http error`,!1),r()},u.send()}else X("Latest client is already installed"),r()}},o.onerror=()=>{G(`Error: from ${c}: non-http error`,!1),r()},o.send()}function qt(t,e,n,r){$e();const o=r?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",l=(u,a,d)=>{const f=new XMLHttpRequest,p={};u&&(p.id=u),d&&(p.jar_path=d),t&&(p.jx_session_id=t),e&&(p.jx_character_id=e),n&&(p.jx_display_name=n),se.flatpak_rich_presence&&(p.flatpak_rich_presence=""),f.open(a?"POST":"GET",o.concat(new URLSearchParams(p).toString()),!0),f.onreadystatechange=()=>{f.readyState==4&&(X(`Game launch status: '${f.responseText.trim()}'`),f.status==200&&u&&et.set(u))},f.send(a)};if(se.runelite_use_custom_jar){l(null,null,se.runelite_custom_jar);return}const c=new XMLHttpRequest,i="https://api.github.com/repos/runelite/launcher/releases";c.open("GET",i,!0),c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const u=JSON.parse(c.responseText).map(a=>a.assets).flat().find(a=>a.name.toLowerCase()=="runelite.jar");if(u.id!=le(et)){X("Downloading RuneLite...");const a=new XMLHttpRequest;a.open("GET",u.browser_download_url,!0),a.responseType="arraybuffer",a.onreadystatechange=()=>{a.readyState==4&&(a.status==200?l(u.id,a.response):G(`Error downloading from ${u.url}: ${a.status}: ${a.responseText}`,!1))},a.onprogress=d=>{d.loaded&&d.lengthComputable&&ye.update(f=>(f[0].text=`Downloading RuneLite... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,f))},a.send()}else X("Latest JAR is already installed"),l()}else G(`Error from ${i}: ${c.status}: ${c.responseText}`,!1)},c.send()}function gn(t,e,n){return qt(t,e,n,!1)}function bn(t,e,n){return qt(t,e,n,!0)}function mn(t,e,n){$e();const r=(c,i)=>{const u=new XMLHttpRequest,a={};c&&(a.version=c),t&&(a.jx_session_id=t),e&&(a.jx_character_id=e),n&&(a.jx_display_name=n),u.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(a).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(X(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&c&&tt.set(c))},u.send(i)},o=new XMLHttpRequest,l="https://cdn.hdos.dev/client/getdown.txt";o.open("GET",l,!0),o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const c=o.responseText.match(/^launcher\.version *= *(.*?)$/m);if(c&&c.length>=2){const i=c[1];if(i!==le(tt)){const u=`https://cdn.hdos.dev/launcher/v${i}/hdos-launcher.jar`;X("Downloading HDOS...");const a=new XMLHttpRequest;a.open("GET",u,!0),a.responseType="arraybuffer",a.onreadystatechange=()=>{if(a.readyState==4)if(a.status==200)r(i,a.response);else{const d=JSON.parse(o.responseText).map(f=>f.assets).flat().find(f=>f.name.toLowerCase()=="runelite.jar");G(`Error downloading from ${d.url}: ${a.status}: ${a.responseText}`,!1)}},a.onprogress=d=>{d.loaded&&d.lengthComputable&&ye.update(f=>(f[0].text=`Downloading HDOS... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,f))},a.send()}else X("Latest JAR is already installed"),r()}else X("Couldn't parse latest launcher version"),r()}else G(`Error from ${l}: ${o.status}: ${o.responseText}`,!1)},o.send()}let Ve=!1;function $e(){var t;if(le(z)&&!Ve){Ve=!0;const e=new XMLHttpRequest;e.open("POST","/save-config",!0),e.onreadystatechange=()=>{e.readyState==4&&(X(`Save config status: '${e.responseText.trim()}'`),e.status==200&&z.set(!1),Ve=!1)},e.setRequestHeader("Content-Type","application/json");const n={};(t=se.selected_characters)==null||t.forEach((l,c)=>{n[c]=l});const r={};Object.assign(r,se),r.selected_characters=n;const o=JSON.stringify(r,null,4);e.send(o)}}function Ut(){return new Promise((t,e)=>{const n=new XMLHttpRequest,r=le(Ht).concat("/list-game-clients");n.open("GET",r,!0),n.onreadystatechange=()=>{if(n.readyState==4)if(n.status==200&&n.getResponseHeader("content-type")==="application/json"){const o=JSON.parse(n.responseText);t(Object.keys(o).map(l=>({uid:l,identity:o[l].identity||null})))}else e(`error (${n.responseText})`)},n.send()})}function kn(){const t=new XMLHttpRequest;t.open("POST","/save-plugin-config",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{t.readyState==4&&X(`Save-plugin-config status: ${t.responseText.trim()}`)},t.send(JSON.stringify(le(Pe)))}function ft(t,e,n){const r=t.slice();return r[22]=e[n],r}function pt(t){let e,n=t[22][1].displayName+"",r,o,l;return{c(){e=b("option"),r=F(n),h(e,"data-id",o=t[22][1].userId),h(e,"class","dark:bg-slate-900"),e.__value=l=t[22][1].displayName,ge(e,e.__value)},m(c,i){P(c,e,i),_(e,r)},p(c,i){i&4&&n!==(n=c[22][1].displayName+"")&&pe(r,n),i&4&&o!==(o=c[22][1].userId)&&h(e,"data-id",o),i&4&&l!==(l=c[22][1].displayName)&&(e.__value=l,ge(e,e.__value))},d(c){c&&R(e)}}}function wn(t){let e,n,r,o,l,c,i,u,a,d=de(t[2]),f=[];for(let p=0;p<d.length;p+=1)f[p]=pt(ft(t,d,p));return{c(){e=b("div"),n=b("select");for(let p=0;p<f.length;p+=1)f[p].c();r=M(),o=b("div"),l=b("button"),l.textContent="Log In",c=M(),i=b("button"),i.textContent="Log Out",h(n,"name","account_select"),h(n,"id","account_select"),h(n,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),h(l,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(i,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),h(o,"class","mt-5 flex"),h(e,"class","z-10 w-48 rounded-lg border-2 border-slate-300 bg-slate-100 p-3 shadow dark:border-slate-800 dark:bg-slate-900"),h(e,"role","none")},m(p,m){P(p,e,m),_(e,n);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(n,null);t[7](n),_(e,r),_(e,o),_(o,l),_(o,c),_(o,i),u||(a=[O(n,"change",t[8]),O(l,"click",t[9]),O(i,"click",t[10]),O(e,"mouseenter",t[11]),O(e,"mouseleave",t[12])],u=!0)},p(p,[m]){if(m&4){d=de(p[2]);let g;for(g=0;g<d.length;g+=1){const w=ft(p,d,g);f[g]?f[g].p(w,m):(f[g]=pt(w),f[g].c(),f[g].m(n,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=d.length}},i:j,o:j,d(p){p&&R(e),He(f,p),t[7](null),u=!1,ie(a)}}}function yn(t,e,n){let r,o,l,c;$(t,W,C=>n(13,r=C)),$(t,me,C=>n(14,o=C)),$(t,Ue,C=>n(2,l=C)),$(t,U,C=>n(15,c=C));let{showAccountDropdown:i}=e,{hoverAccountButton:u}=e;const a=atob(V.origin),d=atob(V.clientid),f=a.concat("/oauth2/token"),p=a.concat("/oauth2/revoke");let m=!1,g;function w(C){u||C.button===0&&i&&!m&&n(5,i=!1)}function y(){var ee;if(g.options.length==0){X("Logout unsuccessful: no account selected");return}let C=r.credentials;r.account&&(l.delete((ee=r.account)==null?void 0:ee.userId),Ue.set(l));const E=g.selectedIndex;E>0?n(1,g.selectedIndex=E-1,g):E==0&&l.size>0?n(1,g.selectedIndex=E+1,g):(delete r.account,delete r.character,delete r.credentials),v(),C&&jt(C,f,d).then(q=>{q===null?hn(C.access_token,p,d).then(I=>{I===200?(X("Successful logout"),x(C)):G(`Logout unsuccessful: status ${I}`,!1)}):q===400||q===401?(X("Logout unsuccessful: credentials are invalid, so discarding them anyway"),C&&x(C)):G("Logout unsuccessful: unable to verify credentials due to a network error",!1)})}function x(C){o.delete(C.sub),Te()}function v(){var E;z.set(!0);const C=g[g.selectedIndex].getAttribute("data-id");if(N(W,r.account=l.get(C),r),N(U,c.selected_account=C,c),N(W,r.credentials=o.get((E=r.account)==null?void 0:E.userId),r),r.account&&r.account.characters){const ee=document.getElementById("character_select");ee.selectedIndex=0;const[q]=r.account.characters.keys();N(W,r.character=r.account.characters.get(q),r)}}addEventListener("mousedown",w),Oe(()=>{var E;let C=0;l.forEach((ee,q)=>{var I;ee.displayName==((I=r.account)==null?void 0:I.displayName)&&n(1,g.selectedIndex=C,g),C++}),N(W,r.credentials=o.get((E=r.account)==null?void 0:E.userId),r)}),nt(()=>{removeEventListener("mousedown",w)});function k(C){B[C?"unshift":"push"](()=>{g=C,n(1,g)})}const S=()=>{v()},L=()=>{Nt()},H=()=>{y()},J=()=>{n(0,m=!0)},T=()=>{n(0,m=!1)};return t.$$set=C=>{"showAccountDropdown"in C&&n(5,i=C.showAccountDropdown),"hoverAccountButton"in C&&n(6,u=C.hoverAccountButton)},[m,g,l,y,v,i,u,k,S,L,H,J,T]}class vn extends oe{constructor(e){super(),re(this,e,yn,wn,ne,{showAccountDropdown:5,hoverAccountButton:6})}}function Sn(t){let e;return{c(){e=F("Log In")},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function Ln(t){var r;let e=((r=t[6].account)==null?void 0:r.displayName)+"",n;return{c(){n=F(e)},m(o,l){P(o,n,l)},p(o,l){var c;l&64&&e!==(e=((c=o[6].account)==null?void 0:c.displayName)+"")&&pe(n,e)},d(o){o&&R(n)}}}function ht(t){let e,n,r,o;function l(i){t[20](i)}let c={hoverAccountButton:t[2]};return t[1]!==void 0&&(c.showAccountDropdown=t[1]),n=new vn({props:c}),B.push(()=>Ie(n,"showAccountDropdown",l)),{c(){e=b("div"),te(n.$$.fragment),h(e,"class","absolute right-2 top-[72px]")},m(i,u){P(i,e,u),K(n,e,null),o=!0},p(i,u){const a={};u&4&&(a.hoverAccountButton=i[2]),!r&&u&2&&(r=!0,a.showAccountDropdown=i[1],Ee(()=>r=!1)),n.$set(a)},i(i){o||(A(n.$$.fragment,i),o=!0)},o(i){D(n.$$.fragment,i),o=!1},d(i){i&&R(e),Q(n)}}}function xn(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y;function x(L,H){return L[6].account?Ln:Sn}let v=x(t),k=v(t),S=t[1]&&ht(t);return{c(){e=b("div"),n=b("div"),r=b("button"),r.textContent="RS3",o=M(),l=b("button"),l.textContent="OSRS",c=M(),i=b("div"),u=b("button"),u.innerHTML='<img src="svgs/lightbulb-solid.svg" class="h-6 w-6" alt="Change Theme"/>',a=M(),d=b("button"),d.innerHTML='<img src="svgs/gear-solid.svg" class="h-6 w-6" alt="Settings"/>',f=M(),p=b("button"),k.c(),m=M(),S&&S.c(),h(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),h(l,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),h(n,"class","m-3 ml-9 font-bold"),h(u,"class","my-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),h(d,"class","m-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),h(p,"class","m-2 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50"),h(i,"class","ml-auto flex"),h(e,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m(L,H){P(L,e,H),_(e,n),_(n,r),t[10](r),_(n,o),_(n,l),t[12](l),_(e,c),_(e,i),_(i,u),_(i,a),_(i,d),_(i,f),_(i,p),k.m(p,null),t[16](p),_(e,m),S&&S.m(e,null),g=!0,w||(y=[O(r,"click",t[11]),O(l,"click",t[13]),O(u,"click",t[14]),O(d,"click",t[15]),O(p,"mouseenter",t[17]),O(p,"mouseleave",t[18]),O(p,"click",t[19])],w=!0)},p(L,[H]){v===(v=x(L))&&k?k.p(L,H):(k.d(1),k=v(L),k&&(k.c(),k.m(p,null))),L[1]?S?(S.p(L,H),H&2&&A(S,1)):(S=ht(L),S.c(),A(S,1),S.m(e,null)):S&&(ke(),D(S,1,1,()=>{S=null}),we())},i(L){g||(A(S),g=!0)},o(L){D(S),g=!1},d(L){L&&R(e),t[10](null),t[12](null),k.d(),t[16](null),S&&S.d(),w=!1,ie(y)}}}function Cn(t,e,n){let r,o,l;$(t,U,E=>n(21,r=E)),$(t,z,E=>n(22,o=E)),$(t,W,E=>n(6,l=E));let{showSettings:c}=e,i=!1,u=!1,a,d,f;function p(){let E=document.documentElement;E.classList.contains("dark")?E.classList.remove("dark"):E.classList.add("dark"),N(U,r.use_dark_theme=!r.use_dark_theme,r),N(z,o=!0,o)}function m(E){switch(E){case Y.osrs:N(W,l.game=Y.osrs,l),N(W,l.client=r.selected_client_index,l),N(U,r.selected_game_index=Y.osrs,r),N(z,o=!0,o),d.classList.add("bg-blue-500","text-black"),a.classList.remove("bg-blue-500","text-black");break;case Y.rs3:N(W,l.game=Y.rs3,l),N(U,r.selected_game_index=Y.rs3,r),N(z,o=!0,o),d.classList.remove("bg-blue-500","text-black"),a.classList.add("bg-blue-500","text-black");break}}function g(){if(f.innerHTML=="Log In"){Nt();return}n(1,i=!i)}Oe(()=>{m(r.selected_game_index)});function w(E){B[E?"unshift":"push"](()=>{a=E,n(3,a)})}const y=()=>{m(Y.rs3)};function x(E){B[E?"unshift":"push"](()=>{d=E,n(4,d)})}const v=()=>{m(Y.osrs)},k=()=>p(),S=()=>{n(0,c=!0)};function L(E){B[E?"unshift":"push"](()=>{f=E,n(5,f)})}const H=()=>{n(2,u=!0)},J=()=>{n(2,u=!1)},T=()=>g();function C(E){i=E,n(1,i)}return t.$$set=E=>{"showSettings"in E&&n(0,c=E.showSettings)},[c,i,u,a,d,f,l,p,m,g,w,y,x,v,k,S,L,H,J,T,C]}class Rn extends oe{constructor(e){super(),re(this,e,Cn,xn,ne,{showSettings:0})}}function Tn(t){let e,n,r,o,l,c;return{c(){e=b("div"),n=b("div"),n.innerHTML="",r=M(),o=b("div"),o.innerHTML="",h(n,"class","absolute left-0 top-0 z-10 h-screen w-screen backdrop-blur-sm backdrop-filter"),h(o,"class","absolute left-0 top-0 z-10 h-screen w-screen bg-black opacity-75"),h(o,"role","none")},m(i,u){P(i,e,u),_(e,n),_(e,r),_(e,o),l||(c=O(o,"click",t[1]),l=!0)},p:j,i:j,o:j,d(i){i&&R(e),l=!1,c()}}}function Pn(t){const e=Wt();return[e,()=>{e("click")}]}class lt extends oe{constructor(e){super(),re(this,e,Pn,Tn,ne,{})}}function Mn(t){let e,n,r,o,l,c,i,u,a,d,f,p;return n=new lt({}),{c(){e=b("div"),te(n.$$.fragment),r=M(),o=b("div"),l=b("p"),l.textContent=`${t[1]}`,c=M(),i=b("p"),i.textContent=`${t[2]}`,u=M(),a=b("button"),a.textContent="I Understand",h(l,"class","p-2"),h(i,"class","p-2"),h(a,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),h(o,"class","absolute left-1/4 top-1/4 z-20 w-1/2 rounded-lg bg-slate-100 p-5 text-center shadow-lg dark:bg-slate-900"),h(e,"id","disclaimer")},m(m,g){P(m,e,g),K(n,e,null),_(e,r),_(e,o),_(o,l),_(o,c),_(o,i),_(o,u),_(o,a),d=!0,f||(p=O(a,"click",t[3]),f=!0)},p:j,i(m){d||(A(n.$$.fragment,m),d=!0)},o(m){D(n.$$.fragment,m),d=!1},d(m){m&&R(e),Q(n),f=!1,p()}}}function En(t,e,n){let r;$(t,Be,i=>n(0,r=i));const o=atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg=="),l=atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu");return[r,o,l,()=>{N(Be,r=!1,r)}]}class In extends oe{constructor(e){super(),re(this,e,En,Mn,ne,{})}}function Hn(t){let e,n,r,o;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
			Browse App Data</div>`,h(n,"id","data_dir_button"),h(n,"class","p-2 hover:opacity-75"),h(e,"id","general_options"),h(e,"class","col-span-3 p-5 pt-10")},m(l,c){P(l,e,c),_(e,n),r||(o=O(n,"click",t[1]),r=!0)},p:j,i:j,o:j,d(l){l&&R(e),r=!1,o()}}}function Nn(t){function e(){var r=new XMLHttpRequest;r.open("GET","/browse-data"),r.onreadystatechange=()=>{r.readyState==4&&X(`Browse status: '${r.responseText.trim()}'`)},r.send()}return[e,()=>{e()}]}class jn extends oe{constructor(e){super(),re(this,e,Nn,Hn,ne,{})}}function On(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y,x,v,k,S,L;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
			Configure RuneLite</div>`,r=M(),o=b("div"),l=b("label"),l.textContent="Expose rich presence to Flatpak Discord:",c=M(),i=b("input"),u=M(),a=b("div"),d=b("label"),d.textContent="Use custom RuneLite JAR:",f=M(),p=b("input"),m=M(),g=b("div"),w=b("textarea"),y=M(),x=b("br"),v=M(),k=b("button"),k.textContent="Select File",h(n,"id","rl_configure"),h(n,"class","p-2 pb-5 hover:opacity-75"),h(l,"for","flatpak_rich_presence"),h(i,"type","checkbox"),h(i,"name","flatpak_rich_presence"),h(i,"id","flatpak_rich_presence"),h(i,"class","ml-2"),h(o,"id","flatpak_div"),h(o,"class","mx-auto border-t-2 border-slate-300 p-2 py-5 dark:border-slate-800"),h(d,"for","use_custom_jar"),h(p,"type","checkbox"),h(p,"name","use_custom_jar"),h(p,"id","use_custom_jar"),h(p,"class","ml-2"),h(a,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),w.disabled=!0,h(w,"name","custom_jar_file"),h(w,"id","custom_jar_file"),h(w,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),k.disabled=!0,h(k,"id","custom_jar_file_button"),h(k,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 hover:opacity-75"),h(g,"id","custom_jar_div"),h(g,"class","mx-auto p-2 opacity-25"),h(e,"id","osrs_options"),h(e,"class","col-span-3 p-5 pt-10")},m(H,J){P(H,e,J),_(e,n),_(e,r),_(e,o),_(o,l),_(o,c),_(o,i),t[12](i),t[14](o),_(e,u),_(e,a),_(a,d),_(a,f),_(a,p),t[15](p),_(e,m),_(e,g),_(g,w),t[17](w),_(g,y),_(g,x),_(g,v),_(g,k),t[19](k),t[21](g),S||(L=[O(n,"click",t[11]),O(i,"change",t[13]),O(p,"change",t[16]),O(w,"change",t[18]),O(k,"click",t[20])],S=!0)},p:j,i:j,o:j,d(H){H&&R(e),t[12](null),t[14](null),t[15](null),t[17](null),t[19](null),t[21](null),S=!1,ie(L)}}}function An(t,e,n){let r,o,l,c;$(t,Ge,I=>n(22,r=I)),$(t,U,I=>n(23,o=I)),$(t,W,I=>n(24,l=I)),$(t,z,I=>n(25,c=I));let i,u,a,d,f,p;function m(){i.classList.toggle("opacity-25"),n(1,u.disabled=!u.disabled,u),n(2,a.disabled=!a.disabled,a),N(U,o.runelite_use_custom_jar=d.checked,o),o.runelite_use_custom_jar?u.value&&N(U,o.runelite_custom_jar=u.value,o):(n(1,u.value="",u),N(U,o.runelite_custom_jar="",o),N(U,o.runelite_use_custom_jar=!1,o)),N(z,c=!0,c)}function g(){N(U,o.flatpak_rich_presence=f.checked,o),N(z,c=!0,c)}function w(){N(U,o.runelite_custom_jar=u.value,o),N(z,c=!0,c)}function y(){n(3,d.disabled=!0,d),n(2,a.disabled=!0,a);var I=new XMLHttpRequest;I.onreadystatechange=()=>{I.readyState==4&&(I.status==200&&(n(1,u.value=I.responseText,u),N(U,o.runelite_custom_jar=I.responseText,o),N(z,c=!0,c)),n(2,a.disabled=!1,a),n(3,d.disabled=!1,d))},I.open("GET","/jar-file-picker",!0),I.send()}function x(){var I,ve,it;if(!l.account||!l.character){X("Please log in to configure RuneLite");return}bn((I=l.credentials)==null?void 0:I.session_id,(ve=l.character)==null?void 0:ve.accountId,(it=l.character)==null?void 0:it.displayName)}Oe(()=>{n(4,f.checked=o.flatpak_rich_presence,f),n(3,d.checked=o.runelite_use_custom_jar,d),d.checked&&o.runelite_custom_jar?(i.classList.remove("opacity-25"),n(1,u.disabled=!1,u),n(2,a.disabled=!1,a),n(1,u.value=o.runelite_custom_jar,u)):(n(3,d.checked=!1,d),N(U,o.runelite_use_custom_jar=!1,o)),r!=="linux"&&p.remove()});const v=()=>x();function k(I){B[I?"unshift":"push"](()=>{f=I,n(4,f)})}const S=()=>{g()};function L(I){B[I?"unshift":"push"](()=>{p=I,n(5,p)})}function H(I){B[I?"unshift":"push"](()=>{d=I,n(3,d)})}const J=()=>{m()};function T(I){B[I?"unshift":"push"](()=>{u=I,n(1,u)})}const C=()=>{w()};function E(I){B[I?"unshift":"push"](()=>{a=I,n(2,a)})}const ee=()=>{y()};function q(I){B[I?"unshift":"push"](()=>{i=I,n(0,i)})}return[i,u,a,d,f,p,m,g,w,y,x,v,k,S,L,H,J,T,C,E,ee,q]}class Dn extends oe{constructor(e){super(),re(this,e,An,On,ne,{})}}function qn(t){let e,n,r,o,l,c,i,u,a,d;return{c(){e=b("div"),n=b("div"),r=b("label"),r.textContent="Use custom config URI:",o=M(),l=b("input"),c=M(),i=b("div"),u=b("textarea"),h(r,"for","use_custom_uri"),h(l,"type","checkbox"),h(l,"name","use_custom_uri"),h(l,"id","use_custom_uri"),h(l,"class","ml-2"),h(n,"class","mx-auto p-2"),u.disabled=!0,h(u,"name","config_uri_address"),h(u,"id","config_uri_address"),h(u,"rows","4"),h(u,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),u.value="		",h(i,"id","config_uri_div"),h(i,"class","mx-auto p-2 opacity-25"),h(e,"id","rs3_options"),h(e,"class","col-span-3 p-5 pt-10")},m(f,p){P(f,e,p),_(e,n),_(n,r),_(n,o),_(n,l),t[5](l),_(e,c),_(e,i),_(i,u),t[8](u),t[9](i),a||(d=[O(l,"change",t[6]),O(u,"change",t[7])],a=!0)},p:j,i:j,o:j,d(f){f&&R(e),t[5](null),t[8](null),t[9](null),a=!1,ie(d)}}}function Un(t,e,n){let r,o,l;$(t,rt,y=>n(10,r=y)),$(t,U,y=>n(11,o=y)),$(t,z,y=>n(12,l=y));let c,i,u;function a(){c.classList.toggle("opacity-25"),n(1,i.disabled=!i.disabled,i),N(z,l=!0,l),u.checked||(n(1,i.value=atob(r.default_config_uri),i),N(U,o.rs_config_uri="",o))}function d(){N(U,o.rs_config_uri=i.value,o),N(z,l=!0,l)}Oe(()=>{o.rs_config_uri?(n(1,i.value=o.rs_config_uri,i),n(2,u.checked=!0,u),a()):n(1,i.value=atob(r.default_config_uri),i)});function f(y){B[y?"unshift":"push"](()=>{u=y,n(2,u)})}const p=()=>{a()},m=()=>{d()};function g(y){B[y?"unshift":"push"](()=>{i=y,n(1,i)})}function w(y){B[y?"unshift":"push"](()=>{c=y,n(0,c)})}return[c,i,u,a,d,f,p,m,g,w]}class Bn extends oe{constructor(e){super(),re(this,e,Un,qn,ne,{})}}function Jn(t){let e,n;return e=new Bn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(A(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Gn(t){let e,n;return e=new Dn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(A(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Xn(t){let e,n;return e=new jn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(A(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function $n(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y,x,v,k,S,L,H,J,T;n=new lt({}),n.$on("click",t[7]);const C=[Xn,Gn,Jn],E=[];function ee(q,I){return q[1]==q[5].general?0:q[1]==q[5].osrs?1:q[1]==q[5].rs3?2:-1}return~(S=ee(t))&&(L=E[S]=C[S](t)),{c(){e=b("div"),te(n.$$.fragment),r=M(),o=b("div"),l=b("button"),l.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=M(),i=b("div"),u=b("div"),a=b("button"),d=F("General"),f=b("br"),p=M(),m=b("button"),g=F("OSRS"),w=b("br"),y=M(),x=b("button"),v=F("RS3"),k=M(),L&&L.c(),h(l,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),h(a,"id","general_button"),h(a,"class",he),h(m,"id","osrs_button"),h(m,"class",qe),h(x,"id","rs3_button"),h(x,"class",he),h(u,"class","relative h-full border-r-2 border-slate-300 pt-10 dark:border-slate-800"),h(i,"class","grid h-full grid-cols-4"),h(o,"class","absolute left-[13%] top-[13%] z-20 h-3/4 w-3/4 rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900"),h(e,"id","settings")},m(q,I){P(q,e,I),K(n,e,null),_(e,r),_(e,o),_(o,l),_(o,c),_(o,i),_(i,u),_(u,a),_(a,d),t[9](a),_(u,f),_(u,p),_(u,m),_(m,g),t[11](m),_(u,w),_(u,y),_(u,x),_(x,v),t[13](x),_(i,k),~S&&E[S].m(i,null),H=!0,J||(T=[O(l,"click",t[8]),O(a,"click",t[10]),O(m,"click",t[12]),O(x,"click",t[14])],J=!0)},p(q,[I]){let ve=S;S=ee(q),S!==ve&&(L&&(ke(),D(E[ve],1,1,()=>{E[ve]=null}),we()),~S?(L=E[S],L||(L=E[S]=C[S](q),L.c()),A(L,1),L.m(i,null)):L=null)},i(q){H||(A(n.$$.fragment,q),A(L),H=!0)},o(q){D(n.$$.fragment,q),D(L),H=!1},d(q){q&&R(e),Q(n),t[9](null),t[11](null),t[13](null),~S&&E[S].d(),J=!1,ie(T)}}}let qe="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 mx-auto my-1 w-3/4",he="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 mx-auto my-1 w-3/4";function zn(t,e,n){let{showSettings:r}=e;var o=(k=>(k[k.general=0]="general",k[k.osrs=1]="osrs",k[k.rs3=2]="rs3",k))(o||{});let l=1,c,i,u;function a(k){switch(k){case 0:n(1,l=0),n(2,c.classList.value=qe,c),n(3,i.classList.value=he,i),n(4,u.classList.value=he,u);break;case 1:n(1,l=1),n(2,c.classList.value=he,c),n(3,i.classList.value=qe,i),n(4,u.classList.value=he,u);break;case 2:n(1,l=2),n(2,c.classList.value=he,c),n(3,i.classList.value=he,i),n(4,u.classList.value=qe,u);break}}function d(k){k.key==="Escape"&&n(0,r=!1)}addEventListener("keydown",d),nt(()=>{removeEventListener("keydown",d)});const f=()=>{n(0,r=!1)},p=()=>{n(0,r=!1)};function m(k){B[k?"unshift":"push"](()=>{c=k,n(2,c)})}const g=()=>{a(o.general)};function w(k){B[k?"unshift":"push"](()=>{i=k,n(3,i)})}const y=()=>{a(o.osrs)};function x(k){B[k?"unshift":"push"](()=>{u=k,n(4,u)})}const v=()=>{a(o.rs3)};return t.$$set=k=>{"showSettings"in k&&n(0,r=k.showSettings)},[r,l,c,i,u,o,a,f,p,m,g,w,y,x,v]}class Fn extends oe{constructor(e){super(),re(this,e,zn,$n,ne,{showSettings:0})}}function _t(t,e,n){const r=t.slice();return r[1]=e[n],r}function Vn(t){var u;let e,n=((u=t[1].time)==null?void 0:u.toLocaleTimeString())+"",r,o,l=t[1].text+"",c,i;return{c(){e=b("li"),r=F(n),o=F(`
					- `),c=F(l),i=M()},m(a,d){P(a,e,d),_(e,r),_(e,o),_(e,c),_(e,i)},p(a,d){var f;d&1&&n!==(n=((f=a[1].time)==null?void 0:f.toLocaleTimeString())+"")&&pe(r,n),d&1&&l!==(l=a[1].text+"")&&pe(c,l)},d(a){a&&R(e)}}}function Wn(t){var u;let e,n=((u=t[1].time)==null?void 0:u.toLocaleTimeString())+"",r,o,l=t[1].text+"",c,i;return{c(){e=b("li"),r=F(n),o=F(`
					- `),c=F(l),i=M(),h(e,"class","text-rose-500")},m(a,d){P(a,e,d),_(e,r),_(e,o),_(e,c),_(e,i)},p(a,d){var f;d&1&&n!==(n=((f=a[1].time)==null?void 0:f.toLocaleTimeString())+"")&&pe(r,n),d&1&&l!==(l=a[1].text+"")&&pe(c,l)},d(a){a&&R(e)}}}function gt(t){let e;function n(l,c){return l[1].isError?Wn:Vn}let r=n(t),o=r(t);return{c(){o.c(),e=Ne()},m(l,c){o.m(l,c),P(l,e,c)},p(l,c){r===(r=n(l))&&o?o.p(l,c):(o.d(1),o=r(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&R(e),o.d(l)}}}function Zn(t){let e,n,r,o,l=de(t[0]),c=[];for(let i=0;i<l.length;i+=1)c[i]=gt(_t(t,l,i));return{c(){e=b("div"),n=b("div"),n.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',r=M(),o=b("ol");for(let i=0;i<c.length;i+=1)c[i].c();h(n,"class","absolute right-2 top-2"),h(o,"id","message_list"),h(o,"class","h-full w-[105%] list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),h(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(i,u){P(i,e,u),_(e,n),_(e,r),_(e,o);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(o,null)},p(i,[u]){if(u&1){l=de(i[0]);let a;for(a=0;a<l.length;a+=1){const d=_t(i,l,a);c[a]?c[a].p(d,u):(c[a]=gt(d),c[a].c(),c[a].m(o,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=l.length}},i:j,o:j,d(i){i&&R(e),He(c,i)}}}function Yn(t,e,n){let r;return $(t,ye,o=>n(0,r=o)),[r]}class Kn extends oe{constructor(e){super(),re(this,e,Yn,Zn,ne,{})}}function bt(t,e,n){const r=t.slice();return r[13]=e[n],r}function Qn(t){let e,n,r;return{c(){e=b("button"),e.textContent="Plugin menu",e.disabled=!le(Re),h(e,"class","mx-auto mb-2 w-52 rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(o,l){P(o,e,l),n||(r=O(e,"click",t[8]),n=!0)},p:j,d(o){o&&R(e),n=!1,r()}}}function es(t){let e,n,r,o,l,c,i,u,a;return{c(){e=b("label"),e.textContent="Game Client",n=M(),r=b("br"),o=M(),l=b("select"),c=b("option"),c.textContent="RuneLite",i=b("option"),i.textContent="HDOS",h(e,"for","game_client_select"),h(e,"class","text-sm"),h(c,"data-id",ue.runeLite),h(c,"class","dark:bg-slate-900"),c.__value="RuneLite",ge(c,c.__value),h(i,"data-id",ue.hdos),h(i,"class","dark:bg-slate-900"),i.__value="HDOS",ge(i,i.__value),h(l,"id","game_client_select"),h(l,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800")},m(d,f){P(d,e,f),P(d,n,f),P(d,r,f),P(d,o,f),P(d,l,f),_(l,c),_(l,i),t[7](l),u||(a=O(l,"change",t[5]),u=!0)},p:j,d(d){d&&(R(e),R(n),R(r),R(o),R(l)),t[7](null),u=!1,a()}}}function mt(t){let e,n=de(t[4].account.characters),r=[];for(let o=0;o<n.length;o+=1)r[o]=kt(bt(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Ne()},m(o,l){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(o,l);P(o,e,l)},p(o,l){if(l&16){n=de(o[4].account.characters);let c;for(c=0;c<n.length;c+=1){const i=bt(o,n,c);r[c]?r[c].p(i,l):(r[c]=kt(i),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(o){o&&R(e),He(r,o)}}}function ts(t){let e;return{c(){e=F("New Character")},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function ns(t){let e=t[13][1].displayName+"",n;return{c(){n=F(e)},m(r,o){P(r,n,o)},p(r,o){o&16&&e!==(e=r[13][1].displayName+"")&&pe(n,e)},d(r){r&&R(n)}}}function kt(t){let e,n,r,o;function l(u,a){return u[13][1].displayName?ns:ts}let c=l(t),i=c(t);return{c(){e=b("option"),i.c(),n=M(),h(e,"data-id",r=t[13][1].accountId),h(e,"class","dark:bg-slate-900"),e.__value=o=`
						`+t[13][1].displayName+`
					`,ge(e,e.__value)},m(u,a){P(u,e,a),i.m(e,null),_(e,n)},p(u,a){c===(c=l(u))&&i?i.p(u,a):(i.d(1),i=c(u),i&&(i.c(),i.m(e,n))),a&16&&r!==(r=u[13][1].accountId)&&h(e,"data-id",r),a&16&&o!==(o=`
						`+u[13][1].displayName+`
					`)&&(e.__value=o,ge(e,e.__value))},d(u){u&&R(e),i.d()}}}function ss(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y;function x(L,H){if(L[4].game==Y.osrs)return es;if(L[4].game==Y.rs3)return Qn}let v=x(t),k=v&&v(t),S=t[4].account&&mt(t);return{c(){e=b("div"),n=b("img"),o=M(),l=b("button"),l.textContent="Play",c=M(),i=b("div"),k&&k.c(),u=M(),a=b("div"),d=b("label"),d.textContent="Character",f=M(),p=b("br"),m=M(),g=b("select"),S&&S.c(),Xt(n.src,r="svgs/rocket-solid.svg")||h(n,"src",r),h(n,"alt","Launch icon"),h(n,"class","mx-auto mb-5 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),h(l,"class","mx-auto mb-2 w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(i,"class","mx-auto my-2"),h(d,"for","character_select"),h(d,"class","text-sm"),h(g,"id","character_select"),h(g,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),h(a,"class","mx-auto my-2"),h(e,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(L,H){P(L,e,H),_(e,n),_(e,o),_(e,l),_(e,c),_(e,i),k&&k.m(i,null),_(e,u),_(e,a),_(a,d),_(a,f),_(a,p),_(a,m),_(a,g),S&&S.m(g,null),t[9](g),w||(y=[O(l,"click",t[6]),O(g,"change",t[10])],w=!0)},p(L,[H]){v===(v=x(L))&&k?k.p(L,H):(k&&k.d(1),k=v&&v(L),k&&(k.c(),k.m(i,null))),L[4].account?S?S.p(L,H):(S=mt(L),S.c(),S.m(g,null)):S&&(S.d(1),S=null)},i:j,o:j,d(L){L&&R(e),k&&k.d(),S&&S.d(),t[9](null),w=!1,ie(y)}}}function rs(t,e,n){let r,o,l;$(t,W,y=>n(4,r=y)),$(t,U,y=>n(11,o=y)),$(t,z,y=>n(12,l=y));let{showPluginMenu:c=!1}=e,i,u;function a(){var x,v;if(!r.account)return;const y=i[i.selectedIndex].getAttribute("data-id");N(W,r.character=r.account.characters.get(y),r),r.character&&((v=o.selected_characters)==null||v.set(r.account.userId,(x=r.character)==null?void 0:x.accountId)),N(z,l=!0,l)}function d(){u.value=="RuneLite"?(N(W,r.client=ue.runeLite,r),N(U,o.selected_client_index=ue.runeLite,o)):u.value=="HDOS"&&(N(W,r.client=ue.hdos,r),N(U,o.selected_client_index=ue.hdos,o)),N(z,l=!0,l)}function f(){var y,x,v,k,S,L,H,J,T;if(!r.account||!r.character){X("Please log in to launch a client");return}switch(r.game){case Y.osrs:r.client==ue.runeLite?gn((y=r.credentials)==null?void 0:y.session_id,(x=r.character)==null?void 0:x.accountId,(v=r.character)==null?void 0:v.displayName):r.client==ue.hdos&&mn((k=r.credentials)==null?void 0:k.session_id,(S=r.character)==null?void 0:S.accountId,(L=r.character)==null?void 0:L.displayName);break;case Y.rs3:_n((H=r.credentials)==null?void 0:H.session_id,(J=r.character)==null?void 0:J.accountId,(T=r.character)==null?void 0:T.displayName);break}}Vt(()=>{var y;if(r.game==Y.osrs&&r.client&&n(3,u.selectedIndex=r.client,u),r.account&&((y=o.selected_characters)!=null&&y.has(r.account.userId)))for(let x=0;x<i.options.length;x++)i[x].getAttribute("data-id")==o.selected_characters.get(r.account.userId)&&n(2,i.selectedIndex=x,i)}),Oe(()=>{o.selected_game_index==Y.osrs&&(n(3,u.selectedIndex=o.selected_client_index,u),N(W,r.client=u.selectedIndex,r))});function p(y){B[y?"unshift":"push"](()=>{u=y,n(3,u)})}const m=()=>{n(0,c=le(Re)??!1)};function g(y){B[y?"unshift":"push"](()=>{i=y,n(2,i)})}const w=()=>a();return t.$$set=y=>{"showPluginMenu"in y&&n(0,c=y.showPluginMenu)},[c,a,i,u,r,d,f,p,m,g,w]}class os extends oe{constructor(e){super(),re(this,e,rs,ss,ne,{showPluginMenu:0,characterChanged:1})}get characterChanged(){return this.$$.ctx[1]}}function ls(t){let e;return{c(){e=b("div"),e.innerHTML='<img src="svgs/circle-notch-solid.svg" alt="" class="mx-auto h-1/6 w-1/6 animate-spin"/>',h(e,"class","container mx-auto bg-slate-100 p-5 text-center text-slate-900 dark:bg-slate-900 dark:text-slate-50")},m(n,r){P(n,e,r)},p:j,i:j,o:j,d(n){n&&R(e)}}}class cs extends oe{constructor(e){super(),re(this,e,null,ls,ne,{})}}function wt(t,e,n){const r=t.slice();return r[8]=e[n][0],r[9]=e[n][1],r}function yt(t,e,n){const r=t.slice();return r[13]=e[n],r}function is(t){let e;return{c(){e=b("p"),e.textContent="error"},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function as(t){let e;function n(l,c){return l[12].length==0?ds:us}let r=n(t),o=r(t);return{c(){o.c(),e=Ne()},m(l,c){o.m(l,c),P(l,e,c)},p(l,c){r===(r=n(l))&&o?o.p(l,c):(o.d(1),o=r(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&R(e),o.d(l)}}}function us(t){let e,n=de(t[12]),r=[];for(let o=0;o<n.length;o+=1)r[o]=vt(yt(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Ne()},m(o,l){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(o,l);P(o,e,l)},p(o,l){if(l&4){n=de(o[12]);let c;for(c=0;c<n.length;c+=1){const i=yt(o,n,c);r[c]?r[c].p(i,l):(r[c]=vt(i),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(o){o&&R(e),He(r,o)}}}function ds(t){let e;return{c(){e=b("p"),e.textContent="(start an RS3 game client with plugins enabled and it will be listed here.)"},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function vt(t){let e,n=(t[13].identity||"(unnamed)")+"",r,o,l;return{c(){e=b("button"),r=F(n),o=M(),l=b("br"),h(e,"class","m-1 h-[28px] w-[95%] rounded-lg border-2 border-blue-500 duration-200 hover:opacity-75")},m(c,i){P(c,e,i),_(e,r),P(c,o,i),P(c,l,i)},p(c,i){i&4&&n!==(n=(c[13].identity||"(unnamed)")+"")&&pe(r,n)},d(c){c&&(R(e),R(o),R(l))}}}function fs(t){let e;return{c(){e=b("p"),e.textContent="loading..."},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function ps(t){let e;return{c(){e=b("p"),e.textContent="error"},m(n,r){P(n,e,r)},p:j,d(n){n&&R(e)}}}function hs(t){let e,n,r,o,l,c=Object.entries(t[1]).length===0,i,u,a,d=de(Object.entries(t[1])),f=[];for(let m=0;m<d.length;m+=1)f[m]=St(wt(t,d,m));let p=c&&Lt();return{c(){e=b("select");for(let m=0;m<f.length;m+=1)f[m].c();n=M(),r=b("button"),o=F("+"),l=M(),p&&p.c(),i=Ne(),h(e,"class","mx-auto mb-4 w-[min(280px,_45%)] cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),h(r,"class","aspect-square w-8 rounded-lg border-2 border-blue-500 text-[20px] font-bold duration-200 enabled:hover:opacity-75 disabled:border-gray-500"),r.disabled=t[0]},m(m,g){P(m,e,g);for(let w=0;w<f.length;w+=1)f[w]&&f[w].m(e,null);P(m,n,g),P(m,r,g),_(r,o),P(m,l,g),p&&p.m(m,g),P(m,i,g),u||(a=O(r,"click",t[3]),u=!0)},p(m,g){if(g&2){d=de(Object.entries(m[1]));let w;for(w=0;w<d.length;w+=1){const y=wt(m,d,w);f[w]?f[w].p(y,g):(f[w]=St(y),f[w].c(),f[w].m(e,null))}for(;w<f.length;w+=1)f[w].d(1);f.length=d.length}g&1&&(r.disabled=m[0]),g&2&&(c=Object.entries(m[1]).length===0),c?p||(p=Lt(),p.c(),p.m(i.parentNode,i)):p&&(p.d(1),p=null)},d(m){m&&(R(e),R(n),R(r),R(l),R(i)),He(f,m),p&&p.d(m),u=!1,a()}}}function St(t){let e,n=(t[9].name??t[8])+"",r,o;return{c(){e=b("option"),r=F(n),h(e,"class","dark:bg-slate-900"),e.__value=o=t[9].name??t[8],ge(e,e.__value)},m(l,c){P(l,e,c),_(e,r)},p(l,c){c&2&&n!==(n=(l[9].name??l[8])+"")&&pe(r,n),c&2&&o!==(o=l[9].name??l[8])&&(e.__value=o,ge(e,e.__value))},d(l){l&&R(e)}}}function Lt(t){let e;return{c(){e=b("p"),e.textContent=`You have no plugins installed. Click the + button and select a plugin's
						bolt.json file to add it.`},m(n,r){P(n,e,r)},d(n){n&&R(e)}}}function _s(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y,x;n=new lt({}),n.$on("click",t[4]);let v={ctx:t,current:null,token:null,hasCatch:!0,pending:fs,then:as,catch:is,value:12};ut(p=t[2],v);function k(H,J){return Re?hs:ps}let L=k()(t);return{c(){e=b("div"),te(n.$$.fragment),r=M(),o=b("div"),l=b("button"),l.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=M(),i=b("div"),u=b("button"),u.textContent="Manage Plugins",a=M(),d=b("hr"),f=M(),v.block.c(),m=M(),g=b("div"),L.c(),h(l,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),h(u,"class","mx-auto mb-2 w-[95%] rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),h(d,"class","p-1 dark:border-slate-700"),h(i,"class","left-0 float-left h-full w-[min(180px,_50%)] overflow-hidden border-r-2 border-slate-300 pt-2 dark:border-slate-800"),h(g,"class","h-full pt-10"),h(o,"class","absolute left-[5%] top-[5%] z-20 h-[90%] w-[90%] rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900")},m(H,J){P(H,e,J),K(n,e,null),_(e,r),_(e,o),_(o,l),_(o,c),_(o,i),_(i,u),_(i,a),_(i,d),_(i,f),v.block.m(i,v.anchor=null),v.mount=()=>i,v.anchor=null,_(o,m),_(o,g),L.m(g,null),w=!0,y||(x=[O(l,"click",t[4]),O(u,"click",gs)],y=!0)},p(H,[J]){t=H,v.ctx=t,J&4&&p!==(p=t[2])&&ut(p,v)||en(v,t,J),L.p(t,J)},i(H){w||(A(n.$$.fragment,H),w=!0)},o(H){D(n.$$.fragment,H),w=!1},d(H){H&&R(e),Q(n),v.block.d(),v.token=null,v=null,L.d(),y=!1,ie(x)}}}const gs=()=>{};function bs(t,e,n){let r,o;$(t,Pe,f=>n(1,r=f)),$(t,Ke,f=>n(2,o=f));let{showPluginMenu:l}=e;const c=(f,p)=>{var m=new XMLHttpRequest;m.onreadystatechange=()=>{if(m.readyState==4){const g=JSON.parse(m.responseText);if(!g.name)console.error(`Config file '${p}' missing required field "name"`);else{const w=g.name.replaceAll("@","-").replaceAll(" ","-").toLowerCase().concat(g.version?`-${g.version}`:"");Object.keys(le(Pe)).includes(w)?console.error(`Config file '${p}' gives id '${w}', which is already installed`):(N(Pe,r[w]={name:g.name,path:f},r),kn())}}},m.open("GET","/read-json-file?".concat(new URLSearchParams({path:p}).toString()),!0),m.send()};let i=!1;const u=()=>{n(0,i=!0);var f=new XMLHttpRequest;f.onreadystatechange=()=>{if(f.readyState==4&&(n(0,i=!1),f.status==200)){const p=le(Ge)==="windows"?f.responseText.replaceAll("\\","/"):f.responseText;if(p.endsWith("/bolt.json")){const m=p.substring(0,p.length-9);c(m,p)}else console.log(`Selection '${p}' is not named bolt.json; ignored`)}},f.open("GET","/json-file-picker",!0),f.send()};Ke.set(Ut());const a=()=>{i||n(5,l=!1)};function d(f){f.key==="Escape"&&a()}return addEventListener("keydown",d),nt(()=>{removeEventListener("keydown",d)}),t.$$set=f=>{"showPluginMenu"in f&&n(5,l=f.showPluginMenu)},[i,r,o,u,a,l]}class ms extends oe{constructor(e){super(),re(this,e,bs,_s,ne,{showPluginMenu:5})}}function ks(t){let e,n,r,o,l,c,i,u,a,d,f,p,m,g,w,y,x=t[1]&&xt(t),v=t[0]&&Ct(t),k=t[3]&&Rt();function S(T){t[6](T)}let L={};t[0]!==void 0&&(L.showSettings=t[0]),o=new Rn({props:L}),B.push(()=>Ie(o,"showSettings",S));function H(T){t[7](T)}let J={};return t[1]!==void 0&&(J.showPluginMenu=t[1]),d=new os({props:J}),B.push(()=>Ie(d,"showPluginMenu",H)),w=new Kn({}),{c(){x&&x.c(),e=M(),v&&v.c(),n=M(),k&&k.c(),r=M(),te(o.$$.fragment),c=M(),i=b("div"),u=b("div"),a=M(),te(d.$$.fragment),p=M(),m=b("div"),g=M(),te(w.$$.fragment),h(i,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(T,C){x&&x.m(T,C),P(T,e,C),v&&v.m(T,C),P(T,n,C),k&&k.m(T,C),P(T,r,C),K(o,T,C),P(T,c,C),P(T,i,C),_(i,u),_(i,a),K(d,i,null),_(i,p),_(i,m),P(T,g,C),K(w,T,C),y=!0},p(T,C){T[1]?x?(x.p(T,C),C&2&&A(x,1)):(x=xt(T),x.c(),A(x,1),x.m(e.parentNode,e)):x&&(ke(),D(x,1,1,()=>{x=null}),we()),T[0]?v?(v.p(T,C),C&1&&A(v,1)):(v=Ct(T),v.c(),A(v,1),v.m(n.parentNode,n)):v&&(ke(),D(v,1,1,()=>{v=null}),we()),T[3]?k?C&8&&A(k,1):(k=Rt(),k.c(),A(k,1),k.m(r.parentNode,r)):k&&(ke(),D(k,1,1,()=>{k=null}),we());const E={};!l&&C&1&&(l=!0,E.showSettings=T[0],Ee(()=>l=!1)),o.$set(E);const ee={};!f&&C&2&&(f=!0,ee.showPluginMenu=T[1],Ee(()=>f=!1)),d.$set(ee)},i(T){y||(A(x),A(v),A(k),A(o.$$.fragment,T),A(d.$$.fragment,T),A(w.$$.fragment,T),y=!0)},o(T){D(x),D(v),D(k),D(o.$$.fragment,T),D(d.$$.fragment,T),D(w.$$.fragment,T),y=!1},d(T){T&&(R(e),R(n),R(r),R(c),R(i),R(g)),x&&x.d(T),v&&v.d(T),k&&k.d(T),Q(o,T),Q(d),Q(w,T)}}}function ws(t){let e,n;return e=new cs({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},p:j,i(r){n||(A(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function xt(t){let e,n,r;function o(c){t[4](c)}let l={};return t[1]!==void 0&&(l.showPluginMenu=t[1]),e=new ms({props:l}),B.push(()=>Ie(e,"showPluginMenu",o)),{c(){te(e.$$.fragment)},m(c,i){K(e,c,i),r=!0},p(c,i){const u={};!n&&i&2&&(n=!0,u.showPluginMenu=c[1],Ee(()=>n=!1)),e.$set(u)},i(c){r||(A(e.$$.fragment,c),r=!0)},o(c){D(e.$$.fragment,c),r=!1},d(c){Q(e,c)}}}function Ct(t){let e,n,r;function o(c){t[5](c)}let l={};return t[0]!==void 0&&(l.showSettings=t[0]),e=new Fn({props:l}),B.push(()=>Ie(e,"showSettings",o)),{c(){te(e.$$.fragment)},m(c,i){K(e,c,i),r=!0},p(c,i){const u={};!n&&i&1&&(n=!0,u.showSettings=c[0],Ee(()=>n=!1)),e.$set(u)},i(c){r||(A(e.$$.fragment,c),r=!0)},o(c){D(e.$$.fragment,c),r=!1},d(c){Q(e,c)}}}function Rt(t){let e,n;return e=new In({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(A(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function ys(t){let e,n,r,o;const l=[ws,ks],c=[];function i(u,a){return u[2]?0:1}return n=i(t),r=c[n]=l[n](t),{c(){e=b("main"),r.c(),h(e,"class","h-full")},m(u,a){P(u,e,a),c[n].m(e,null),o=!0},p(u,[a]){let d=n;n=i(u),n===d?c[n].p(u,a):(ke(),D(c[d],1,1,()=>{c[d]=null}),we(),r=c[n],r?r.p(u,a):(r=c[n]=l[n](u),r.c()),A(r,1),r.m(e,null))},i(u){o||(A(r),o=!0)},o(u){D(r),o=!1},d(u){u&&R(e),c[n].d()}}}function vs(t,e,n){let r;$(t,Be,p=>n(3,r=p));let o=!1,l=!1,c=!1;cn();const i=window.opener||window.parent;if(i){const p=new URLSearchParams(window.location.search);p.get("id_token")?(c=!0,i.postMessage({type:"gameSessionServerAuth",code:p.get("code"),id_token:p.get("id_token"),state:p.get("state")},"*")):p.get("code")&&(c=!0,i.postMessage({type:"authCode",code:p.get("code"),state:p.get("state")},"*"))}function u(p){l=p,n(1,l)}function a(p){o=p,n(0,o)}function d(p){o=p,n(0,o)}function f(p){l=p,n(1,l)}return[o,l,c,r,u,a,d,f]}class Ss extends oe{constructor(e){super(),re(this,e,vs,ys,ne,{})}}new Ss({target:document.getElementById("app")});const ce=[],Ls=le(Ht);let V;ce.push(rt.subscribe(t=>V=t));let se;ce.push(U.subscribe(t=>se=t));ce.push(Ge.subscribe(t=>t));let _e;ce.push(me.subscribe(t=>_e=t));ce.push(Re.subscribe(t=>t??!1));let ae;ce.push(Xe.subscribe(t=>ae=t));let ct;ce.push(ot.subscribe(t=>ct=t));ce.push(ye.subscribe(t=>t));ce.push(Ue.subscribe(t=>t));let Je;ce.push(W.subscribe(t=>Je=t));function xs(){var o;const t=atob(V.origin),e=atob(V.clientid),n=t.concat("/oauth2/token");_e.size==0&&Be.set(!0),on(),se.selected_game_accounts&&((o=se.selected_game_accounts)==null?void 0:o.size)>0&&U.update(l=>{var c;return l.selected_characters=l.selected_game_accounts,(c=l.selected_game_accounts)==null||c.clear(),l});const r=[Ls,t,atob(V.origin_2fa)];window.addEventListener("message",l=>{if(!r.includes(l.origin)){X(`discarding window message from origin ${l.origin}`);return}let c=ae;const i=new XMLHttpRequest;switch(l.data.type){case"authCode":if(c){Xe.set({});const u=new URLSearchParams({grant_type:"authorization_code",client_id:atob(V.clientid),code:l.data.code,code_verifier:c.verifier,redirect_uri:atob(V.redirect)});i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const a=Ot(i.response),d=It(a);d?dt(c==null?void 0:c.win,d).then(f=>{f&&(me.update(p=>(p.set(d.sub,d),p)),Te())}):(G("Error: invalid credentials received",!1),c.win.close())}else G(`Error: from ${n}: ${i.status}: ${i.response}`,!1),c.win.close()},i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","application/json"),i.send(u)}break;case"externalUrl":i.onreadystatechange=()=>{i.readyState==4&&X(`External URL status: '${i.responseText.trim()}'`)},i.open("POST","/open-external-url",!0),i.send(l.data.url);break;case"gameSessionServerAuth":if(c=ct.find(u=>l.data.state==u.state),c){ln(c,!0);const u=l.data.id_token.split(".");if(u.length!==3){G(`Malformed id_token: ${u.length} sections, expected 3`,!1);break}const a=JSON.parse(atob(u[0]));if(a.typ!=="JWT"){G(`Bad id_token header: typ ${a.typ}, expected JWT`,!1);break}const d=JSON.parse(atob(u[1]));if(atob(d.nonce)!==c.nonce){G("Incorrect nonce in id_token",!1);break}const f=atob(V.auth_api).concat("/sessions");i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const p=atob(V.auth_api).concat("/accounts");c.creds.session_id=JSON.parse(i.response).sessionId,Dt(c.creds,p,c.account_info_promise).then(m=>{m&&(me.update(g=>{var w;return g.set((w=c==null?void 0:c.creds)==null?void 0:w.sub,c.creds),g}),Te())})}else G(`Error: from ${f}: ${i.status}: ${i.response}`,!1)},i.open("POST",f,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json"),i.send(`{"idToken": "${l.data.id_token}"}`)}break;case"gameClientListUpdate":Ke.set(Ut());break;default:X("Unknown message type: ".concat(l.data.type));break}}),(async()=>(_e.size>0&&_e.forEach(async l=>{const c=await jt(l,n,e);c!==null&&c!==0&&(G(`Discarding expired login for #${l.sub}`,!1),me.update(u=>(u.delete(l.sub),u)),Te());let i;if(c===null&&await dt(null,l)?i={creds:l,valid:!0}:i={creds:l,valid:c===0},i.valid){const u=l;me.update(a=>(a.set(u.sub,u),a)),Te()}}),z.set(!1)))()}function X(t){console.log(t);const e={isError:!1,text:t,time:new Date(Date.now())};ye.update(n=>(n.unshift(e),n))}function G(t,e){const n={isError:!0,text:t,time:new Date(Date.now())};if(ye.update(r=>(r.unshift(n),r)),!e)console.error(t);else throw new Error(t)}rt.set(s());onload=()=>xs();onunload=()=>{for(const t in ce)delete ce[t];$e()};
