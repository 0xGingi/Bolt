var jt=Object.defineProperty;var Dt=(t,e,n)=>e in t?jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Xe=(t,e,n)=>(Dt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function N(){}function Ut(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function Lt(t){return t()}function it(){return Object.create(null)}function ce(t){t.forEach(Lt)}function xt(t){return typeof t=="function"}function ne(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let He;function Bt(t,e){return t===e?!0:(He||(He=document.createElement("a")),He.href=e,t===He.href)}function qt(t){return Object.keys(t).length===0}function Ct(t,...e){if(t==null){for(const r of e)r(void 0);return N}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function de(t){let e;return Ct(t,n=>e=n)(),e}function X(t,e,n){t.$$.on_destroy.push(Ct(e,n))}function H(t,e,n){return t.set(n),e}function p(t,e){t.appendChild(e)}function I(t,e,n){t.insertBefore(e,n||null)}function E(t){t.parentNode&&t.parentNode.removeChild(t)}function Ue(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function W(t){return document.createTextNode(t)}function P(){return W(" ")}function Be(){return W("")}function j(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Jt(t){return Array.from(t.childNodes)}function he(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ce(t,e){t.value=e??""}function Gt(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Me;function ue(t){Me=t}function Ee(){if(!Me)throw new Error("Function called outside component initialization");return Me}function Ie(t){Ee().$$.on_mount.push(t)}function Xt(t){Ee().$$.after_update.push(t)}function et(t){Ee().$$.on_destroy.push(t)}function zt(){const t=Ee();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const l=Gt(e,n,{cancelable:r});return o.slice().forEach(c=>{c.call(t,l)}),!l.defaultPrevented}return!0}}const Le=[],q=[];let xe=[];const Fe=[],$t=Promise.resolve();let Ve=!1;function Ft(){Ve||(Ve=!0,$t.then(tt))}function We(t){xe.push(t)}function Pe(t){Fe.push(t)}const ze=new Set;let ve=0;function tt(){if(ve!==0)return;const t=Me;do{try{for(;ve<Le.length;){const e=Le[ve];ve++,ue(e),Vt(e.$$)}}catch(e){throw Le.length=0,ve=0,e}for(ue(null),Le.length=0,ve=0;q.length;)q.pop()();for(let e=0;e<xe.length;e+=1){const n=xe[e];ze.has(n)||(ze.add(n),n())}xe.length=0}while(Le.length);for(;Fe.length;)Fe.pop()();Ve=!1,ze.clear(),ue(t)}function Vt(t){if(t.fragment!==null){t.update(),ce(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(We)}}function Wt(t){const e=[],n=[];xe.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),xe=e}const Ne=new Set;let ge;function me(){ge={r:0,c:[],p:ge}}function ke(){ge.r||ce(ge.c),ge=ge.p}function O(t,e){t&&t.i&&(Ne.delete(t),t.i(e))}function D(t,e,n,r){if(t&&t.o){if(Ne.has(t))return;Ne.add(t),ge.c.push(()=>{Ne.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function at(t,e){const n=e.token={};function r(o,l,c,i){if(e.token!==n)return;e.resolved=i;let a=e.ctx;c!==void 0&&(a=a.slice(),a[c]=i);const u=o&&(e.current=o)(a);let d=!1;e.block&&(e.blocks?e.blocks.forEach((h,_)=>{_!==l&&h&&(me(),D(h,1,1,()=>{e.blocks[_]===h&&(e.blocks[_]=null)}),ke())}):e.block.d(1),u.c(),O(u,1),u.m(e.mount(),e.anchor),d=!0),e.block=u,e.blocks&&(e.blocks[l]=u),d&&tt()}if(Ut(t)){const o=Ee();if(t.then(l=>{ue(o),r(e.then,1,e.value,l),ue(null)},l=>{if(ue(o),r(e.catch,2,e.error,l),ue(null),!e.hasCatch)throw l}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Zt(t,e,n){const r=e.slice(),{resolved:o}=t;t.current===t.then&&(r[t.value]=o),t.current===t.catch&&(r[t.error]=o),t.block.p(r,n)}function _e(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Te(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function te(t){t&&t.c()}function K(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),We(()=>{const l=t.$$.on_mount.map(Lt).filter(xt);t.$$.on_destroy?t.$$.on_destroy.push(...l):ce(l),t.$$.on_mount=[]}),o.forEach(We)}function Q(t,e){const n=t.$$;n.fragment!==null&&(Wt(n.after_update),ce(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Yt(t,e){t.$$.dirty[0]===-1&&(Le.push(t),Ft(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function re(t,e,n,r,o,l,c=null,i=[-1]){const a=Me;ue(t);const u=t.$$={fragment:null,ctx:[],props:l,update:N,not_equal:o,bound:it(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:it(),dirty:i,skip_bound:!1,root:e.target||a.$$.root};c&&c(u.root);let d=!1;if(u.ctx=n?n(t,e.props||{},(h,_,...v)=>{const m=v.length?v[0]:_;return u.ctx&&o(u.ctx[h],u.ctx[h]=m)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](m),d&&Yt(t,h)),_}):[],u.update(),d=!0,ce(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const h=Jt(e.target);u.fragment&&u.fragment.l(h),h.forEach(E)}else u.fragment&&u.fragment.c();e.intro&&O(t.$$.fragment),K(t,e.target,e.anchor),tt()}ue(a)}class oe{constructor(){Xe(this,"$$");Xe(this,"$$set")}$destroy(){Q(this,1),this.$destroy=N}$on(e,n){if(!xt(n))return N;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!qt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Kt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kt);const Se=[];function Rt(t,e){return{subscribe:Z(t,e).subscribe}}function Z(t,e=N){let n;const r=new Set;function o(i){if(ne(t,i)&&(t=i,n)){const a=!Se.length;for(const u of r)u[1](),Se.push(u,t);if(a){for(let u=0;u<Se.length;u+=2)Se[u][0](Se[u+1]);Se.length=0}}}function l(i){o(i(t))}function c(i,a=N){const u=[i,a];return r.add(u),r.size===1&&(n=e(o,l)||N),i(t),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:o,update:l,subscribe:c}}function Mt(t){if(t.ok)return t.value;throw t.error}var Y=(t=>(t[t.rs3=0]="rs3",t[t.osrs=1]="osrs",t))(Y||{}),ae=(t=>(t[t.runeLite=0]="runeLite",t[t.hdos=1]="hdos",t[t.rs3=2]="rs3",t))(ae||{});const Qt={use_dark_theme:!0,flatpak_rich_presence:!1,rs_config_uri:"",runelite_custom_jar:"",runelite_use_custom_jar:!1,selected_account:"",selected_characters:new Map,selected_game_accounts:new Map,selected_game_index:1,selected_client_index:1},Pt=Rt("https://bolt-internal"),en=Rt("1fddee4e-b100-4f4e-b2b0-097f9088f9d2"),nt=Z(),st=Z(""),B=Z({...Qt}),be=Z(new Map),qe=Z(!1),Ze=Z(),we=Z([]),Je=Z({}),rt=Z([]),Ye=Z(""),Ke=Z(""),Qe=Z(""),z=Z(!1),Oe=Z(new Map),F=Z({game:Y.osrs,client:ae.runeLite}),je=Z(!1);function tn(){se.use_dark_theme==!1&&document.documentElement.classList.remove("dark")}function nn(t,e){e&&t.win.close(),rt.update(n=>(n.splice(lt.indexOf(t),1),n))}function Tt(){if(ie&&ie.win&&!ie.win.closed)ie.win.focus();else if(ie&&ie.win&&ie.win.closed||ie){const t=Ht(),e=on();rn({origin:atob($.origin),redirect:atob($.redirect),authMethod:"",loginType:"",clientid:atob($.clientid),flow:"launcher",pkceState:t,pkceCodeVerifier:e}).then(n=>{const r=window.open(n,"","width=480,height=720");Je.set({state:t,verifier:e,win:r})})}}function sn(){const t=new URLSearchParams(window.location.search);st.set(t.get("platform")),t.get("flathub"),Ye.set(t.get("rs3_linux_installed_hash")),Ke.set(t.get("runelite_installed_id")),Qe.set(t.get("hdos_installed_version")),qe.set(t.get("plugins")==="1");const e=t.get("credentials");if(e)try{JSON.parse(e).forEach(o=>{be.update(l=>(l.set(o.sub,o),l))})}catch(r){J(`Couldn't parse credentials file: ${r}`,!1)}const n=t.get("config");if(n)try{const r=JSON.parse(n);B.set(r),B.update(o=>(o.selected_game_accounts?(o.selected_characters=new Map(Object.entries(o.selected_game_accounts)),delete o.selected_game_accounts):o.selected_characters&&(o.selected_characters=new Map(Object.entries(o.selected_characters))),o))}catch(r){J(`Couldn't parse config file: ${r}`,!1)}}async function Et(t,e,n){return new Promise(r=>{if(t.expiry-Date.now()<3e4){const o=new URLSearchParams({grant_type:"refresh_token",client_id:n,refresh_token:t.refresh_token}),l=new XMLHttpRequest;l.onreadystatechange=()=>{if(l.readyState==4)if(l.status==200){const c=It(l.response),i=Mt(c);i?(t.access_token=i.access_token,t.expiry=i.expiry,t.id_token=i.id_token,t.login_provider=i.login_provider,t.refresh_token=i.refresh_token,i.session_id&&(t.session_id=i.session_id),t.sub=i.sub,r(null)):r(0)}else r(l.status)},l.onerror=()=>{r(0)},l.open("POST",e,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader("Accept","application/json"),l.send(o)}else r(null)})}function It(t){const e=JSON.parse(t),n=e.id_token.split(".");if(n.length!==3){const l=`Malformed id_token: ${n.length} sections, expected 3`;return J(l,!1),{ok:!1,error:new Error(l)}}const r=JSON.parse(atob(n[0]));if(r.typ!=="JWT"){const l=`Bad id_token header: typ ${r.typ}, expected JWT`;return J(l,!1),{ok:!1,error:new Error(l)}}const o=JSON.parse(atob(n[1]));return{ok:!0,value:{access_token:e.access_token,id_token:e.id_token,refresh_token:e.refresh_token,sub:o.sub,login_provider:o.login_provider||null,expiry:Date.now()+e.expires_in*1e3,session_id:e.session_id}}}async function rn(t){const e=new TextEncoder().encode(t.pkceCodeVerifier),n=await crypto.subtle.digest("SHA-256",e);let r="";const o=new Uint8Array(n);for(let c=0;c<o.byteLength;c++)r+=String.fromCharCode(o[c]);const l=btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return t.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:t.authMethod,login_type:t.loginType,flow:t.flow,response_type:"code",client_id:t.clientid,redirect_uri:t.redirect,code_challenge:l,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:t.pkceState}).toString())}function on(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=new Uint32Array(43);return crypto.getRandomValues(e),Array.from(e,function(n){return t[n%t.length]}).join("")}function Ht(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e.length-1,r=crypto.getRandomValues(new Uint8Array(12));return Array.from(r).map(o=>Math.round(o*(n-0)/255+0)).map(o=>e[o]).join("")}async function Nt(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState==4&&(o.status==200?n.then(l=>{if(typeof l!="number"){const c={id:l.id,userId:l.userId,displayName:l.displayName,suffix:l.suffix,characters:new Map};G(`Successfully added login for ${c.displayName}`),JSON.parse(o.response).forEach(i=>{c.characters.set(i.accountId,{accountId:i.accountId,displayName:i.displayName,userHash:i.userHash})}),an(c),r(!0)}else J(`Error getting account info: ${l}`,!1),r(!1)}):(J(`Error: from ${e}: ${o.status}: ${o.response}`,!1),r(!1)))},o.open("GET",e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(t.session_id)),o.send()})}async function ut(t,e){return await ln(t,e)}async function ln(t,e){const n=Ht(),r=crypto.randomUUID(),o=atob($.origin).concat("/oauth2/auth?").concat(new URLSearchParams({id_token_hint:e.id_token,nonce:btoa(r),prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:n,client_id:de(en),scope:"openid offline"}).toString()),l=cn(e);return t?(t.location.href=o,rt.update(c=>(c.push({state:n,nonce:r,creds:e,win:t,account_info_promise:l}),c)),!1):e.session_id?await Nt(e,atob($.auth_api).concat("/accounts"),l):(J("Rejecting stored credentials with missing session_id",!1),!1)}function cn(t){return new Promise(e=>{const n=`${atob($.api)}/users/${t.sub}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{r.readyState==4&&(r.status==200?e(JSON.parse(r.response)):e(r.status))},r.open("GET",n,!0),r.setRequestHeader("Authorization","Bearer ".concat(t.access_token)),r.send()})}function an(t){const e=()=>{F.update(n=>{n.account=t;const[r]=t.characters.keys();return n.character=t.characters.get(r),pe.size>0&&(n.credentials=pe.get(t.userId)),n})};Oe.update(n=>(n.set(t.userId,t),n)),De.account&&se.selected_account?t.userId==se.selected_account&&e():De.account||e(),Je.set({})}function un(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.open("POST",e,!0),o.onreadystatechange=()=>{o.readyState==4&&r(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(new URLSearchParams({token:t,client_id:n}))})}async function Re(){const t=new XMLHttpRequest;t.open("POST","/save-credentials",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{t.readyState==4&&G(`Save-credentials status: ${t.responseText.trim()}`)},F.update(n=>{var r;return n.credentials=pe.get((r=De.account)==null?void 0:r.userId),n});const e=[];pe.forEach(n=>{e.push(n)}),t.send(JSON.stringify(e))}function dn(t,e,n){Ge();const r=(i,a)=>{const u=new XMLHttpRequest,d={};i&&(d.hash=i),t&&(d.jx_session_id=t),e&&(d.jx_character_id=e),n&&(d.jx_display_name=n),se.rs_config_uri?d.config_uri=se.rs_config_uri:d.config_uri=atob($.default_config_uri),u.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(d).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(G(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&i&&Ye.set(i))},u.send(a)},o=new XMLHttpRequest,l=atob($.content_url),c=l.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",c,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const i=Object.fromEntries(o.response.split(`
`).map(a=>a.split(": ")));if(!i.Filename||!i.Size){J(`Could not parse package data from URL: ${c}`,!1),r();return}if(i.SHA256!==de(Ye)){G("Downloading RS3 client...");const a=new XMLHttpRequest;a.open("GET",l.concat(i.Filename),!0),a.responseType="arraybuffer",a.onprogress=u=>{u.loaded&&we.update(d=>(d[0].text=`Downloading RS3 client... ${(Math.round(1e3*u.loaded/u.total)/10).toFixed(1)}%`,d))},a.onreadystatechange=()=>{a.readyState==4&&a.status==200&&r(i.SHA256,a.response)},a.onerror=()=>{J(`Error downloading game client: from ${c}: non-http error`,!1),r()},a.send()}else G("Latest client is already installed"),r()}},o.onerror=()=>{J(`Error: from ${c}: non-http error`,!1),r()},o.send()}function At(t,e,n,r){Ge();const o=r?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",l=(a,u,d)=>{const h=new XMLHttpRequest,_={};a&&(_.id=a),d&&(_.jar_path=d),t&&(_.jx_session_id=t),e&&(_.jx_character_id=e),n&&(_.jx_display_name=n),se.flatpak_rich_presence&&(_.flatpak_rich_presence=""),h.open(u?"POST":"GET",o.concat(new URLSearchParams(_).toString()),!0),h.onreadystatechange=()=>{h.readyState==4&&(G(`Game launch status: '${h.responseText.trim()}'`),h.status==200&&a&&Ke.set(a))},h.send(u)};if(se.runelite_use_custom_jar){l(null,null,se.runelite_custom_jar);return}const c=new XMLHttpRequest,i="https://api.github.com/repos/runelite/launcher/releases";c.open("GET",i,!0),c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const a=JSON.parse(c.responseText).map(u=>u.assets).flat().find(u=>u.name.toLowerCase()=="runelite.jar");if(a.id!=de(Ke)){G("Downloading RuneLite...");const u=new XMLHttpRequest;u.open("GET",a.browser_download_url,!0),u.responseType="arraybuffer",u.onreadystatechange=()=>{u.readyState==4&&(u.status==200?l(a.id,u.response):J(`Error downloading from ${a.url}: ${u.status}: ${u.responseText}`,!1))},u.onprogress=d=>{d.loaded&&d.lengthComputable&&we.update(h=>(h[0].text=`Downloading RuneLite... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,h))},u.send()}else G("Latest JAR is already installed"),l()}else J(`Error from ${i}: ${c.status}: ${c.responseText}`,!1)},c.send()}function fn(t,e,n){return At(t,e,n,!1)}function pn(t,e,n){return At(t,e,n,!0)}function hn(t,e,n){Ge();const r=(c,i)=>{const a=new XMLHttpRequest,u={};c&&(u.version=c),t&&(u.jx_session_id=t),e&&(u.jx_character_id=e),n&&(u.jx_display_name=n),a.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(u).toString()),!0),a.onreadystatechange=()=>{a.readyState==4&&(G(`Game launch status: '${a.responseText.trim()}'`),a.status==200&&c&&Qe.set(c))},a.send(i)},o=new XMLHttpRequest,l="https://cdn.hdos.dev/client/getdown.txt";o.open("GET",l,!0),o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const c=o.responseText.match(/^launcher\.version *= *(.*?)$/m);if(c&&c.length>=2){const i=c[1];if(i!==de(Qe)){const a=`https://cdn.hdos.dev/launcher/v${i}/hdos-launcher.jar`;G("Downloading HDOS...");const u=new XMLHttpRequest;u.open("GET",a,!0),u.responseType="arraybuffer",u.onreadystatechange=()=>{if(u.readyState==4)if(u.status==200)r(i,u.response);else{const d=JSON.parse(o.responseText).map(h=>h.assets).flat().find(h=>h.name.toLowerCase()=="runelite.jar");J(`Error downloading from ${d.url}: ${u.status}: ${u.responseText}`,!1)}},u.onprogress=d=>{d.loaded&&d.lengthComputable&&we.update(h=>(h[0].text=`Downloading HDOS... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,h))},u.send()}else G("Latest JAR is already installed"),r()}else G("Couldn't parse latest launcher version"),r()}else J(`Error from ${l}: ${o.status}: ${o.responseText}`,!1)},o.send()}let $e=!1;function Ge(){var t;if(de(z)&&!$e){$e=!0;const e=new XMLHttpRequest;e.open("POST","/save-config",!0),e.onreadystatechange=()=>{e.readyState==4&&(G(`Save config status: '${e.responseText.trim()}'`),e.status==200&&z.set(!1),$e=!1)},e.setRequestHeader("Content-Type","application/json");const n={};(t=se.selected_characters)==null||t.forEach((l,c)=>{n[c]=l});const r={};Object.assign(r,se),r.selected_characters=n;const o=JSON.stringify(r,null,4);e.send(o)}}function Ot(){return new Promise((t,e)=>{const n=new XMLHttpRequest,r=de(Pt).concat("/list-game-clients");n.open("GET",r,!0),n.onreadystatechange=()=>{if(n.readyState==4)if(n.status==200&&n.getResponseHeader("content-type")==="application/json"){const o=JSON.parse(n.responseText);t(Object.keys(o).map(l=>({uid:l,identity:o[l].identity||null})))}else e(`error (${n.responseText})`)},n.send()})}function dt(t,e,n){const r=t.slice();return r[22]=e[n],r}function ft(t){let e,n=t[22][1].displayName+"",r,o,l;return{c(){e=b("option"),r=W(n),f(e,"data-id",o=t[22][1].userId),f(e,"class","dark:bg-slate-900"),e.__value=l=t[22][1].displayName,Ce(e,e.__value)},m(c,i){I(c,e,i),p(e,r)},p(c,i){i&4&&n!==(n=c[22][1].displayName+"")&&he(r,n),i&4&&o!==(o=c[22][1].userId)&&f(e,"data-id",o),i&4&&l!==(l=c[22][1].displayName)&&(e.__value=l,Ce(e,e.__value))},d(c){c&&E(e)}}}function _n(t){let e,n,r,o,l,c,i,a,u,d=_e(t[2]),h=[];for(let _=0;_<d.length;_+=1)h[_]=ft(dt(t,d,_));return{c(){e=b("div"),n=b("select");for(let _=0;_<h.length;_+=1)h[_].c();r=P(),o=b("div"),l=b("button"),l.textContent="Log In",c=P(),i=b("button"),i.textContent="Log Out",f(n,"name","account_select"),f(n,"id","account_select"),f(n,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),f(l,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(i,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),f(o,"class","mt-5 flex"),f(e,"class","z-10 w-48 rounded-lg border-2 border-slate-300 bg-slate-100 p-3 shadow dark:border-slate-800 dark:bg-slate-900"),f(e,"role","none")},m(_,v){I(_,e,v),p(e,n);for(let m=0;m<h.length;m+=1)h[m]&&h[m].m(n,null);t[7](n),p(e,r),p(e,o),p(o,l),p(o,c),p(o,i),a||(u=[j(n,"change",t[8]),j(l,"click",t[9]),j(i,"click",t[10]),j(e,"mouseenter",t[11]),j(e,"mouseleave",t[12])],a=!0)},p(_,[v]){if(v&4){d=_e(_[2]);let m;for(m=0;m<d.length;m+=1){const R=dt(_,d,m);h[m]?h[m].p(R,v):(h[m]=ft(R),h[m].c(),h[m].m(n,null))}for(;m<h.length;m+=1)h[m].d(1);h.length=d.length}},i:N,o:N,d(_){_&&E(e),Ue(h,_),t[7](null),a=!1,ce(u)}}}function gn(t,e,n){let r,o,l,c;X(t,F,L=>n(13,r=L)),X(t,be,L=>n(14,o=L)),X(t,Oe,L=>n(2,l=L)),X(t,B,L=>n(15,c=L));let{showAccountDropdown:i}=e,{hoverAccountButton:a}=e;const u=atob($.origin),d=atob($.clientid),h=u.concat("/oauth2/token"),_=u.concat("/oauth2/revoke");let v=!1,m;function R(L){a||L.button===0&&i&&!v&&n(5,i=!1)}function k(){var ee;if(m.options.length==0){G("Logout unsuccessful: no account selected");return}let L=r.credentials;r.account&&(l.delete((ee=r.account)==null?void 0:ee.userId),Oe.set(l));const M=m.selectedIndex;M>0?n(1,m.selectedIndex=M-1,m):M==0&&l.size>0?n(1,m.selectedIndex=M+1,m):(delete r.account,delete r.character,delete r.credentials),y(),L&&Et(L,h,d).then(U=>{U===null?un(L.access_token,_,d).then(T=>{T===200?(G("Successful logout"),S(L)):J(`Logout unsuccessful: status ${T}`,!1)}):U===400||U===401?(G("Logout unsuccessful: credentials are invalid, so discarding them anyway"),L&&S(L)):J("Logout unsuccessful: unable to verify credentials due to a network error",!1)})}function S(L){o.delete(L.sub),Re()}function y(){var M;z.set(!0);const L=m[m.selectedIndex].getAttribute("data-id");if(H(F,r.account=l.get(L),r),H(B,c.selected_account=L,c),H(F,r.credentials=o.get((M=r.account)==null?void 0:M.userId),r),r.account&&r.account.characters){const ee=document.getElementById("character_select");ee.selectedIndex=0;const[U]=r.account.characters.keys();H(F,r.character=r.account.characters.get(U),r)}}addEventListener("mousedown",R),Ie(()=>{var M;let L=0;l.forEach((ee,U)=>{var T;ee.displayName==((T=r.account)==null?void 0:T.displayName)&&n(1,m.selectedIndex=L,m),L++}),H(F,r.credentials=o.get((M=r.account)==null?void 0:M.userId),r)}),et(()=>{removeEventListener("mousedown",R)});function g(L){q[L?"unshift":"push"](()=>{m=L,n(1,m)})}const w=()=>{y()},x=()=>{Tt()},A=()=>{k()},V=()=>{n(0,v=!0)},C=()=>{n(0,v=!1)};return t.$$set=L=>{"showAccountDropdown"in L&&n(5,i=L.showAccountDropdown),"hoverAccountButton"in L&&n(6,a=L.hoverAccountButton)},[v,m,l,k,y,i,a,g,w,x,A,V,C]}class bn extends oe{constructor(e){super(),re(this,e,gn,_n,ne,{showAccountDropdown:5,hoverAccountButton:6})}}function mn(t){let e;return{c(){e=W("Log In")},m(n,r){I(n,e,r)},p:N,d(n){n&&E(e)}}}function kn(t){var r;let e=((r=t[6].account)==null?void 0:r.displayName)+"",n;return{c(){n=W(e)},m(o,l){I(o,n,l)},p(o,l){var c;l&64&&e!==(e=((c=o[6].account)==null?void 0:c.displayName)+"")&&he(n,e)},d(o){o&&E(n)}}}function pt(t){let e,n,r,o;function l(i){t[20](i)}let c={hoverAccountButton:t[2]};return t[1]!==void 0&&(c.showAccountDropdown=t[1]),n=new bn({props:c}),q.push(()=>Te(n,"showAccountDropdown",l)),{c(){e=b("div"),te(n.$$.fragment),f(e,"class","absolute right-2 top-[72px]")},m(i,a){I(i,e,a),K(n,e,null),o=!0},p(i,a){const u={};a&4&&(u.hoverAccountButton=i[2]),!r&&a&2&&(r=!0,u.showAccountDropdown=i[1],Pe(()=>r=!1)),n.$set(u)},i(i){o||(O(n.$$.fragment,i),o=!0)},o(i){D(n.$$.fragment,i),o=!1},d(i){i&&E(e),Q(n)}}}function wn(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k;function S(x,A){return x[6].account?kn:mn}let y=S(t),g=y(t),w=t[1]&&pt(t);return{c(){e=b("div"),n=b("div"),r=b("button"),r.textContent="RS3",o=P(),l=b("button"),l.textContent="OSRS",c=P(),i=b("div"),a=b("button"),a.innerHTML='<img src="svgs/lightbulb-solid.svg" class="h-6 w-6" alt="Change Theme"/>',u=P(),d=b("button"),d.innerHTML='<img src="svgs/gear-solid.svg" class="h-6 w-6" alt="Settings"/>',h=P(),_=b("button"),g.c(),v=P(),w&&w.c(),f(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(l,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),f(n,"class","m-3 ml-9 font-bold"),f(a,"class","my-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(d,"class","m-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(_,"class","m-2 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50"),f(i,"class","ml-auto flex"),f(e,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m(x,A){I(x,e,A),p(e,n),p(n,r),t[10](r),p(n,o),p(n,l),t[12](l),p(e,c),p(e,i),p(i,a),p(i,u),p(i,d),p(i,h),p(i,_),g.m(_,null),t[16](_),p(e,v),w&&w.m(e,null),m=!0,R||(k=[j(r,"click",t[11]),j(l,"click",t[13]),j(a,"click",t[14]),j(d,"click",t[15]),j(_,"mouseenter",t[17]),j(_,"mouseleave",t[18]),j(_,"click",t[19])],R=!0)},p(x,[A]){y===(y=S(x))&&g?g.p(x,A):(g.d(1),g=y(x),g&&(g.c(),g.m(_,null))),x[1]?w?(w.p(x,A),A&2&&O(w,1)):(w=pt(x),w.c(),O(w,1),w.m(e,null)):w&&(me(),D(w,1,1,()=>{w=null}),ke())},i(x){m||(O(w),m=!0)},o(x){D(w),m=!1},d(x){x&&E(e),t[10](null),t[12](null),g.d(),t[16](null),w&&w.d(),R=!1,ce(k)}}}function yn(t,e,n){let r,o,l;X(t,B,M=>n(21,r=M)),X(t,z,M=>n(22,o=M)),X(t,F,M=>n(6,l=M));let{showSettings:c}=e,i=!1,a=!1,u,d,h;function _(){let M=document.documentElement;M.classList.contains("dark")?M.classList.remove("dark"):M.classList.add("dark"),H(B,r.use_dark_theme=!r.use_dark_theme,r),H(z,o=!0,o)}function v(M){switch(M){case Y.osrs:H(F,l.game=Y.osrs,l),H(F,l.client=r.selected_client_index,l),H(B,r.selected_game_index=Y.osrs,r),H(z,o=!0,o),d.classList.add("bg-blue-500","text-black"),u.classList.remove("bg-blue-500","text-black");break;case Y.rs3:H(F,l.game=Y.rs3,l),H(B,r.selected_game_index=Y.rs3,r),H(z,o=!0,o),d.classList.remove("bg-blue-500","text-black"),u.classList.add("bg-blue-500","text-black");break}}function m(){if(h.innerHTML=="Log In"){Tt();return}n(1,i=!i)}Ie(()=>{v(r.selected_game_index)});function R(M){q[M?"unshift":"push"](()=>{u=M,n(3,u)})}const k=()=>{v(Y.rs3)};function S(M){q[M?"unshift":"push"](()=>{d=M,n(4,d)})}const y=()=>{v(Y.osrs)},g=()=>_(),w=()=>{n(0,c=!0)};function x(M){q[M?"unshift":"push"](()=>{h=M,n(5,h)})}const A=()=>{n(2,a=!0)},V=()=>{n(2,a=!1)},C=()=>m();function L(M){i=M,n(1,i)}return t.$$set=M=>{"showSettings"in M&&n(0,c=M.showSettings)},[c,i,a,u,d,h,l,_,v,m,R,k,S,y,g,w,x,A,V,C,L]}class vn extends oe{constructor(e){super(),re(this,e,yn,wn,ne,{showSettings:0})}}function Sn(t){let e,n,r,o,l,c;return{c(){e=b("div"),n=b("div"),n.innerHTML="",r=P(),o=b("div"),o.innerHTML="",f(n,"class","absolute left-0 top-0 z-10 h-screen w-screen backdrop-blur-sm backdrop-filter"),f(o,"class","absolute left-0 top-0 z-10 h-screen w-screen bg-black opacity-75"),f(o,"role","none")},m(i,a){I(i,e,a),p(e,n),p(e,r),p(e,o),l||(c=j(o,"click",t[1]),l=!0)},p:N,i:N,o:N,d(i){i&&E(e),l=!1,c()}}}function Ln(t){const e=zt();return[e,()=>{e("click")}]}class ot extends oe{constructor(e){super(),re(this,e,Ln,Sn,ne,{})}}function xn(t){let e,n,r,o,l,c,i,a,u,d,h,_;return n=new ot({}),{c(){e=b("div"),te(n.$$.fragment),r=P(),o=b("div"),l=b("p"),l.textContent=`${t[1]}`,c=P(),i=b("p"),i.textContent=`${t[2]}`,a=P(),u=b("button"),u.textContent="I Understand",f(l,"class","p-2"),f(i,"class","p-2"),f(u,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(o,"class","absolute left-1/4 top-1/4 z-20 w-1/2 rounded-lg bg-slate-100 p-5 text-center shadow-lg dark:bg-slate-900"),f(e,"id","disclaimer")},m(v,m){I(v,e,m),K(n,e,null),p(e,r),p(e,o),p(o,l),p(o,c),p(o,i),p(o,a),p(o,u),d=!0,h||(_=j(u,"click",t[3]),h=!0)},p:N,i(v){d||(O(n.$$.fragment,v),d=!0)},o(v){D(n.$$.fragment,v),d=!1},d(v){v&&E(e),Q(n),h=!1,_()}}}function Cn(t,e,n){let r;X(t,je,i=>n(0,r=i));const o=atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg=="),l=atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu");return[r,o,l,()=>{H(je,r=!1,r)}]}class Rn extends oe{constructor(e){super(),re(this,e,Cn,xn,ne,{})}}function Mn(t){let e,n,r,o;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
			Browse App Data</div>`,f(n,"id","data_dir_button"),f(n,"class","p-2 hover:opacity-75"),f(e,"id","general_options"),f(e,"class","col-span-3 p-5 pt-10")},m(l,c){I(l,e,c),p(e,n),r||(o=j(n,"click",t[1]),r=!0)},p:N,i:N,o:N,d(l){l&&E(e),r=!1,o()}}}function Pn(t){function e(){var r=new XMLHttpRequest;r.open("GET","/browse-data"),r.onreadystatechange=()=>{r.readyState==4&&G(`Browse status: '${r.responseText.trim()}'`)},r.send()}return[e,()=>{e()}]}class Tn extends oe{constructor(e){super(),re(this,e,Pn,Mn,ne,{})}}function En(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k,S,y,g,w,x;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
			Configure RuneLite</div>`,r=P(),o=b("div"),l=b("label"),l.textContent="Expose rich presence to Flatpak Discord:",c=P(),i=b("input"),a=P(),u=b("div"),d=b("label"),d.textContent="Use custom RuneLite JAR:",h=P(),_=b("input"),v=P(),m=b("div"),R=b("textarea"),k=P(),S=b("br"),y=P(),g=b("button"),g.textContent="Select File",f(n,"id","rl_configure"),f(n,"class","p-2 pb-5 hover:opacity-75"),f(l,"for","flatpak_rich_presence"),f(i,"type","checkbox"),f(i,"name","flatpak_rich_presence"),f(i,"id","flatpak_rich_presence"),f(i,"class","ml-2"),f(o,"id","flatpak_div"),f(o,"class","mx-auto border-t-2 border-slate-300 p-2 py-5 dark:border-slate-800"),f(d,"for","use_custom_jar"),f(_,"type","checkbox"),f(_,"name","use_custom_jar"),f(_,"id","use_custom_jar"),f(_,"class","ml-2"),f(u,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),R.disabled=!0,f(R,"name","custom_jar_file"),f(R,"id","custom_jar_file"),f(R,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),g.disabled=!0,f(g,"id","custom_jar_file_button"),f(g,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 hover:opacity-75"),f(m,"id","custom_jar_div"),f(m,"class","mx-auto p-2 opacity-25"),f(e,"id","osrs_options"),f(e,"class","col-span-3 p-5 pt-10")},m(A,V){I(A,e,V),p(e,n),p(e,r),p(e,o),p(o,l),p(o,c),p(o,i),t[12](i),t[14](o),p(e,a),p(e,u),p(u,d),p(u,h),p(u,_),t[15](_),p(e,v),p(e,m),p(m,R),t[17](R),p(m,k),p(m,S),p(m,y),p(m,g),t[19](g),t[21](m),w||(x=[j(n,"click",t[11]),j(i,"change",t[13]),j(_,"change",t[16]),j(R,"change",t[18]),j(g,"click",t[20])],w=!0)},p:N,i:N,o:N,d(A){A&&E(e),t[12](null),t[14](null),t[15](null),t[17](null),t[19](null),t[21](null),w=!1,ce(x)}}}function In(t,e,n){let r,o,l,c;X(t,st,T=>n(22,r=T)),X(t,B,T=>n(23,o=T)),X(t,F,T=>n(24,l=T)),X(t,z,T=>n(25,c=T));let i,a,u,d,h,_;function v(){i.classList.toggle("opacity-25"),n(1,a.disabled=!a.disabled,a),n(2,u.disabled=!u.disabled,u),H(B,o.runelite_use_custom_jar=d.checked,o),o.runelite_use_custom_jar?a.value&&H(B,o.runelite_custom_jar=a.value,o):(n(1,a.value="",a),H(B,o.runelite_custom_jar="",o),H(B,o.runelite_use_custom_jar=!1,o)),H(z,c=!0,c)}function m(){H(B,o.flatpak_rich_presence=h.checked,o),H(z,c=!0,c)}function R(){H(B,o.runelite_custom_jar=a.value,o),H(z,c=!0,c)}function k(){n(3,d.disabled=!0,d),n(2,u.disabled=!0,u);var T=new XMLHttpRequest;T.onreadystatechange=()=>{T.readyState==4&&(T.status==200&&(n(1,a.value=T.responseText,a),H(B,o.runelite_custom_jar=T.responseText,o),H(z,c=!0,c)),n(2,u.disabled=!1,u),n(3,d.disabled=!1,d))},T.open("GET","/jar-file-picker",!0),T.send()}function S(){var T,ye,ct;if(!l.account||!l.character){G("Please log in to configure RuneLite");return}pn((T=l.credentials)==null?void 0:T.session_id,(ye=l.character)==null?void 0:ye.accountId,(ct=l.character)==null?void 0:ct.displayName)}Ie(()=>{n(4,h.checked=o.flatpak_rich_presence,h),n(3,d.checked=o.runelite_use_custom_jar,d),d.checked&&o.runelite_custom_jar?(i.classList.remove("opacity-25"),n(1,a.disabled=!1,a),n(2,u.disabled=!1,u),n(1,a.value=o.runelite_custom_jar,a)):(n(3,d.checked=!1,d),H(B,o.runelite_use_custom_jar=!1,o)),r!=="linux"&&_.remove()});const y=()=>S();function g(T){q[T?"unshift":"push"](()=>{h=T,n(4,h)})}const w=()=>{m()};function x(T){q[T?"unshift":"push"](()=>{_=T,n(5,_)})}function A(T){q[T?"unshift":"push"](()=>{d=T,n(3,d)})}const V=()=>{v()};function C(T){q[T?"unshift":"push"](()=>{a=T,n(1,a)})}const L=()=>{R()};function M(T){q[T?"unshift":"push"](()=>{u=T,n(2,u)})}const ee=()=>{k()};function U(T){q[T?"unshift":"push"](()=>{i=T,n(0,i)})}return[i,a,u,d,h,_,v,m,R,k,S,y,g,w,x,A,V,C,L,M,ee,U]}class Hn extends oe{constructor(e){super(),re(this,e,In,En,ne,{})}}function Nn(t){let e,n,r,o,l,c,i,a,u,d;return{c(){e=b("div"),n=b("div"),r=b("label"),r.textContent="Use custom config URI:",o=P(),l=b("input"),c=P(),i=b("div"),a=b("textarea"),f(r,"for","use_custom_uri"),f(l,"type","checkbox"),f(l,"name","use_custom_uri"),f(l,"id","use_custom_uri"),f(l,"class","ml-2"),f(n,"class","mx-auto p-2"),a.disabled=!0,f(a,"name","config_uri_address"),f(a,"id","config_uri_address"),f(a,"rows","4"),f(a,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),a.value="		",f(i,"id","config_uri_div"),f(i,"class","mx-auto p-2 opacity-25"),f(e,"id","rs3_options"),f(e,"class","col-span-3 p-5 pt-10")},m(h,_){I(h,e,_),p(e,n),p(n,r),p(n,o),p(n,l),t[5](l),p(e,c),p(e,i),p(i,a),t[8](a),t[9](i),u||(d=[j(l,"change",t[6]),j(a,"change",t[7])],u=!0)},p:N,i:N,o:N,d(h){h&&E(e),t[5](null),t[8](null),t[9](null),u=!1,ce(d)}}}function An(t,e,n){let r,o,l;X(t,nt,k=>n(10,r=k)),X(t,B,k=>n(11,o=k)),X(t,z,k=>n(12,l=k));let c,i,a;function u(){c.classList.toggle("opacity-25"),n(1,i.disabled=!i.disabled,i),H(z,l=!0,l),a.checked||(n(1,i.value=atob(r.default_config_uri),i),H(B,o.rs_config_uri="",o))}function d(){H(B,o.rs_config_uri=i.value,o),H(z,l=!0,l)}Ie(()=>{o.rs_config_uri?(n(1,i.value=o.rs_config_uri,i),n(2,a.checked=!0,a),u()):n(1,i.value=atob(r.default_config_uri),i)});function h(k){q[k?"unshift":"push"](()=>{a=k,n(2,a)})}const _=()=>{u()},v=()=>{d()};function m(k){q[k?"unshift":"push"](()=>{i=k,n(1,i)})}function R(k){q[k?"unshift":"push"](()=>{c=k,n(0,c)})}return[c,i,a,u,d,h,_,v,m,R]}class On extends oe{constructor(e){super(),re(this,e,An,Nn,ne,{})}}function jn(t){let e,n;return e=new On({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(O(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Dn(t){let e,n;return e=new Hn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(O(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Un(t){let e,n;return e=new Tn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(O(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function Bn(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k,S,y,g,w,x,A,V,C;n=new ot({}),n.$on("click",t[7]);const L=[Un,Dn,jn],M=[];function ee(U,T){return U[1]==U[5].general?0:U[1]==U[5].osrs?1:U[1]==U[5].rs3?2:-1}return~(w=ee(t))&&(x=M[w]=L[w](t)),{c(){e=b("div"),te(n.$$.fragment),r=P(),o=b("div"),l=b("button"),l.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=P(),i=b("div"),a=b("div"),u=b("button"),d=W("General"),h=b("br"),_=P(),v=b("button"),m=W("OSRS"),R=b("br"),k=P(),S=b("button"),y=W("RS3"),g=P(),x&&x.c(),f(l,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),f(u,"id","general_button"),f(u,"class",fe),f(v,"id","osrs_button"),f(v,"class",Ae),f(S,"id","rs3_button"),f(S,"class",fe),f(a,"class","relative h-full border-r-2 border-slate-300 pt-10 dark:border-slate-800"),f(i,"class","grid h-full grid-cols-4"),f(o,"class","absolute left-[13%] top-[13%] z-20 h-3/4 w-3/4 rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900"),f(e,"id","settings")},m(U,T){I(U,e,T),K(n,e,null),p(e,r),p(e,o),p(o,l),p(o,c),p(o,i),p(i,a),p(a,u),p(u,d),t[9](u),p(a,h),p(a,_),p(a,v),p(v,m),t[11](v),p(a,R),p(a,k),p(a,S),p(S,y),t[13](S),p(i,g),~w&&M[w].m(i,null),A=!0,V||(C=[j(l,"click",t[8]),j(u,"click",t[10]),j(v,"click",t[12]),j(S,"click",t[14])],V=!0)},p(U,[T]){let ye=w;w=ee(U),w!==ye&&(x&&(me(),D(M[ye],1,1,()=>{M[ye]=null}),ke()),~w?(x=M[w],x||(x=M[w]=L[w](U),x.c()),O(x,1),x.m(i,null)):x=null)},i(U){A||(O(n.$$.fragment,U),O(x),A=!0)},o(U){D(n.$$.fragment,U),D(x),A=!1},d(U){U&&E(e),Q(n),t[9](null),t[11](null),t[13](null),~w&&M[w].d(),V=!1,ce(C)}}}let Ae="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 mx-auto my-1 w-3/4",fe="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 mx-auto my-1 w-3/4";function qn(t,e,n){let{showSettings:r}=e;var o=(g=>(g[g.general=0]="general",g[g.osrs=1]="osrs",g[g.rs3=2]="rs3",g))(o||{});let l=1,c,i,a;function u(g){switch(g){case 0:n(1,l=0),n(2,c.classList.value=Ae,c),n(3,i.classList.value=fe,i),n(4,a.classList.value=fe,a);break;case 1:n(1,l=1),n(2,c.classList.value=fe,c),n(3,i.classList.value=Ae,i),n(4,a.classList.value=fe,a);break;case 2:n(1,l=2),n(2,c.classList.value=fe,c),n(3,i.classList.value=fe,i),n(4,a.classList.value=Ae,a);break}}function d(g){g.key==="Escape"&&n(0,r=!1)}addEventListener("keydown",d),et(()=>{removeEventListener("keydown",d)});const h=()=>{n(0,r=!1)},_=()=>{n(0,r=!1)};function v(g){q[g?"unshift":"push"](()=>{c=g,n(2,c)})}const m=()=>{u(o.general)};function R(g){q[g?"unshift":"push"](()=>{i=g,n(3,i)})}const k=()=>{u(o.osrs)};function S(g){q[g?"unshift":"push"](()=>{a=g,n(4,a)})}const y=()=>{u(o.rs3)};return t.$$set=g=>{"showSettings"in g&&n(0,r=g.showSettings)},[r,l,c,i,a,o,u,h,_,v,m,R,k,S,y]}class Jn extends oe{constructor(e){super(),re(this,e,qn,Bn,ne,{showSettings:0})}}function ht(t,e,n){const r=t.slice();return r[1]=e[n],r}function Gn(t){var a;let e,n=((a=t[1].time)==null?void 0:a.toLocaleTimeString())+"",r,o,l=t[1].text+"",c,i;return{c(){e=b("li"),r=W(n),o=W(`
					- `),c=W(l),i=P()},m(u,d){I(u,e,d),p(e,r),p(e,o),p(e,c),p(e,i)},p(u,d){var h;d&1&&n!==(n=((h=u[1].time)==null?void 0:h.toLocaleTimeString())+"")&&he(r,n),d&1&&l!==(l=u[1].text+"")&&he(c,l)},d(u){u&&E(e)}}}function Xn(t){var a;let e,n=((a=t[1].time)==null?void 0:a.toLocaleTimeString())+"",r,o,l=t[1].text+"",c,i;return{c(){e=b("li"),r=W(n),o=W(`
					- `),c=W(l),i=P(),f(e,"class","text-rose-500")},m(u,d){I(u,e,d),p(e,r),p(e,o),p(e,c),p(e,i)},p(u,d){var h;d&1&&n!==(n=((h=u[1].time)==null?void 0:h.toLocaleTimeString())+"")&&he(r,n),d&1&&l!==(l=u[1].text+"")&&he(c,l)},d(u){u&&E(e)}}}function _t(t){let e;function n(l,c){return l[1].isError?Xn:Gn}let r=n(t),o=r(t);return{c(){o.c(),e=Be()},m(l,c){o.m(l,c),I(l,e,c)},p(l,c){r===(r=n(l))&&o?o.p(l,c):(o.d(1),o=r(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&E(e),o.d(l)}}}function zn(t){let e,n,r,o,l=_e(t[0]),c=[];for(let i=0;i<l.length;i+=1)c[i]=_t(ht(t,l,i));return{c(){e=b("div"),n=b("div"),n.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',r=P(),o=b("ol");for(let i=0;i<c.length;i+=1)c[i].c();f(n,"class","absolute right-2 top-2"),f(o,"id","message_list"),f(o,"class","h-full w-[105%] list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),f(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(i,a){I(i,e,a),p(e,n),p(e,r),p(e,o);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(o,null)},p(i,[a]){if(a&1){l=_e(i[0]);let u;for(u=0;u<l.length;u+=1){const d=ht(i,l,u);c[u]?c[u].p(d,a):(c[u]=_t(d),c[u].c(),c[u].m(o,null))}for(;u<c.length;u+=1)c[u].d(1);c.length=l.length}},i:N,o:N,d(i){i&&E(e),Ue(c,i)}}}function $n(t,e,n){let r;return X(t,we,o=>n(0,r=o)),[r]}class Fn extends oe{constructor(e){super(),re(this,e,$n,zn,ne,{})}}function gt(t,e,n){const r=t.slice();return r[13]=e[n],r}function Vn(t){let e,n,r;return{c(){e=b("button"),e.textContent="Plugin menu",e.disabled=!de(qe),f(e,"class","mx-auto mb-2 w-52 rounded-lg p-2 font-bold text-black duration-200 enabled:bg-blue-500 enabled:hover:opacity-75 disabled:bg-gray-500")},m(o,l){I(o,e,l),n||(r=j(e,"click",t[8]),n=!0)},p:N,d(o){o&&E(e),n=!1,r()}}}function Wn(t){let e,n,r,o,l,c,i,a,u;return{c(){e=b("label"),e.textContent="Game Client",n=P(),r=b("br"),o=P(),l=b("select"),c=b("option"),c.textContent="RuneLite",i=b("option"),i.textContent="HDOS",f(e,"for","game_client_select"),f(e,"class","text-sm"),f(c,"data-id",ae.runeLite),f(c,"class","dark:bg-slate-900"),c.__value="RuneLite",Ce(c,c.__value),f(i,"data-id",ae.hdos),f(i,"class","dark:bg-slate-900"),i.__value="HDOS",Ce(i,i.__value),f(l,"id","game_client_select"),f(l,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800")},m(d,h){I(d,e,h),I(d,n,h),I(d,r,h),I(d,o,h),I(d,l,h),p(l,c),p(l,i),t[7](l),a||(u=j(l,"change",t[5]),a=!0)},p:N,d(d){d&&(E(e),E(n),E(r),E(o),E(l)),t[7](null),a=!1,u()}}}function bt(t){let e,n=_e(t[4].account.characters),r=[];for(let o=0;o<n.length;o+=1)r[o]=mt(gt(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Be()},m(o,l){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(o,l);I(o,e,l)},p(o,l){if(l&16){n=_e(o[4].account.characters);let c;for(c=0;c<n.length;c+=1){const i=gt(o,n,c);r[c]?r[c].p(i,l):(r[c]=mt(i),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(o){o&&E(e),Ue(r,o)}}}function Zn(t){let e;return{c(){e=W("New Character")},m(n,r){I(n,e,r)},p:N,d(n){n&&E(e)}}}function Yn(t){let e=t[13][1].displayName+"",n;return{c(){n=W(e)},m(r,o){I(r,n,o)},p(r,o){o&16&&e!==(e=r[13][1].displayName+"")&&he(n,e)},d(r){r&&E(n)}}}function mt(t){let e,n,r,o;function l(a,u){return a[13][1].displayName?Yn:Zn}let c=l(t),i=c(t);return{c(){e=b("option"),i.c(),n=P(),f(e,"data-id",r=t[13][1].accountId),f(e,"class","dark:bg-slate-900"),e.__value=o=`
						`+t[13][1].displayName+`
					`,Ce(e,e.__value)},m(a,u){I(a,e,u),i.m(e,null),p(e,n)},p(a,u){c===(c=l(a))&&i?i.p(a,u):(i.d(1),i=c(a),i&&(i.c(),i.m(e,n))),u&16&&r!==(r=a[13][1].accountId)&&f(e,"data-id",r),u&16&&o!==(o=`
						`+a[13][1].displayName+`
					`)&&(e.__value=o,Ce(e,e.__value))},d(a){a&&E(e),i.d()}}}function Kn(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k;function S(x,A){if(x[4].game==Y.osrs)return Wn;if(x[4].game==Y.rs3)return Vn}let y=S(t),g=y&&y(t),w=t[4].account&&bt(t);return{c(){e=b("div"),n=b("img"),o=P(),l=b("button"),l.textContent="Play",c=P(),i=b("div"),g&&g.c(),a=P(),u=b("div"),d=b("label"),d.textContent="Character",h=P(),_=b("br"),v=P(),m=b("select"),w&&w.c(),Bt(n.src,r="svgs/rocket-solid.svg")||f(n,"src",r),f(n,"alt","Launch icon"),f(n,"class","mx-auto mb-5 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),f(l,"class","mx-auto mb-2 w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(i,"class","mx-auto my-2"),f(d,"for","character_select"),f(d,"class","text-sm"),f(m,"id","character_select"),f(m,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),f(u,"class","mx-auto my-2"),f(e,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(x,A){I(x,e,A),p(e,n),p(e,o),p(e,l),p(e,c),p(e,i),g&&g.m(i,null),p(e,a),p(e,u),p(u,d),p(u,h),p(u,_),p(u,v),p(u,m),w&&w.m(m,null),t[9](m),R||(k=[j(l,"click",t[6]),j(m,"change",t[10])],R=!0)},p(x,[A]){y===(y=S(x))&&g?g.p(x,A):(g&&g.d(1),g=y&&y(x),g&&(g.c(),g.m(i,null))),x[4].account?w?w.p(x,A):(w=bt(x),w.c(),w.m(m,null)):w&&(w.d(1),w=null)},i:N,o:N,d(x){x&&E(e),g&&g.d(),w&&w.d(),t[9](null),R=!1,ce(k)}}}function Qn(t,e,n){let r,o,l;X(t,F,k=>n(4,r=k)),X(t,B,k=>n(11,o=k)),X(t,z,k=>n(12,l=k));let{showPluginMenu:c=!1}=e,i,a;function u(){var S,y;if(!r.account)return;const k=i[i.selectedIndex].getAttribute("data-id");H(F,r.character=r.account.characters.get(k),r),r.character&&((y=o.selected_characters)==null||y.set(r.account.userId,(S=r.character)==null?void 0:S.accountId)),H(z,l=!0,l)}function d(){a.value=="RuneLite"?(H(F,r.client=ae.runeLite,r),H(B,o.selected_client_index=ae.runeLite,o)):a.value=="HDOS"&&(H(F,r.client=ae.hdos,r),H(B,o.selected_client_index=ae.hdos,o)),H(z,l=!0,l)}function h(){var k,S,y,g,w,x,A,V,C;if(!r.account||!r.character){G("Please log in to launch a client");return}switch(r.game){case Y.osrs:r.client==ae.runeLite?fn((k=r.credentials)==null?void 0:k.session_id,(S=r.character)==null?void 0:S.accountId,(y=r.character)==null?void 0:y.displayName):r.client==ae.hdos&&hn((g=r.credentials)==null?void 0:g.session_id,(w=r.character)==null?void 0:w.accountId,(x=r.character)==null?void 0:x.displayName);break;case Y.rs3:dn((A=r.credentials)==null?void 0:A.session_id,(V=r.character)==null?void 0:V.accountId,(C=r.character)==null?void 0:C.displayName);break}}Xt(()=>{var k;if(r.game==Y.osrs&&r.client&&n(3,a.selectedIndex=r.client,a),r.account&&((k=o.selected_characters)!=null&&k.has(r.account.userId)))for(let S=0;S<i.options.length;S++)i[S].getAttribute("data-id")==o.selected_characters.get(r.account.userId)&&n(2,i.selectedIndex=S,i)}),Ie(()=>{o.selected_game_index==Y.osrs&&(n(3,a.selectedIndex=o.selected_client_index,a),H(F,r.client=a.selectedIndex,r))});function _(k){q[k?"unshift":"push"](()=>{a=k,n(3,a)})}const v=()=>{n(0,c=de(qe)??!1)};function m(k){q[k?"unshift":"push"](()=>{i=k,n(2,i)})}const R=()=>u();return t.$$set=k=>{"showPluginMenu"in k&&n(0,c=k.showPluginMenu)},[c,u,i,a,r,d,h,_,v,m,R]}class es extends oe{constructor(e){super(),re(this,e,Qn,Kn,ne,{showPluginMenu:0,characterChanged:1})}get characterChanged(){return this.$$.ctx[1]}}function ts(t){let e;return{c(){e=b("div"),e.innerHTML='<img src="svgs/circle-notch-solid.svg" alt="" class="mx-auto h-1/6 w-1/6 animate-spin"/>',f(e,"class","container mx-auto bg-slate-100 p-5 text-center text-slate-900 dark:bg-slate-900 dark:text-slate-50")},m(n,r){I(n,e,r)},p:N,i:N,o:N,d(n){n&&E(e)}}}class ns extends oe{constructor(e){super(),re(this,e,null,ts,ne,{})}}function kt(t,e,n){const r=t.slice();return r[6]=e[n],r}function ss(t){let e;return{c(){e=b("p"),e.textContent="error"},m(n,r){I(n,e,r)},p:N,d(n){n&&E(e)}}}function rs(t){let e;function n(l,c){return l[5].length==0?ls:os}let r=n(t),o=r(t);return{c(){o.c(),e=Be()},m(l,c){o.m(l,c),I(l,e,c)},p(l,c){r===(r=n(l))&&o?o.p(l,c):(o.d(1),o=r(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&E(e),o.d(l)}}}function os(t){let e,n=_e(t[5]),r=[];for(let o=0;o<n.length;o+=1)r[o]=wt(kt(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Be()},m(o,l){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(o,l);I(o,e,l)},p(o,l){if(l&2){n=_e(o[5]);let c;for(c=0;c<n.length;c+=1){const i=kt(o,n,c);r[c]?r[c].p(i,l):(r[c]=wt(i),r[c].c(),r[c].m(e.parentNode,e))}for(;c<r.length;c+=1)r[c].d(1);r.length=n.length}},d(o){o&&E(e),Ue(r,o)}}}function ls(t){let e;return{c(){e=b("p"),e.textContent=`(start an RS3 game client with plugin library enabled and it will be listed
						here.)`},m(n,r){I(n,e,r)},p:N,d(n){n&&E(e)}}}function wt(t){let e,n=(t[6].identity||"(unnamed)")+"",r,o,l;return{c(){e=b("button"),r=W(n),o=P(),l=b("br"),f(e,"class","m-1 h-[28px] w-[95%] rounded-lg border-2 border-blue-500 duration-200 hover:opacity-75")},m(c,i){I(c,e,i),p(e,r),I(c,o,i),I(c,l,i)},p(c,i){i&2&&n!==(n=(c[6].identity||"(unnamed)")+"")&&he(r,n)},d(c){c&&(E(e),E(o),E(l))}}}function cs(t){let e;return{c(){e=b("p"),e.textContent="loading..."},m(n,r){I(n,e,r)},p:N,d(n){n&&E(e)}}}function is(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k,S;n=new ot({}),n.$on("click",t[2]);let y={ctx:t,current:null,token:null,hasCatch:!0,pending:cs,then:rs,catch:ss,value:5};return at(_=t[1],y),{c(){e=b("div"),te(n.$$.fragment),r=P(),o=b("div"),l=b("button"),l.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',c=P(),i=b("div"),a=b("button"),a.textContent="Manage Plugins",u=P(),d=b("hr"),h=P(),y.block.c(),v=P(),m=b("div"),m.innerHTML="<p>menu</p>",f(l,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),f(a,"class","mx-auto mb-2 w-[95%] rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(d,"class","p-1 dark:border-slate-700"),f(i,"class","left-0 float-left h-full w-[min(180px,_50%)] overflow-hidden border-r-2 border-slate-300 pt-2 dark:border-slate-800"),f(m,"class","h-full pt-10"),f(o,"class","absolute left-[5%] top-[5%] z-20 h-[90%] w-[90%] rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900")},m(g,w){I(g,e,w),K(n,e,null),p(e,r),p(e,o),p(o,l),p(o,c),p(o,i),p(i,a),p(i,u),p(i,d),p(i,h),y.block.m(i,y.anchor=null),y.mount=()=>i,y.anchor=null,p(o,v),p(o,m),R=!0,k||(S=[j(l,"click",t[3]),j(a,"click",as)],k=!0)},p(g,[w]){t=g,y.ctx=t,w&2&&_!==(_=t[1])&&at(_,y)||Zt(y,t,w)},i(g){R||(O(n.$$.fragment,g),R=!0)},o(g){D(n.$$.fragment,g),R=!1},d(g){g&&E(e),Q(n),y.block.d(),y.token=null,y=null,k=!1,ce(S)}}}const as=()=>{};function us(t,e,n){let r;X(t,Ze,a=>n(1,r=a));let{showPluginMenu:o}=e;Ze.set(Ot());function l(a){a.key==="Escape"&&n(0,o=!1)}addEventListener("keydown",l),et(()=>{removeEventListener("keydown",l)});const c=()=>{n(0,o=!1)},i=()=>{n(0,o=!1)};return t.$$set=a=>{"showPluginMenu"in a&&n(0,o=a.showPluginMenu)},[o,r,c,i]}class ds extends oe{constructor(e){super(),re(this,e,us,is,ne,{showPluginMenu:0})}}function fs(t){let e,n,r,o,l,c,i,a,u,d,h,_,v,m,R,k,S=t[1]&&yt(t),y=t[0]&&vt(t),g=t[3]&&St();function w(C){t[6](C)}let x={};t[0]!==void 0&&(x.showSettings=t[0]),o=new vn({props:x}),q.push(()=>Te(o,"showSettings",w));function A(C){t[7](C)}let V={};return t[1]!==void 0&&(V.showPluginMenu=t[1]),d=new es({props:V}),q.push(()=>Te(d,"showPluginMenu",A)),R=new Fn({}),{c(){S&&S.c(),e=P(),y&&y.c(),n=P(),g&&g.c(),r=P(),te(o.$$.fragment),c=P(),i=b("div"),a=b("div"),u=P(),te(d.$$.fragment),_=P(),v=b("div"),m=P(),te(R.$$.fragment),f(i,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(C,L){S&&S.m(C,L),I(C,e,L),y&&y.m(C,L),I(C,n,L),g&&g.m(C,L),I(C,r,L),K(o,C,L),I(C,c,L),I(C,i,L),p(i,a),p(i,u),K(d,i,null),p(i,_),p(i,v),I(C,m,L),K(R,C,L),k=!0},p(C,L){C[1]?S?(S.p(C,L),L&2&&O(S,1)):(S=yt(C),S.c(),O(S,1),S.m(e.parentNode,e)):S&&(me(),D(S,1,1,()=>{S=null}),ke()),C[0]?y?(y.p(C,L),L&1&&O(y,1)):(y=vt(C),y.c(),O(y,1),y.m(n.parentNode,n)):y&&(me(),D(y,1,1,()=>{y=null}),ke()),C[3]?g?L&8&&O(g,1):(g=St(),g.c(),O(g,1),g.m(r.parentNode,r)):g&&(me(),D(g,1,1,()=>{g=null}),ke());const M={};!l&&L&1&&(l=!0,M.showSettings=C[0],Pe(()=>l=!1)),o.$set(M);const ee={};!h&&L&2&&(h=!0,ee.showPluginMenu=C[1],Pe(()=>h=!1)),d.$set(ee)},i(C){k||(O(S),O(y),O(g),O(o.$$.fragment,C),O(d.$$.fragment,C),O(R.$$.fragment,C),k=!0)},o(C){D(S),D(y),D(g),D(o.$$.fragment,C),D(d.$$.fragment,C),D(R.$$.fragment,C),k=!1},d(C){C&&(E(e),E(n),E(r),E(c),E(i),E(m)),S&&S.d(C),y&&y.d(C),g&&g.d(C),Q(o,C),Q(d),Q(R,C)}}}function ps(t){let e,n;return e=new ns({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},p:N,i(r){n||(O(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function yt(t){let e,n,r;function o(c){t[4](c)}let l={};return t[1]!==void 0&&(l.showPluginMenu=t[1]),e=new ds({props:l}),q.push(()=>Te(e,"showPluginMenu",o)),{c(){te(e.$$.fragment)},m(c,i){K(e,c,i),r=!0},p(c,i){const a={};!n&&i&2&&(n=!0,a.showPluginMenu=c[1],Pe(()=>n=!1)),e.$set(a)},i(c){r||(O(e.$$.fragment,c),r=!0)},o(c){D(e.$$.fragment,c),r=!1},d(c){Q(e,c)}}}function vt(t){let e,n,r;function o(c){t[5](c)}let l={};return t[0]!==void 0&&(l.showSettings=t[0]),e=new Jn({props:l}),q.push(()=>Te(e,"showSettings",o)),{c(){te(e.$$.fragment)},m(c,i){K(e,c,i),r=!0},p(c,i){const a={};!n&&i&1&&(n=!0,a.showSettings=c[0],Pe(()=>n=!1)),e.$set(a)},i(c){r||(O(e.$$.fragment,c),r=!0)},o(c){D(e.$$.fragment,c),r=!1},d(c){Q(e,c)}}}function St(t){let e,n;return e=new Rn({}),{c(){te(e.$$.fragment)},m(r,o){K(e,r,o),n=!0},i(r){n||(O(e.$$.fragment,r),n=!0)},o(r){D(e.$$.fragment,r),n=!1},d(r){Q(e,r)}}}function hs(t){let e,n,r,o;const l=[ps,fs],c=[];function i(a,u){return a[2]?0:1}return n=i(t),r=c[n]=l[n](t),{c(){e=b("main"),r.c(),f(e,"class","h-full")},m(a,u){I(a,e,u),c[n].m(e,null),o=!0},p(a,[u]){let d=n;n=i(a),n===d?c[n].p(a,u):(me(),D(c[d],1,1,()=>{c[d]=null}),ke(),r=c[n],r?r.p(a,u):(r=c[n]=l[n](a),r.c()),O(r,1),r.m(e,null))},i(a){o||(O(r),o=!0)},o(a){D(r),o=!1},d(a){a&&E(e),c[n].d()}}}function _s(t,e,n){let r;X(t,je,_=>n(3,r=_));let o=!1,l=!1,c=!1;sn();const i=window.opener||window.parent;if(i){const _=new URLSearchParams(window.location.search);_.get("id_token")?(c=!0,i.postMessage({type:"gameSessionServerAuth",code:_.get("code"),id_token:_.get("id_token"),state:_.get("state")},"*")):_.get("code")&&(c=!0,i.postMessage({type:"authCode",code:_.get("code"),state:_.get("state")},"*"))}function a(_){l=_,n(1,l)}function u(_){o=_,n(0,o)}function d(_){o=_,n(0,o)}function h(_){l=_,n(1,l)}return[o,l,c,r,a,u,d,h]}class gs extends oe{constructor(e){super(),re(this,e,_s,hs,ne,{})}}new gs({target:document.getElementById("app")});const le=[],bs=de(Pt);let $;le.push(nt.subscribe(t=>$=t));let se;le.push(B.subscribe(t=>se=t));le.push(st.subscribe(t=>t));let pe;le.push(be.subscribe(t=>pe=t));le.push(qe.subscribe(t=>t??!1));let ie;le.push(Je.subscribe(t=>ie=t));let lt;le.push(rt.subscribe(t=>lt=t));le.push(we.subscribe(t=>t));le.push(Oe.subscribe(t=>t));let De;le.push(F.subscribe(t=>De=t));function ms(){var o;const t=atob($.origin),e=atob($.clientid),n=t.concat("/oauth2/token");pe.size==0&&je.set(!0),tn(),se.selected_game_accounts&&((o=se.selected_game_accounts)==null?void 0:o.size)>0&&B.update(l=>{var c;return l.selected_characters=l.selected_game_accounts,(c=l.selected_game_accounts)==null||c.clear(),l});const r=[bs,t,atob($.origin_2fa)];window.addEventListener("message",l=>{if(!r.includes(l.origin)){G(`discarding window message from origin ${l.origin}`);return}let c=ie;const i=new XMLHttpRequest;switch(l.data.type){case"authCode":if(c){Je.set({});const a=new URLSearchParams({grant_type:"authorization_code",client_id:atob($.clientid),code:l.data.code,code_verifier:c.verifier,redirect_uri:atob($.redirect)});i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const u=It(i.response),d=Mt(u);d?ut(c==null?void 0:c.win,d).then(h=>{h&&(be.update(_=>(_.set(d.sub,d),_)),Re())}):(J("Error: invalid credentials received",!1),c.win.close())}else J(`Error: from ${n}: ${i.status}: ${i.response}`,!1),c.win.close()},i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","application/json"),i.send(a)}break;case"externalUrl":i.onreadystatechange=()=>{i.readyState==4&&G(`External URL status: '${i.responseText.trim()}'`)},i.open("POST","/open-external-url",!0),i.send(l.data.url);break;case"gameSessionServerAuth":if(c=lt.find(a=>l.data.state==a.state),c){nn(c,!0);const a=l.data.id_token.split(".");if(a.length!==3){J(`Malformed id_token: ${a.length} sections, expected 3`,!1);break}const u=JSON.parse(atob(a[0]));if(u.typ!=="JWT"){J(`Bad id_token header: typ ${u.typ}, expected JWT`,!1);break}const d=JSON.parse(atob(a[1]));if(atob(d.nonce)!==c.nonce){J("Incorrect nonce in id_token",!1);break}const h=atob($.auth_api).concat("/sessions");i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const _=atob($.auth_api).concat("/accounts");c.creds.session_id=JSON.parse(i.response).sessionId,Nt(c.creds,_,c.account_info_promise).then(v=>{v&&(be.update(m=>{var R;return m.set((R=c==null?void 0:c.creds)==null?void 0:R.sub,c.creds),m}),Re())})}else J(`Error: from ${h}: ${i.status}: ${i.response}`,!1)},i.open("POST",h,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json"),i.send(`{"idToken": "${l.data.id_token}"}`)}break;case"gameClientListUpdate":Ze.set(Ot());break;default:G("Unknown message type: ".concat(l.data.type));break}}),(async()=>(pe.size>0&&pe.forEach(async l=>{const c=await Et(l,n,e);c!==null&&c!==0&&(J(`Discarding expired login for #${l.sub}`,!1),be.update(a=>(a.delete(l.sub),a)),Re());let i;if(c===null&&await ut(null,l)?i={creds:l,valid:!0}:i={creds:l,valid:c===0},i.valid){const a=l;be.update(u=>(u.set(a.sub,a),u)),Re()}}),z.set(!1)))()}function G(t){console.log(t);const e={isError:!1,text:t,time:new Date(Date.now())};we.update(n=>(n.unshift(e),n))}function J(t,e){const n={isError:!0,text:t,time:new Date(Date.now())};if(we.update(r=>(r.unshift(n),r)),!e)console.error(t);else throw new Error(t)}nt.set(s());onload=()=>ms();onunload=()=>{for(const t in le)delete le[t];Ge()};
