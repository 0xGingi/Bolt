var It=Object.defineProperty;var Et=(t,e,n)=>e in t?It(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ue=(t,e,n)=>(Et(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function A(){}function ht(t){return t()}function nt(){return Object.create(null)}function ie(t){t.forEach(ht)}function _t(t){return typeof t=="function"}function ne(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ee;function Ht(t,e){return t===e?!0:(Ee||(Ee=document.createElement("a")),Ee.href=e,t===Ee.href)}function At(t){return Object.keys(t).length===0}function gt(t,...e){if(t==null){for(const r of e)r(void 0);return A}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ve(t){let e;return gt(t,n=>e=n)(),e}function z(t,e,n){t.$$.on_destroy.push(gt(e,n))}function I(t,e,n){return t.set(n),e}function p(t,e){t.appendChild(e)}function N(t,e,n){t.insertBefore(e,n||null)}function H(t){t.parentNode&&t.parentNode.removeChild(t)}function Ve(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function Y(t){return document.createTextNode(t)}function C(){return Y(" ")}function mt(){return Y("")}function M(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Nt(t){return Array.from(t.childNodes)}function he(t,e){e=""+e,t.data!==e&&(t.data=e)}function _e(t,e){t.value=e??""}function Mt(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Re;function xe(t){Re=t}function De(){if(!Re)throw new Error("Function called outside component initialization");return Re}function Ie(t){De().$$.on_mount.push(t)}function Ot(t){De().$$.after_update.push(t)}function bt(t){De().$$.on_destroy.push(t)}function Dt(){const t=De();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const l=Mt(e,n,{cancelable:r});return o.slice().forEach(i=>{i.call(t,l)}),!l.defaultPrevented}return!0}}const we=[],q=[];let ye=[];const Je=[],jt=Promise.resolve();let Ge=!1;function Pt(){Ge||(Ge=!0,jt.then(kt))}function Xe(t){ye.push(t)}function We(t){Je.push(t)}const Be=new Set;let be=0;function kt(){if(be!==0)return;const t=Re;do{try{for(;be<we.length;){const e=we[be];be++,xe(e),Ut(e.$$)}}catch(e){throw we.length=0,be=0,e}for(xe(null),we.length=0,be=0;q.length;)q.pop()();for(let e=0;e<ye.length;e+=1){const n=ye[e];Be.has(n)||(Be.add(n),n())}ye.length=0}while(we.length);for(;Je.length;)Je.pop()();Ge=!1,Be.clear(),xe(t)}function Ut(t){if(t.fragment!==null){t.update(),ie(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Xe)}}function Bt(t){const e=[],n=[];ye.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),ye=e}const He=new Set;let fe;function Ce(){fe={r:0,c:[],p:fe}}function Te(){fe.r||ie(fe.c),fe=fe.p}function j(t,e){t&&t.i&&(He.delete(t),t.i(e))}function G(t,e,n,r){if(t&&t.o){if(He.has(t))return;He.add(t),fe.c.push(()=>{He.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Se(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ze(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function se(t){t&&t.c()}function Q(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),Xe(()=>{const l=t.$$.on_mount.map(ht).filter(_t);t.$$.on_destroy?t.$$.on_destroy.push(...l):ie(l),t.$$.on_mount=[]}),o.forEach(Xe)}function ee(t,e){const n=t.$$;n.fragment!==null&&(Bt(n.after_update),ie(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function qt(t,e){t.$$.dirty[0]===-1&&(we.push(t),Pt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function re(t,e,n,r,o,l,i=null,c=[-1]){const u=Re;xe(t);const a=t.$$={fragment:null,ctx:[],props:l,update:A,not_equal:o,bound:nt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:nt(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};i&&i(a.root);let d=!1;if(a.ctx=n?n(t,e.props||{},(_,g,...y)=>{const m=y.length?y[0]:g;return a.ctx&&o(a.ctx[_],a.ctx[_]=m)&&(!a.skip_bound&&a.bound[_]&&a.bound[_](m),d&&qt(t,_)),g}):[],a.update(),d=!0,ie(a.before_update),a.fragment=r?r(a.ctx):!1,e.target){if(e.hydrate){const _=Nt(e.target);a.fragment&&a.fragment.l(_),_.forEach(H)}else a.fragment&&a.fragment.c();e.intro&&j(t.$$.fragment),Q(t,e.target,e.anchor),kt()}xe(u)}class oe{constructor(){Ue(this,"$$");Ue(this,"$$set")}$destroy(){ee(this,1),this.$destroy=A}$on(e,n){if(!_t(n))return A;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!At(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Jt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Jt);const ke=[];function wt(t,e){return{subscribe:K(t,e).subscribe}}function K(t,e=A){let n;const r=new Set;function o(c){if(ne(t,c)&&(t=c,n)){const u=!ke.length;for(const a of r)a[1](),ke.push(a,t);if(u){for(let a=0;a<ke.length;a+=2)ke[a][0](ke[a+1]);ke.length=0}}}function l(c){o(c(t))}function i(c,u=A){const a=[c,u];return r.add(a),r.size===1&&(n=e(o,l)||A),c(t),()=>{r.delete(a),r.size===0&&n&&(n(),n=null)}}return{set:o,update:l,subscribe:i}}function yt(t){if(t.ok)return t.value;throw t.error}var Z=(t=>(t[t.rs3=0]="rs3",t[t.osrs=1]="osrs",t))(Z||{}),ce=(t=>(t[t.runeLite=0]="runeLite",t[t.hdos=1]="hdos",t[t.rs3=2]="rs3",t))(ce||{});const Gt={use_dark_theme:!0,flatpak_rich_presence:!1,rs_config_uri:"",runelite_custom_jar:"",runelite_use_custom_jar:!1,selected_account:"",selected_characters:new Map,selected_game_accounts:new Map,selected_game_index:1,selected_client_index:1},Xt=wt("https://bolt-internal"),zt=wt("1fddee4e-b100-4f4e-b2b0-097f9088f9d2"),Ye=K(),Ke=K(""),P=K({...Gt}),pe=K(new Map),ge=K([]),je=K({}),Qe=K([]),ze=K(""),$e=K(""),Fe=K(""),$=K(!1),Ne=K(new Map),V=K({game:Z.osrs,client:ce.runeLite}),Me=K(!1);function $t(){te.use_dark_theme==!1&&document.documentElement.classList.remove("dark")}function Ft(t,e){e&&t.win.close(),Qe.update(n=>(n.splice(et.indexOf(t),1),n))}function St(){if(ae&&ae.win&&!ae.win.closed)ae.win.focus();else if(ae&&ae.win&&ae.win.closed||ae){const t=xt(),e=Zt();Wt({origin:atob(F.origin),redirect:atob(F.redirect),authMethod:"",loginType:"",clientid:atob(F.clientid),flow:"launcher",pkceState:t,pkceCodeVerifier:e}).then(n=>{const r=window.open(n,"","width=480,height=720");je.set({state:t,verifier:e,win:r})})}}function Vt(){const t=new URLSearchParams(window.location.search);Ke.set(t.get("platform")),t.get("flathub")!="0",ze.set(t.get("rs3_linux_installed_hash")),$e.set(t.get("runelite_installed_id")),Fe.set(t.get("hdos_installed_version"));const e=t.get("credentials");if(e)try{JSON.parse(e).forEach(o=>{pe.update(l=>(l.set(o.sub,o),l))})}catch(r){B(`Couldn't parse credentials file: ${r}`,!1)}const n=t.get("config");if(n)try{const r=JSON.parse(n);P.set(r),P.update(o=>(o.selected_game_accounts?(o.selected_characters=new Map(Object.entries(o.selected_game_accounts)),delete o.selected_game_accounts):o.selected_characters&&(o.selected_characters=new Map(Object.entries(o.selected_characters))),o))}catch(r){B(`Couldn't parse config file: ${r}`,!1)}}async function vt(t,e,n){return new Promise(r=>{if(t.expiry-Date.now()<3e4){const o=new URLSearchParams({grant_type:"refresh_token",client_id:n,refresh_token:t.refresh_token}),l=new XMLHttpRequest;l.onreadystatechange=()=>{if(l.readyState==4)if(l.status==200){const i=Lt(l.response),c=yt(i);c?(t.access_token=c.access_token,t.expiry=c.expiry,t.id_token=c.id_token,t.login_provider=c.login_provider,t.refresh_token=c.refresh_token,c.session_id&&(t.session_id=c.session_id),t.sub=c.sub,r(null)):r(0)}else r(l.status)},l.onerror=()=>{r(0)},l.open("POST",e,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader("Accept","application/json"),l.send(o)}else r(null)})}function Lt(t){const e=JSON.parse(t),n=e.id_token.split(".");if(n.length!==3){const l=`Malformed id_token: ${n.length} sections, expected 3`;return B(l,!1),{ok:!1,error:new Error(l)}}const r=JSON.parse(atob(n[0]));if(r.typ!=="JWT"){const l=`Bad id_token header: typ ${r.typ}, expected JWT`;return B(l,!1),{ok:!1,error:new Error(l)}}const o=JSON.parse(atob(n[1]));return{ok:!0,value:{access_token:e.access_token,id_token:e.id_token,refresh_token:e.refresh_token,sub:o.sub,login_provider:o.login_provider||null,expiry:Date.now()+e.expires_in*1e3,session_id:e.session_id}}}async function Wt(t){const e=new TextEncoder().encode(t.pkceCodeVerifier),n=await crypto.subtle.digest("SHA-256",e);let r="";const o=new Uint8Array(n);for(let i=0;i<o.byteLength;i++)r+=String.fromCharCode(o[i]);const l=btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return t.origin.concat("/oauth2/auth?").concat(new URLSearchParams({auth_method:t.authMethod,login_type:t.loginType,flow:t.flow,response_type:"code",client_id:t.clientid,redirect_uri:t.redirect,code_challenge:l,code_challenge_method:"S256",prompt:"login",scope:"openid offline gamesso.token.create user.profile.read",state:t.pkceState}).toString())}function Zt(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=new Uint32Array(43);return crypto.getRandomValues(e),Array.from(e,function(n){return t[n%t.length]}).join("")}function xt(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e.length-1,r=crypto.getRandomValues(new Uint8Array(12));return Array.from(r).map(o=>Math.round(o*(n-0)/255+0)).map(o=>e[o]).join("")}async function Rt(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState==4&&(o.status==200?n.then(l=>{if(typeof l!="number"){const i={id:l.id,userId:l.userId,displayName:l.displayName,suffix:l.suffix,characters:new Map};J(`Successfully added login for ${i.displayName}`),JSON.parse(o.response).forEach(c=>{i.characters.set(c.accountId,{accountId:c.accountId,displayName:c.displayName,userHash:c.userHash})}),Qt(i),r(!0)}else B(`Error getting account info: ${l}`,!1),r(!1)}):(B(`Error: from ${e}: ${o.status}: ${o.response}`,!1),r(!1)))},o.open("GET",e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization","Bearer ".concat(t.session_id)),o.send()})}async function st(t,e){return await Yt(t,e)}async function Yt(t,e){const n=xt(),r=crypto.randomUUID(),o=atob(F.origin).concat("/oauth2/auth?").concat(new URLSearchParams({id_token_hint:e.id_token,nonce:btoa(r),prompt:"consent",redirect_uri:"http://localhost",response_type:"id_token code",state:n,client_id:ve(zt),scope:"openid offline"}).toString()),l=Kt(e);return t?(t.location.href=o,Qe.update(i=>(i.push({state:n,nonce:r,creds:e,win:t,account_info_promise:l}),i)),!1):e.session_id?await Rt(e,atob(F.auth_api).concat("/accounts"),l):(B("Rejecting stored credentials with missing session_id",!1),!1)}function Kt(t){return new Promise(e=>{const n=`${atob(F.api)}/users/${t.sub}/displayName`,r=new XMLHttpRequest;r.onreadystatechange=()=>{r.readyState==4&&(r.status==200?e(JSON.parse(r.response)):e(r.status))},r.open("GET",n,!0),r.setRequestHeader("Authorization","Bearer ".concat(t.access_token)),r.send()})}function Qt(t){const e=()=>{V.update(n=>{n.account=t;const[r]=t.characters.keys();return n.character=t.characters.get(r),de.size>0&&(n.credentials=de.get(t.userId)),n})};Ne.update(n=>(n.set(t.userId,t),n)),Oe.account&&te.selected_account?t.userId==te.selected_account&&e():Oe.account||e(),je.set({})}function en(t,e,n){return new Promise(r=>{const o=new XMLHttpRequest;o.open("POST",e,!0),o.onreadystatechange=()=>{o.readyState==4&&r(o.status)},o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(new URLSearchParams({token:t,client_id:n}))})}async function Le(){const t=new XMLHttpRequest;t.open("POST","/save-credentials",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{t.readyState==4&&J(`Save-credentials status: ${t.responseText.trim()}`)},V.update(n=>{var r;return n.credentials=de.get((r=Oe.account)==null?void 0:r.userId),n});const e=[];de.forEach(n=>{e.push(n)}),t.send(JSON.stringify(e))}function tn(t,e,n){Pe();const r=(c,u)=>{const a=new XMLHttpRequest,d={};c&&(d.hash=c),t&&(d.jx_session_id=t),e&&(d.jx_character_id=e),n&&(d.jx_display_name=n),te.rs_config_uri?d.config_uri=te.rs_config_uri:d.config_uri=atob(F.default_config_uri),a.open("POST","/launch-rs3-deb?".concat(new URLSearchParams(d).toString()),!0),a.onreadystatechange=()=>{a.readyState==4&&(J(`Game launch status: '${a.responseText.trim()}'`),a.status==200&&c&&ze.set(c))},a.send(u)},o=new XMLHttpRequest,l=atob(F.content_url),i=l.concat("dists/trusty/non-free/binary-amd64/Packages");o.open("GET",i,!0),o.onreadystatechange=()=>{if(o.readyState==4&&o.status==200){const c=Object.fromEntries(o.response.split(`
`).map(u=>u.split(": ")));if(!c.Filename||!c.Size){B(`Could not parse package data from URL: ${i}`,!1),r();return}if(c.SHA256!==ve(ze)){J("Downloading RS3 client...");const u=new XMLHttpRequest;u.open("GET",l.concat(c.Filename),!0),u.responseType="arraybuffer",u.onprogress=a=>{a.loaded&&ge.update(d=>(d[0].text=`Downloading RS3 client... ${(Math.round(1e3*a.loaded/a.total)/10).toFixed(1)}%`,d))},u.onreadystatechange=()=>{u.readyState==4&&u.status==200&&r(c.SHA256,u.response)},u.onerror=()=>{B(`Error downloading game client: from ${i}: non-http error`,!1),r()},u.send()}else J("Latest client is already installed"),r()}},o.onerror=()=>{B(`Error: from ${i}: non-http error`,!1),r()},o.send()}function Ct(t,e,n,r){Pe();const o=r?"/launch-runelite-jar-configure?":"/launch-runelite-jar?",l=(u,a,d)=>{const _=new XMLHttpRequest,g={};u&&(g.id=u),d&&(g.jar_path=d),t&&(g.jx_session_id=t),e&&(g.jx_character_id=e),n&&(g.jx_display_name=n),te.flatpak_rich_presence&&(g.flatpak_rich_presence=""),_.open(a?"POST":"GET",o.concat(new URLSearchParams(g).toString()),!0),_.onreadystatechange=()=>{_.readyState==4&&(J(`Game launch status: '${_.responseText.trim()}'`),_.status==200&&u&&$e.set(u))},_.send(a)};if(te.runelite_use_custom_jar){l(null,null,te.runelite_custom_jar);return}const i=new XMLHttpRequest,c="https://api.github.com/repos/runelite/launcher/releases";i.open("GET",c,!0),i.onreadystatechange=()=>{if(i.readyState==4)if(i.status==200){const u=JSON.parse(i.responseText).map(a=>a.assets).flat().find(a=>a.name.toLowerCase()=="runelite.jar");if(u.id!=ve($e)){J("Downloading RuneLite...");const a=new XMLHttpRequest;a.open("GET",u.browser_download_url,!0),a.responseType="arraybuffer",a.onreadystatechange=()=>{a.readyState==4&&(a.status==200?l(u.id,a.response):B(`Error downloading from ${u.url}: ${a.status}: ${a.responseText}`,!1))},a.onprogress=d=>{d.loaded&&d.lengthComputable&&ge.update(_=>(_[0].text=`Downloading RuneLite... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,_))},a.send()}else J("Latest JAR is already installed"),l()}else B(`Error from ${c}: ${i.status}: ${i.responseText}`,!1)},i.send()}function nn(t,e,n){return Ct(t,e,n,!1)}function sn(t,e,n){return Ct(t,e,n,!0)}function rn(t,e,n){Pe();const r=(i,c)=>{const u=new XMLHttpRequest,a={};i&&(a.version=i),t&&(a.jx_session_id=t),e&&(a.jx_character_id=e),n&&(a.jx_display_name=n),u.open("POST","/launch-hdos-jar?".concat(new URLSearchParams(a).toString()),!0),u.onreadystatechange=()=>{u.readyState==4&&(J(`Game launch status: '${u.responseText.trim()}'`),u.status==200&&i&&Fe.set(i))},u.send(c)},o=new XMLHttpRequest,l="https://cdn.hdos.dev/client/getdown.txt";o.open("GET",l,!0),o.onreadystatechange=()=>{if(o.readyState==4)if(o.status==200){const i=o.responseText.match(/^launcher\.version *= *(.*?)$/m);if(i&&i.length>=2){const c=i[1];if(c!==ve(Fe)){const u=`https://cdn.hdos.dev/launcher/v${c}/hdos-launcher.jar`;J("Downloading HDOS...");const a=new XMLHttpRequest;a.open("GET",u,!0),a.responseType="arraybuffer",a.onreadystatechange=()=>{if(a.readyState==4)if(a.status==200)r(c,a.response);else{const d=JSON.parse(o.responseText).map(_=>_.assets).flat().find(_=>_.name.toLowerCase()=="runelite.jar");B(`Error downloading from ${d.url}: ${a.status}: ${a.responseText}`,!1)}},a.onprogress=d=>{d.loaded&&d.lengthComputable&&ge.update(_=>(_[0].text=`Downloading HDOS... ${(Math.round(1e3*d.loaded/d.total)/10).toFixed(1)}%`,_))},a.send()}else J("Latest JAR is already installed"),r()}else J("Couldn't parse latest launcher version"),r()}else B(`Error from ${l}: ${o.status}: ${o.responseText}`,!1)},o.send()}let qe=!1;function Pe(){var t;if(ve($)&&!qe){qe=!0;const e=new XMLHttpRequest;e.open("POST","/save-config",!0),e.onreadystatechange=()=>{e.readyState==4&&(J(`Save config status: '${e.responseText.trim()}'`),e.status==200&&$.set(!1),qe=!1)},e.setRequestHeader("Content-Type","application/json");const n={};(t=te.selected_characters)==null||t.forEach((l,i)=>{n[i]=l});const r={};Object.assign(r,te),r.selected_characters=n;const o=JSON.stringify(r,null,4);e.send(o)}}function rt(t,e,n){const r=t.slice();return r[22]=e[n],r}function ot(t){let e,n=t[22][1].displayName+"",r,o,l;return{c(){e=b("option"),r=Y(n),f(e,"data-id",o=t[22][1].userId),f(e,"class","dark:bg-slate-900"),e.__value=l=t[22][1].displayName,_e(e,e.__value)},m(i,c){N(i,e,c),p(e,r)},p(i,c){c&4&&n!==(n=i[22][1].displayName+"")&&he(r,n),c&4&&o!==(o=i[22][1].userId)&&f(e,"data-id",o),c&4&&l!==(l=i[22][1].displayName)&&(e.__value=l,_e(e,e.__value))},d(i){i&&H(e)}}}function on(t){let e,n,r,o,l,i,c,u,a,d=Se(t[2]),_=[];for(let g=0;g<d.length;g+=1)_[g]=ot(rt(t,d,g));return{c(){e=b("div"),n=b("select");for(let g=0;g<_.length;g+=1)_[g].c();r=C(),o=b("div"),l=b("button"),l.textContent="Log In",i=C(),c=b("button"),c.textContent="Log Out",f(n,"name","account_select"),f(n,"id","account_select"),f(n,"class","w-full cursor-pointer rounded-lg border-2 border-inherit bg-inherit p-2 text-center"),f(l,"class","mx-auto mr-2 rounded-lg bg-blue-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(c,"class","mx-auto rounded-lg border-2 border-blue-500 p-2 font-bold duration-200 hover:opacity-75"),f(o,"class","mt-5 flex"),f(e,"class","z-10 w-48 rounded-lg border-2 border-slate-300 bg-slate-100 p-3 shadow dark:border-slate-800 dark:bg-slate-900"),f(e,"role","none")},m(g,y){N(g,e,y),p(e,n);for(let m=0;m<_.length;m+=1)_[m]&&_[m].m(n,null);t[7](n),p(e,r),p(e,o),p(o,l),p(o,i),p(o,c),u||(a=[M(n,"change",t[8]),M(l,"click",t[9]),M(c,"click",t[10]),M(e,"mouseenter",t[11]),M(e,"mouseleave",t[12])],u=!0)},p(g,[y]){if(y&4){d=Se(g[2]);let m;for(m=0;m<d.length;m+=1){const v=rt(g,d,m);_[m]?_[m].p(v,y):(_[m]=ot(v),_[m].c(),_[m].m(n,null))}for(;m<_.length;m+=1)_[m].d(1);_.length=d.length}},i:A,o:A,d(g){g&&H(e),Ve(_,g),t[7](null),u=!1,ie(a)}}}function cn(t,e,n){let r,o,l,i;z(t,V,L=>n(13,r=L)),z(t,pe,L=>n(14,o=L)),z(t,Ne,L=>n(2,l=L)),z(t,P,L=>n(15,i=L));let{showAccountDropdown:c}=e,{hoverAccountButton:u}=e;const a=atob(F.origin),d=atob(F.clientid),_=a.concat("/oauth2/token"),g=a.concat("/oauth2/revoke");let y=!1,m;function v(L){u||L.button===0&&c&&!y&&n(5,c=!1)}function k(){var W;if(m.options.length==0){J("Logout unsuccessful: no account selected");return}let L=r.credentials;r.account&&(l.delete((W=r.account)==null?void 0:W.userId),Ne.set(l));const S=m.selectedIndex;S>0?n(1,m.selectedIndex=S-1,m):S==0&&l.size>0?n(1,m.selectedIndex=S+1,m):(delete r.account,delete r.character,delete r.credentials),E(),L&&vt(L,_,d).then(D=>{D===null?en(L.access_token,g,d).then(R=>{R===200?(J("Successful logout"),T(L)):B(`Logout unsuccessful: status ${R}`,!1)}):D===400||D===401?(J("Logout unsuccessful: credentials are invalid, so discarding them anyway"),L&&T(L)):B("Logout unsuccessful: unable to verify credentials due to a network error",!1)})}function T(L){o.delete(L.sub),Le()}function E(){var S;$.set(!0);const L=m[m.selectedIndex].getAttribute("data-id");if(I(V,r.account=l.get(L),r),I(P,i.selected_account=L,i),I(V,r.credentials=o.get((S=r.account)==null?void 0:S.userId),r),r.account&&r.account.characters){const W=document.getElementById("character_select");W.selectedIndex=0;const[D]=r.account.characters.keys();I(V,r.character=r.account.characters.get(D),r)}}addEventListener("mousedown",v),Ie(()=>{var S;let L=0;l.forEach((W,D)=>{var R;W.displayName==((R=r.account)==null?void 0:R.displayName)&&n(1,m.selectedIndex=L,m),L++}),I(V,r.credentials=o.get((S=r.account)==null?void 0:S.userId),r)}),bt(()=>{removeEventListener("mousedown",v)});function h(L){q[L?"unshift":"push"](()=>{m=L,n(1,m)})}const w=()=>{E()},x=()=>{St()},O=()=>{k()},X=()=>{n(0,y=!0)},U=()=>{n(0,y=!1)};return t.$$set=L=>{"showAccountDropdown"in L&&n(5,c=L.showAccountDropdown),"hoverAccountButton"in L&&n(6,u=L.hoverAccountButton)},[y,m,l,k,E,c,u,h,w,x,O,X,U]}class ln extends oe{constructor(e){super(),re(this,e,cn,on,ne,{showAccountDropdown:5,hoverAccountButton:6})}}function an(t){let e;return{c(){e=Y("Log In")},m(n,r){N(n,e,r)},p:A,d(n){n&&H(e)}}}function un(t){var r;let e=((r=t[6].account)==null?void 0:r.displayName)+"",n;return{c(){n=Y(e)},m(o,l){N(o,n,l)},p(o,l){var i;l&64&&e!==(e=((i=o[6].account)==null?void 0:i.displayName)+"")&&he(n,e)},d(o){o&&H(n)}}}function ct(t){let e,n,r,o;function l(c){t[20](c)}let i={hoverAccountButton:t[2]};return t[1]!==void 0&&(i.showAccountDropdown=t[1]),n=new ln({props:i}),q.push(()=>Ze(n,"showAccountDropdown",l)),{c(){e=b("div"),se(n.$$.fragment),f(e,"class","absolute right-2 top-[72px]")},m(c,u){N(c,e,u),Q(n,e,null),o=!0},p(c,u){const a={};u&4&&(a.hoverAccountButton=c[2]),!r&&u&2&&(r=!0,a.showAccountDropdown=c[1],We(()=>r=!1)),n.$set(a)},i(c){o||(j(n.$$.fragment,c),o=!0)},o(c){G(n.$$.fragment,c),o=!1},d(c){c&&H(e),ee(n)}}}function dn(t){let e,n,r,o,l,i,c,u,a,d,_,g,y,m,v,k;function T(x,O){return x[6].account?un:an}let E=T(t),h=E(t),w=t[1]&&ct(t);return{c(){e=b("div"),n=b("div"),r=b("button"),r.textContent="RS3",o=C(),l=b("button"),l.textContent="OSRS",i=C(),c=b("div"),u=b("button"),u.innerHTML='<img src="svgs/lightbulb-solid.svg" class="h-6 w-6" alt="Change Theme"/>',a=C(),d=b("button"),d.innerHTML='<img src="svgs/gear-solid.svg" class="h-6 w-6" alt="Settings"/>',_=C(),g=b("button"),h.c(),y=C(),w&&w.c(),f(r,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(l,"class","mx-1 w-20 rounded-lg border-2 border-blue-500 bg-blue-500 p-2 text-black duration-200 hover:opacity-75"),f(n,"class","m-3 ml-9 font-bold"),f(u,"class","my-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(d,"class","m-3 h-10 w-10 rounded-full bg-blue-500 p-2 duration-200 hover:rotate-45 hover:opacity-75"),f(g,"class","m-2 w-48 rounded-lg border-2 border-slate-300 bg-inherit p-2 text-center font-bold text-black duration-200 hover:opacity-75 dark:border-slate-800 dark:text-slate-50"),f(c,"class","ml-auto flex"),f(e,"class","fixed top-0 flex h-16 w-screen border-b-2 border-slate-300 bg-slate-100 duration-200 dark:border-slate-800 dark:bg-slate-900")},m(x,O){N(x,e,O),p(e,n),p(n,r),t[10](r),p(n,o),p(n,l),t[12](l),p(e,i),p(e,c),p(c,u),p(c,a),p(c,d),p(c,_),p(c,g),h.m(g,null),t[16](g),p(e,y),w&&w.m(e,null),m=!0,v||(k=[M(r,"click",t[11]),M(l,"click",t[13]),M(u,"click",t[14]),M(d,"click",t[15]),M(g,"mouseenter",t[17]),M(g,"mouseleave",t[18]),M(g,"click",t[19])],v=!0)},p(x,[O]){E===(E=T(x))&&h?h.p(x,O):(h.d(1),h=E(x),h&&(h.c(),h.m(g,null))),x[1]?w?(w.p(x,O),O&2&&j(w,1)):(w=ct(x),w.c(),j(w,1),w.m(e,null)):w&&(Ce(),G(w,1,1,()=>{w=null}),Te())},i(x){m||(j(w),m=!0)},o(x){G(w),m=!1},d(x){x&&H(e),t[10](null),t[12](null),h.d(),t[16](null),w&&w.d(),v=!1,ie(k)}}}function fn(t,e,n){let r,o,l;z(t,P,S=>n(21,r=S)),z(t,$,S=>n(22,o=S)),z(t,V,S=>n(6,l=S));let{showSettings:i}=e,c=!1,u=!1,a,d,_;function g(){let S=document.documentElement;S.classList.contains("dark")?S.classList.remove("dark"):S.classList.add("dark"),I(P,r.use_dark_theme=!r.use_dark_theme,r),I($,o=!0,o)}function y(S){switch(S){case Z.osrs:I(V,l.game=Z.osrs,l),I(V,l.client=r.selected_client_index,l),I(P,r.selected_game_index=Z.osrs,r),I($,o=!0,o),d.classList.add("bg-blue-500","text-black"),a.classList.remove("bg-blue-500","text-black");break;case Z.rs3:I(V,l.game=Z.rs3,l),I(P,r.selected_game_index=Z.rs3,r),I($,o=!0,o),d.classList.remove("bg-blue-500","text-black"),a.classList.add("bg-blue-500","text-black");break}}function m(){if(_.innerHTML=="Log In"){St();return}n(1,c=!c)}Ie(()=>{y(r.selected_game_index)});function v(S){q[S?"unshift":"push"](()=>{a=S,n(3,a)})}const k=()=>{y(Z.rs3)};function T(S){q[S?"unshift":"push"](()=>{d=S,n(4,d)})}const E=()=>{y(Z.osrs)},h=()=>g(),w=()=>{n(0,i=!0)};function x(S){q[S?"unshift":"push"](()=>{_=S,n(5,_)})}const O=()=>{n(2,u=!0)},X=()=>{n(2,u=!1)},U=()=>m();function L(S){c=S,n(1,c)}return t.$$set=S=>{"showSettings"in S&&n(0,i=S.showSettings)},[i,c,u,a,d,_,l,g,y,m,v,k,T,E,h,w,x,O,X,U,L]}class pn extends oe{constructor(e){super(),re(this,e,fn,dn,ne,{showSettings:0})}}function hn(t){let e,n,r,o,l,i;return{c(){e=b("div"),n=b("div"),n.innerHTML="",r=C(),o=b("div"),o.innerHTML="",f(n,"class","absolute left-0 top-0 z-10 h-screen w-screen backdrop-blur-sm backdrop-filter"),f(o,"class","absolute left-0 top-0 z-10 h-screen w-screen bg-black opacity-75"),f(o,"role","none")},m(c,u){N(c,e,u),p(e,n),p(e,r),p(e,o),l||(i=M(o,"click",t[1]),l=!0)},p:A,i:A,o:A,d(c){c&&H(e),l=!1,i()}}}function _n(t){const e=Dt();return[e,()=>{e("click")}]}class Tt extends oe{constructor(e){super(),re(this,e,_n,hn,ne,{})}}function gn(t){let e,n,r,o,l,i,c,u,a,d,_,g;return n=new Tt({}),{c(){e=b("div"),se(n.$$.fragment),r=C(),o=b("div"),l=b("p"),l.textContent=`${t[1]}`,i=C(),c=b("p"),c.textContent=`${t[2]}`,u=C(),a=b("button"),a.textContent="I Understand",f(l,"class","p-2"),f(c,"class","p-2"),f(a,"class","m-5 rounded-lg border-2 border-blue-500 p-2 duration-200 hover:opacity-75"),f(o,"class","absolute left-1/4 top-1/4 z-20 w-1/2 rounded-lg bg-slate-100 p-5 text-center shadow-lg dark:bg-slate-900"),f(e,"id","disclaimer")},m(y,m){N(y,e,m),Q(n,e,null),p(e,r),p(e,o),p(o,l),p(o,i),p(o,c),p(o,u),p(o,a),d=!0,_||(g=M(a,"click",t[3]),_=!0)},p:A,i(y){d||(j(n.$$.fragment,y),d=!0)},o(y){G(n.$$.fragment,y),d=!1},d(y){y&&H(e),ee(n),_=!1,g()}}}function mn(t,e,n){let r;z(t,Me,c=>n(0,r=c));const o=atob("Qm9sdCBpcyBhbiB1bm9mZmljaWFsIHRoaXJkLXBhcnR5IGxhdW5jaGVyLiBJdCdzIGZyZWUgYW5kIG9wZW4tc291cmNlIHNvZnR3YXJlIGxpY2Vuc2VkIHVuZGVyIEFHUEwgMy4wLg=="),l=atob("SmFnZXggaXMgbm90IHJlc3BvbnNpYmxlIGZvciBhbnkgcHJvYmxlbXMgb3IgZGFtYWdlIGNhdXNlZCBieSB1c2luZyB0aGlzIHByb2R1Y3Qu");return[r,o,l,()=>{I(Me,r=!1,r)}]}class bn extends oe{constructor(e){super(),re(this,e,mn,gn,ne,{})}}function kn(t){let e,n,r,o;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/database-solid.svg" alt="Browse app data" class="mr-2 h-7 w-7 rounded-lg bg-violet-500 p-1"/>
			Browse App Data</div>`,f(n,"id","data_dir_button"),f(n,"class","p-2 hover:opacity-75"),f(e,"id","general_options"),f(e,"class","col-span-3 p-5 pt-10")},m(l,i){N(l,e,i),p(e,n),r||(o=M(n,"click",t[1]),r=!0)},p:A,i:A,o:A,d(l){l&&H(e),r=!1,o()}}}function wn(t){function e(){var r=new XMLHttpRequest;r.open("GET","/browse-data"),r.onreadystatechange=()=>{r.readyState==4&&J(`Browse status: '${r.responseText.trim()}'`)},r.send()}return[e,()=>{e()}]}class yn extends oe{constructor(e){super(),re(this,e,wn,kn,ne,{})}}function Sn(t){let e,n,r,o,l,i,c,u,a,d,_,g,y,m,v,k,T,E,h,w,x;return{c(){e=b("div"),n=b("button"),n.innerHTML=`<div class="flex"><img src="svgs/wrench-solid.svg" alt="Configure RuneLite" class="mr-2 h-7 w-7 rounded-lg bg-pink-500 p-1"/>
			Configure RuneLite</div>`,r=C(),o=b("div"),l=b("label"),l.textContent="Expose rich presence to Flatpak Discord:",i=C(),c=b("input"),u=C(),a=b("div"),d=b("label"),d.textContent="Use custom RuneLite JAR:",_=C(),g=b("input"),y=C(),m=b("div"),v=b("textarea"),k=C(),T=b("br"),E=C(),h=b("button"),h.textContent="Select File",f(n,"id","rl_configure"),f(n,"class","p-2 pb-5 hover:opacity-75"),f(l,"for","flatpak_rich_presence"),f(c,"type","checkbox"),f(c,"name","flatpak_rich_presence"),f(c,"id","flatpak_rich_presence"),f(c,"class","ml-2"),f(o,"id","flatpak_div"),f(o,"class","mx-auto border-t-2 border-slate-300 p-2 py-5 dark:border-slate-800"),f(d,"for","use_custom_jar"),f(g,"type","checkbox"),f(g,"name","use_custom_jar"),f(g,"id","use_custom_jar"),f(g,"class","ml-2"),f(a,"class","mx-auto border-t-2 border-slate-300 p-2 pt-5 dark:border-slate-800"),v.disabled=!0,f(v,"name","custom_jar_file"),f(v,"id","custom_jar_file"),f(v,"class","h-10 rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),h.disabled=!0,f(h,"id","custom_jar_file_button"),f(h,"class","mt-1 rounded-lg border-2 border-blue-500 p-1 duration-200 hover:opacity-75"),f(m,"id","custom_jar_div"),f(m,"class","mx-auto p-2 opacity-25"),f(e,"id","osrs_options"),f(e,"class","col-span-3 p-5 pt-10")},m(O,X){N(O,e,X),p(e,n),p(e,r),p(e,o),p(o,l),p(o,i),p(o,c),t[12](c),t[14](o),p(e,u),p(e,a),p(a,d),p(a,_),p(a,g),t[15](g),p(e,y),p(e,m),p(m,v),t[17](v),p(m,k),p(m,T),p(m,E),p(m,h),t[19](h),t[21](m),w||(x=[M(n,"click",t[11]),M(c,"change",t[13]),M(g,"change",t[16]),M(v,"change",t[18]),M(h,"click",t[20])],w=!0)},p:A,i:A,o:A,d(O){O&&H(e),t[12](null),t[14](null),t[15](null),t[17](null),t[19](null),t[21](null),w=!1,ie(x)}}}function vn(t,e,n){let r,o,l,i;z(t,Ke,R=>n(22,r=R)),z(t,P,R=>n(23,o=R)),z(t,V,R=>n(24,l=R)),z(t,$,R=>n(25,i=R));let c,u,a,d,_,g;function y(){c.classList.toggle("opacity-25"),n(1,u.disabled=!u.disabled,u),n(2,a.disabled=!a.disabled,a),I(P,o.runelite_use_custom_jar=d.checked,o),o.runelite_use_custom_jar?u.value&&I(P,o.runelite_custom_jar=u.value,o):(n(1,u.value="",u),I(P,o.runelite_custom_jar="",o),I(P,o.runelite_use_custom_jar=!1,o)),I($,i=!0,i)}function m(){I(P,o.flatpak_rich_presence=_.checked,o),I($,i=!0,i)}function v(){I(P,o.runelite_custom_jar=u.value,o),I($,i=!0,i)}function k(){n(3,d.disabled=!0,d),n(2,a.disabled=!0,a);var R=new XMLHttpRequest;R.onreadystatechange=()=>{R.readyState==4&&(R.status==200&&(n(1,u.value=R.responseText,u),I(P,o.runelite_custom_jar=R.responseText,o),I($,i=!0,i)),n(2,a.disabled=!1,a),n(3,d.disabled=!1,d))},R.open("GET","/jar-file-picker",!0),R.send()}function T(){var R,me,tt;if(!l.account||!l.character){J("Please log in to configure RuneLite");return}sn((R=l.credentials)==null?void 0:R.session_id,(me=l.character)==null?void 0:me.accountId,(tt=l.character)==null?void 0:tt.displayName)}Ie(()=>{n(4,_.checked=o.flatpak_rich_presence,_),n(3,d.checked=o.runelite_use_custom_jar,d),d.checked&&o.runelite_custom_jar?(c.classList.remove("opacity-25"),n(1,u.disabled=!1,u),n(2,a.disabled=!1,a),n(1,u.value=o.runelite_custom_jar,u)):(n(3,d.checked=!1,d),I(P,o.runelite_use_custom_jar=!1,o)),r!=="linux"&&g.remove()});const E=()=>T();function h(R){q[R?"unshift":"push"](()=>{_=R,n(4,_)})}const w=()=>{m()};function x(R){q[R?"unshift":"push"](()=>{g=R,n(5,g)})}function O(R){q[R?"unshift":"push"](()=>{d=R,n(3,d)})}const X=()=>{y()};function U(R){q[R?"unshift":"push"](()=>{u=R,n(1,u)})}const L=()=>{v()};function S(R){q[R?"unshift":"push"](()=>{a=R,n(2,a)})}const W=()=>{k()};function D(R){q[R?"unshift":"push"](()=>{c=R,n(0,c)})}return[c,u,a,d,_,g,y,m,v,k,T,E,h,w,x,O,X,U,L,S,W,D]}class Ln extends oe{constructor(e){super(),re(this,e,vn,Sn,ne,{})}}function xn(t){let e,n,r,o,l,i,c,u,a,d;return{c(){e=b("div"),n=b("div"),r=b("label"),r.textContent="Use custom config URI:",o=C(),l=b("input"),i=C(),c=b("div"),u=b("textarea"),f(r,"for","use_custom_uri"),f(l,"type","checkbox"),f(l,"name","use_custom_uri"),f(l,"id","use_custom_uri"),f(l,"class","ml-2"),f(n,"class","mx-auto p-2"),u.disabled=!0,f(u,"name","config_uri_address"),f(u,"id","config_uri_address"),f(u,"rows","4"),f(u,"class","rounded border-2 border-slate-300 bg-slate-100 text-slate-950 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-50"),u.value="		",f(c,"id","config_uri_div"),f(c,"class","mx-auto p-2 opacity-25"),f(e,"id","rs3_options"),f(e,"class","col-span-3 p-5 pt-10")},m(_,g){N(_,e,g),p(e,n),p(n,r),p(n,o),p(n,l),t[5](l),p(e,i),p(e,c),p(c,u),t[8](u),t[9](c),a||(d=[M(l,"change",t[6]),M(u,"change",t[7])],a=!0)},p:A,i:A,o:A,d(_){_&&H(e),t[5](null),t[8](null),t[9](null),a=!1,ie(d)}}}function Rn(t,e,n){let r,o,l;z(t,Ye,k=>n(10,r=k)),z(t,P,k=>n(11,o=k)),z(t,$,k=>n(12,l=k));let i,c,u;function a(){i.classList.toggle("opacity-25"),n(1,c.disabled=!c.disabled,c),I($,l=!0,l),u.checked||(n(1,c.value=atob(r.default_config_uri),c),I(P,o.rs_config_uri="",o))}function d(){I(P,o.rs_config_uri=c.value,o),I($,l=!0,l)}Ie(()=>{o.rs_config_uri?(n(1,c.value=o.rs_config_uri,c),n(2,u.checked=!0,u),a()):n(1,c.value=atob(r.default_config_uri),c)});function _(k){q[k?"unshift":"push"](()=>{u=k,n(2,u)})}const g=()=>{a()},y=()=>{d()};function m(k){q[k?"unshift":"push"](()=>{c=k,n(1,c)})}function v(k){q[k?"unshift":"push"](()=>{i=k,n(0,i)})}return[i,c,u,a,d,_,g,y,m,v]}class Cn extends oe{constructor(e){super(),re(this,e,Rn,xn,ne,{})}}function Tn(t){let e,n;return e=new Cn({}),{c(){se(e.$$.fragment)},m(r,o){Q(e,r,o),n=!0},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){ee(e,r)}}}function In(t){let e,n;return e=new Ln({}),{c(){se(e.$$.fragment)},m(r,o){Q(e,r,o),n=!0},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){ee(e,r)}}}function En(t){let e,n;return e=new yn({}),{c(){se(e.$$.fragment)},m(r,o){Q(e,r,o),n=!0},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){ee(e,r)}}}function Hn(t){let e,n,r,o,l,i,c,u,a,d,_,g,y,m,v,k,T,E,h,w,x,O,X,U;n=new Tt({}),n.$on("click",t[7]);const L=[En,In,Tn],S=[];function W(D,R){return D[1]==D[5].general?0:D[1]==D[5].osrs?1:D[1]==D[5].rs3?2:-1}return~(w=W(t))&&(x=S[w]=L[w](t)),{c(){e=b("div"),se(n.$$.fragment),r=C(),o=b("div"),l=b("button"),l.innerHTML='<img src="svgs/xmark-solid.svg" class="h-5 w-5" alt="Close"/>',i=C(),c=b("div"),u=b("div"),a=b("button"),d=Y("General"),_=b("br"),g=C(),y=b("button"),m=Y("OSRS"),v=b("br"),k=C(),T=b("button"),E=Y("RS3"),h=C(),x&&x.c(),f(l,"class","absolute right-3 top-3 rounded-full bg-rose-500 p-[2px] shadow-lg duration-200 hover:rotate-90 hover:opacity-75"),f(a,"id","general_button"),f(a,"class",ue),f(y,"id","osrs_button"),f(y,"class",Ae),f(T,"id","rs3_button"),f(T,"class",ue),f(u,"class","relative h-full border-r-2 border-slate-300 pt-10 dark:border-slate-800"),f(c,"class","grid h-full grid-cols-4"),f(o,"class","absolute left-[13%] top-[13%] z-20 h-3/4 w-3/4 rounded-lg bg-slate-100 text-center shadow-lg dark:bg-slate-900"),f(e,"id","settings")},m(D,R){N(D,e,R),Q(n,e,null),p(e,r),p(e,o),p(o,l),p(o,i),p(o,c),p(c,u),p(u,a),p(a,d),t[9](a),p(u,_),p(u,g),p(u,y),p(y,m),t[11](y),p(u,v),p(u,k),p(u,T),p(T,E),t[13](T),p(c,h),~w&&S[w].m(c,null),O=!0,X||(U=[M(l,"click",t[8]),M(a,"click",t[10]),M(y,"click",t[12]),M(T,"click",t[14])],X=!0)},p(D,[R]){let me=w;w=W(D),w!==me&&(x&&(Ce(),G(S[me],1,1,()=>{S[me]=null}),Te()),~w?(x=S[w],x||(x=S[w]=L[w](D),x.c()),j(x,1),x.m(c,null)):x=null)},i(D){O||(j(n.$$.fragment,D),j(x),O=!0)},o(D){G(n.$$.fragment,D),G(x),O=!1},d(D){D&&H(e),ee(n),t[9](null),t[11](null),t[13](null),~w&&S[w].d(),X=!1,ie(U)}}}let Ae="border-2 border-blue-500 bg-blue-500 hover:opacity-75 font-bold text-black duration-200 rounded-lg p-1 mx-auto my-1 w-3/4",ue="border-2 border-blue-500 hover:opacity-75 duration-200 rounded-lg p-1 mx-auto my-1 w-3/4";function An(t,e,n){let{showSettings:r}=e;var o=(h=>(h[h.general=0]="general",h[h.osrs=1]="osrs",h[h.rs3=2]="rs3",h))(o||{});let l=1,i,c,u;function a(h){switch(h){case 0:n(1,l=0),n(2,i.classList.value=Ae,i),n(3,c.classList.value=ue,c),n(4,u.classList.value=ue,u);break;case 1:n(1,l=1),n(2,i.classList.value=ue,i),n(3,c.classList.value=Ae,c),n(4,u.classList.value=ue,u);break;case 2:n(1,l=2),n(2,i.classList.value=ue,i),n(3,c.classList.value=ue,c),n(4,u.classList.value=Ae,u);break}}function d(h){h.key==="Escape"&&n(0,r=!1)}addEventListener("keydown",d),bt(()=>{removeEventListener("keydown",d)});const _=()=>{n(0,r=!1)},g=()=>{n(0,r=!1)};function y(h){q[h?"unshift":"push"](()=>{i=h,n(2,i)})}const m=()=>{a(o.general)};function v(h){q[h?"unshift":"push"](()=>{c=h,n(3,c)})}const k=()=>{a(o.osrs)};function T(h){q[h?"unshift":"push"](()=>{u=h,n(4,u)})}const E=()=>{a(o.rs3)};return t.$$set=h=>{"showSettings"in h&&n(0,r=h.showSettings)},[r,l,i,c,u,o,a,_,g,y,m,v,k,T,E]}class Nn extends oe{constructor(e){super(),re(this,e,An,Hn,ne,{showSettings:0})}}function lt(t,e,n){const r=t.slice();return r[1]=e[n],r}function Mn(t){var u;let e,n=((u=t[1].time)==null?void 0:u.toLocaleTimeString())+"",r,o,l=t[1].text+"",i,c;return{c(){e=b("li"),r=Y(n),o=Y(`
					- `),i=Y(l),c=C()},m(a,d){N(a,e,d),p(e,r),p(e,o),p(e,i),p(e,c)},p(a,d){var _;d&1&&n!==(n=((_=a[1].time)==null?void 0:_.toLocaleTimeString())+"")&&he(r,n),d&1&&l!==(l=a[1].text+"")&&he(i,l)},d(a){a&&H(e)}}}function On(t){var u;let e,n=((u=t[1].time)==null?void 0:u.toLocaleTimeString())+"",r,o,l=t[1].text+"",i,c;return{c(){e=b("li"),r=Y(n),o=Y(`
					- `),i=Y(l),c=C(),f(e,"class","text-rose-500")},m(a,d){N(a,e,d),p(e,r),p(e,o),p(e,i),p(e,c)},p(a,d){var _;d&1&&n!==(n=((_=a[1].time)==null?void 0:_.toLocaleTimeString())+"")&&he(r,n),d&1&&l!==(l=a[1].text+"")&&he(i,l)},d(a){a&&H(e)}}}function it(t){let e;function n(l,i){return l[1].isError?On:Mn}let r=n(t),o=r(t);return{c(){o.c(),e=mt()},m(l,i){o.m(l,i),N(l,e,i)},p(l,i){r===(r=n(l))&&o?o.p(l,i):(o.d(1),o=r(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&H(e),o.d(l)}}}function Dn(t){let e,n,r,o,l=Se(t[0]),i=[];for(let c=0;c<l.length;c+=1)i[c]=it(lt(t,l,c));return{c(){e=b("div"),n=b("div"),n.innerHTML='<img src="svgs/circle-info-solid.svg" alt="Message list icon" class="h-7 w-7 rounded-full bg-blue-500 p-[3px] duration-200"/>',r=C(),o=b("ol");for(let c=0;c<i.length;c+=1)i[c].c();f(n,"class","absolute right-2 top-2"),f(o,"id","message_list"),f(o,"class","h-full w-[105%] list-inside list-disc overflow-y-auto pl-5 pt-1 marker:text-blue-500"),f(e,"class","fixed bottom-0 h-1/4 w-screen border-t-2 border-t-slate-300 bg-slate-100 duration-200 dark:border-t-slate-800 dark:bg-slate-900")},m(c,u){N(c,e,u),p(e,n),p(e,r),p(e,o);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(o,null)},p(c,[u]){if(u&1){l=Se(c[0]);let a;for(a=0;a<l.length;a+=1){const d=lt(c,l,a);i[a]?i[a].p(d,u):(i[a]=it(d),i[a].c(),i[a].m(o,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=l.length}},i:A,o:A,d(c){c&&H(e),Ve(i,c)}}}function jn(t,e,n){let r;return z(t,ge,o=>n(0,r=o)),[r]}class Pn extends oe{constructor(e){super(),re(this,e,jn,Dn,ne,{})}}function at(t,e,n){const r=t.slice();return r[13]=e[n],r}function Un(t){let e;return{c(){e=b("option"),e.textContent="RS3",f(e,"data-id",ce.rs3),f(e,"class","dark:bg-slate-900"),e.__value="RS3",_e(e,e.__value)},m(n,r){N(n,e,r)},d(n){n&&H(e)}}}function Bn(t){let e,n;return{c(){e=b("option"),e.textContent="RuneLite",n=b("option"),n.textContent="HDOS",f(e,"data-id",ce.runeLite),f(e,"class","dark:bg-slate-900"),e.__value="RuneLite",_e(e,e.__value),f(n,"data-id",ce.hdos),f(n,"class","dark:bg-slate-900"),n.__value="HDOS",_e(n,n.__value)},m(r,o){N(r,e,o),N(r,n,o)},d(r){r&&(H(e),H(n))}}}function ut(t){let e,n=Se(t[3].account.characters),r=[];for(let o=0;o<n.length;o+=1)r[o]=dt(at(t,n,o));return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=mt()},m(o,l){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(o,l);N(o,e,l)},p(o,l){if(l&8){n=Se(o[3].account.characters);let i;for(i=0;i<n.length;i+=1){const c=at(o,n,i);r[i]?r[i].p(c,l):(r[i]=dt(c),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(o){o&&H(e),Ve(r,o)}}}function qn(t){let e;return{c(){e=Y("New Character")},m(n,r){N(n,e,r)},p:A,d(n){n&&H(e)}}}function Jn(t){let e=t[13][1].displayName+"",n;return{c(){n=Y(e)},m(r,o){N(r,n,o)},p(r,o){o&8&&e!==(e=r[13][1].displayName+"")&&he(n,e)},d(r){r&&H(n)}}}function dt(t){let e,n,r,o;function l(u,a){return u[13][1].displayName?Jn:qn}let i=l(t),c=i(t);return{c(){e=b("option"),c.c(),n=C(),f(e,"data-id",r=t[13][1].accountId),f(e,"class","dark:bg-slate-900"),e.__value=o=`
						`+t[13][1].displayName+`
					`,_e(e,e.__value)},m(u,a){N(u,e,a),c.m(e,null),p(e,n)},p(u,a){i===(i=l(u))&&c?c.p(u,a):(c.d(1),c=i(u),c&&(c.c(),c.m(e,n))),a&8&&r!==(r=u[13][1].accountId)&&f(e,"data-id",r),a&8&&o!==(o=`
						`+u[13][1].displayName+`
					`)&&(e.__value=o,_e(e,e.__value))},d(u){u&&H(e),c.d()}}}function Gn(t){let e,n,r,o,l,i,c,u,a,d,_,g,y,m,v,k,T,E,h,w,x;function O(S,W){if(S[3].game==Z.osrs)return Bn;if(S[3].game==Z.rs3)return Un}let X=O(t),U=X&&X(t),L=t[3].account&&ut(t);return{c(){e=b("div"),n=b("img"),o=C(),l=b("button"),l.textContent="Play",i=C(),c=b("div"),u=b("label"),u.textContent="Game Client",a=C(),d=b("br"),_=C(),g=b("select"),U&&U.c(),y=C(),m=b("div"),v=b("label"),v.textContent="Character",k=C(),T=b("br"),E=C(),h=b("select"),L&&L.c(),Ht(n.src,r="svgs/rocket-solid.svg")||f(n,"src",r),f(n,"alt","Launch icon"),f(n,"class","mx-auto mb-5 w-24 rounded-3xl bg-gradient-to-br from-rose-500 to-violet-500 p-5"),f(l,"class","mx-auto mb-2 w-52 rounded-lg bg-emerald-500 p-2 font-bold text-black duration-200 hover:opacity-75"),f(u,"for","game_client_select"),f(u,"class","text-sm"),f(g,"id","game_client_select"),f(g,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),f(c,"class","mx-auto my-2"),f(v,"for","character_select"),f(v,"class","text-sm"),f(h,"id","character_select"),f(h,"class","mx-auto w-52 cursor-pointer rounded-lg border-2 border-slate-300 bg-inherit p-2 text-inherit duration-200 hover:opacity-75 dark:border-slate-800"),f(m,"class","mx-auto my-2"),f(e,"class","bg-grad flex h-full flex-col border-slate-300 p-5 duration-200 dark:border-slate-800")},m(S,W){N(S,e,W),p(e,n),p(e,o),p(e,l),p(e,i),p(e,c),p(c,u),p(c,a),p(c,d),p(c,_),p(c,g),U&&U.m(g,null),t[7](g),p(e,y),p(e,m),p(m,v),p(m,k),p(m,T),p(m,E),p(m,h),L&&L.m(h,null),t[9](h),w||(x=[M(l,"click",t[6]),M(g,"change",t[8]),M(h,"change",t[10])],w=!0)},p(S,[W]){X!==(X=O(S))&&(U&&U.d(1),U=X&&X(S),U&&(U.c(),U.m(g,null))),S[3].account?L?L.p(S,W):(L=ut(S),L.c(),L.m(h,null)):L&&(L.d(1),L=null)},i:A,o:A,d(S){S&&H(e),U&&U.d(),t[7](null),L&&L.d(),t[9](null),w=!1,ie(x)}}}function Xn(t,e,n){let r,o,l;z(t,V,k=>n(3,r=k)),z(t,P,k=>n(11,o=k)),z(t,$,k=>n(12,l=k));let i,c;function u(){var T,E;if(!r.account)return;const k=i[i.selectedIndex].getAttribute("data-id");I(V,r.character=r.account.characters.get(k),r),r.character&&((E=o.selected_characters)==null||E.set(r.account.userId,(T=r.character)==null?void 0:T.accountId)),I($,l=!0,l)}function a(){c.value=="RuneLite"?(I(V,r.client=ce.runeLite,r),I(P,o.selected_client_index=ce.runeLite,o)):c.value=="HDOS"&&(I(V,r.client=ce.hdos,r),I(P,o.selected_client_index=ce.hdos,o)),I($,l=!0,l)}function d(){var k,T,E,h,w,x,O,X,U;if(!r.account||!r.character){J("Please log in to launch a client");return}switch(r.game){case Z.osrs:r.client==ce.runeLite?nn((k=r.credentials)==null?void 0:k.session_id,(T=r.character)==null?void 0:T.accountId,(E=r.character)==null?void 0:E.displayName):r.client==ce.hdos&&rn((h=r.credentials)==null?void 0:h.session_id,(w=r.character)==null?void 0:w.accountId,(x=r.character)==null?void 0:x.displayName);break;case Z.rs3:tn((O=r.credentials)==null?void 0:O.session_id,(X=r.character)==null?void 0:X.accountId,(U=r.character)==null?void 0:U.displayName);break}}Ot(()=>{var k;if(r.game==Z.osrs&&r.client&&n(2,c.selectedIndex=r.client,c),r.account&&((k=o.selected_characters)!=null&&k.has(r.account.userId)))for(let T=0;T<i.options.length;T++)i[T].getAttribute("data-id")==o.selected_characters.get(r.account.userId)&&n(1,i.selectedIndex=T,i)}),Ie(()=>{o.selected_game_index==Z.osrs&&(n(2,c.selectedIndex=o.selected_client_index,c),I(V,r.client=c.selectedIndex,r))});const _=()=>{d()};function g(k){q[k?"unshift":"push"](()=>{c=k,n(2,c)})}const y=()=>{a()};function m(k){q[k?"unshift":"push"](()=>{i=k,n(1,i)})}return[u,i,c,r,a,d,_,g,y,m,()=>u()]}class zn extends oe{constructor(e){super(),re(this,e,Xn,Gn,ne,{characterChanged:0})}get characterChanged(){return this.$$.ctx[0]}}function $n(t){let e;return{c(){e=b("div"),e.innerHTML='<img src="svgs/circle-notch-solid.svg" alt="" class="mx-auto h-1/6 w-1/6 animate-spin"/>',f(e,"class","container mx-auto bg-slate-100 p-5 text-center text-slate-900 dark:bg-slate-900 dark:text-slate-50")},m(n,r){N(n,e,r)},p:A,i:A,o:A,d(n){n&&H(e)}}}class Fn extends oe{constructor(e){super(),re(this,e,null,$n,ne,{})}}function Vn(t){let e,n,r,o,l,i,c,u,a,d,_,g,y,m,v=t[2]&&ft(),k=t[0]&&pt(t);function T(h){t[4](h)}let E={};return t[0]!==void 0&&(E.showSettings=t[0]),r=new pn({props:E}),q.push(()=>Ze(r,"showSettings",T)),a=new zn({}),y=new Pn({}),{c(){v&&v.c(),e=C(),k&&k.c(),n=C(),se(r.$$.fragment),l=C(),i=b("div"),c=b("div"),u=C(),se(a.$$.fragment),d=C(),_=b("div"),g=C(),se(y.$$.fragment),f(i,"class","mt-16 grid h-full grid-flow-col grid-cols-3")},m(h,w){v&&v.m(h,w),N(h,e,w),k&&k.m(h,w),N(h,n,w),Q(r,h,w),N(h,l,w),N(h,i,w),p(i,c),p(i,u),Q(a,i,null),p(i,d),p(i,_),N(h,g,w),Q(y,h,w),m=!0},p(h,w){h[2]?v?w&4&&j(v,1):(v=ft(),v.c(),j(v,1),v.m(e.parentNode,e)):v&&(Ce(),G(v,1,1,()=>{v=null}),Te()),h[0]?k?(k.p(h,w),w&1&&j(k,1)):(k=pt(h),k.c(),j(k,1),k.m(n.parentNode,n)):k&&(Ce(),G(k,1,1,()=>{k=null}),Te());const x={};!o&&w&1&&(o=!0,x.showSettings=h[0],We(()=>o=!1)),r.$set(x)},i(h){m||(j(v),j(k),j(r.$$.fragment,h),j(a.$$.fragment,h),j(y.$$.fragment,h),m=!0)},o(h){G(v),G(k),G(r.$$.fragment,h),G(a.$$.fragment,h),G(y.$$.fragment,h),m=!1},d(h){h&&(H(e),H(n),H(l),H(i),H(g)),v&&v.d(h),k&&k.d(h),ee(r,h),ee(a),ee(y,h)}}}function Wn(t){let e,n;return e=new Fn({}),{c(){se(e.$$.fragment)},m(r,o){Q(e,r,o),n=!0},p:A,i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){ee(e,r)}}}function ft(t){let e,n;return e=new bn({}),{c(){se(e.$$.fragment)},m(r,o){Q(e,r,o),n=!0},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){G(e.$$.fragment,r),n=!1},d(r){ee(e,r)}}}function pt(t){let e,n,r;function o(i){t[3](i)}let l={};return t[0]!==void 0&&(l.showSettings=t[0]),e=new Nn({props:l}),q.push(()=>Ze(e,"showSettings",o)),{c(){se(e.$$.fragment)},m(i,c){Q(e,i,c),r=!0},p(i,c){const u={};!n&&c&1&&(n=!0,u.showSettings=i[0],We(()=>n=!1)),e.$set(u)},i(i){r||(j(e.$$.fragment,i),r=!0)},o(i){G(e.$$.fragment,i),r=!1},d(i){ee(e,i)}}}function Zn(t){let e,n,r,o;const l=[Wn,Vn],i=[];function c(u,a){return u[1]?0:1}return n=c(t),r=i[n]=l[n](t),{c(){e=b("main"),r.c(),f(e,"class","h-full")},m(u,a){N(u,e,a),i[n].m(e,null),o=!0},p(u,[a]){let d=n;n=c(u),n===d?i[n].p(u,a):(Ce(),G(i[d],1,1,()=>{i[d]=null}),Te(),r=i[n],r?r.p(u,a):(r=i[n]=l[n](u),r.c()),j(r,1),r.m(e,null))},i(u){o||(j(r),o=!0)},o(u){G(r),o=!1},d(u){u&&H(e),i[n].d()}}}function Yn(t,e,n){let r;z(t,Me,a=>n(2,r=a));let o=!1,l=!1;Vt();const i=window.opener||window.parent;if(i){const a=new URLSearchParams(window.location.search);a.get("id_token")?(l=!0,i.postMessage({type:"gameSessionServerAuth",code:a.get("code"),id_token:a.get("id_token"),state:a.get("state")},"*")):a.get("code")&&(l=!0,i.postMessage({type:"authCode",code:a.get("code"),state:a.get("state")},"*"))}function c(a){o=a,n(0,o)}function u(a){o=a,n(0,o)}return[o,l,r,c,u]}class Kn extends oe{constructor(e){super(),re(this,e,Yn,Zn,ne,{})}}new Kn({target:document.getElementById("app")});const le=[],Qn=ve(Xt);let F;le.push(Ye.subscribe(t=>F=t));let te;le.push(P.subscribe(t=>te=t));le.push(Ke.subscribe(t=>t));let de;le.push(pe.subscribe(t=>de=t));let ae;le.push(je.subscribe(t=>ae=t));let et;le.push(Qe.subscribe(t=>et=t));le.push(ge.subscribe(t=>t));le.push(Ne.subscribe(t=>t));let Oe;le.push(V.subscribe(t=>Oe=t));function es(){var o;const t=atob(F.origin),e=atob(F.clientid),n=t.concat("/oauth2/token");de.size==0&&Me.set(!0),$t(),te.selected_game_accounts&&((o=te.selected_game_accounts)==null?void 0:o.size)>0&&P.update(l=>{var i;return l.selected_characters=l.selected_game_accounts,(i=l.selected_game_accounts)==null||i.clear(),l});const r=[Qn,t,atob(F.origin_2fa)];window.addEventListener("message",l=>{if(!r.includes(l.origin)){J(`discarding window message from origin ${l.origin}`);return}let i=ae;const c=new XMLHttpRequest;switch(l.data.type){case"authCode":if(i){je.set({});const u=new URLSearchParams({grant_type:"authorization_code",client_id:atob(F.clientid),code:l.data.code,code_verifier:i.verifier,redirect_uri:atob(F.redirect)});c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const a=Lt(c.response),d=yt(a);d?st(i==null?void 0:i.win,d).then(_=>{_&&(pe.update(g=>(g.set(d.sub,d),g)),Le())}):(B("Error: invalid credentials received",!1),i.win.close())}else B(`Error: from ${n}: ${c.status}: ${c.response}`,!1),i.win.close()},c.open("POST",n,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Accept","application/json"),c.send(u)}break;case"initAuth":J(`message: init auth: ${l.data.auth_method}`);break;case"externalUrl":c.onreadystatechange=()=>{c.readyState==4&&J(`External URL status: '${c.responseText.trim()}'`)},c.open("POST","/open-external-url",!0),c.send(l.data.url);break;case"gameSessionServerAuth":if(i=et.find(u=>l.data.state==u.state),i){Ft(i,!0);const u=l.data.id_token.split(".");if(u.length!==3){B(`Malformed id_token: ${u.length} sections, expected 3`,!1);break}const a=JSON.parse(atob(u[0]));if(a.typ!=="JWT"){B(`Bad id_token header: typ ${a.typ}, expected JWT`,!1);break}const d=JSON.parse(atob(u[1]));if(atob(d.nonce)!==i.nonce){B("Incorrect nonce in id_token",!1);break}const _=atob(F.auth_api).concat("/sessions");c.onreadystatechange=()=>{if(c.readyState==4)if(c.status==200){const g=atob(F.auth_api).concat("/accounts");i.creds.session_id=JSON.parse(c.response).sessionId,Rt(i.creds,g,i.account_info_promise).then(y=>{y&&(pe.update(m=>{var v;return m.set((v=i==null?void 0:i.creds)==null?void 0:v.sub,i.creds),m}),Le())})}else B(`Error: from ${_}: ${c.status}: ${c.response}`,!1)},c.open("POST",_,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Accept","application/json"),c.send(`{"idToken": "${l.data.id_token}"}`)}break;default:J("Unknown message type: ".concat(l.data.type));break}}),(async()=>(de.size>0&&de.forEach(async l=>{const i=await vt(l,n,e);i!==null&&i!==0&&(B(`Discarding expired login for #${l.sub}`,!1),pe.update(u=>(u.delete(l.sub),u)),Le());let c;if(i===null&&await st(null,l)?c={creds:l,valid:!0}:c={creds:l,valid:i===0},c.valid){const u=l;pe.update(a=>(a.set(u.sub,u),a)),Le()}}),$.set(!1)))()}function J(t){console.log(t);const e={isError:!1,text:t,time:new Date(Date.now())};ge.update(n=>(n.unshift(e),n))}function B(t,e){const n={isError:!0,text:t,time:new Date(Date.now())};if(ge.update(r=>(r.unshift(n),r)),!e)console.error(t);else throw new Error(t)}Ye.set(s());onload=()=>es();onunload=()=>{for(const t in le)delete le[t];Pe()};
